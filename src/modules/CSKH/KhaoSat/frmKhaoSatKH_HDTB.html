<ejs-dialog
    :enableResize="true"
    :allowDragging="true"
    ref="frmKhaoSatKH_HDTB"
    :header="'KHẢO SÁT THUÊ BAO LẮP ĐẶT'"
    :animationSettings="animationSettings"
    showCloseIcon="true"
    width="90%"
    :visible="false"
    :target="target"
    :open="dialogOpen"
    :close="closeDialog"
    :isModal="true"
>
    <div class="">
        <div class="list-actions-top">
            <ul class="list">
                <li>
                    <a href="javascript: void(0)" @click="onGhiLaiClicked()">
                        <span class="icon one-save"></span> Ghi lại
                    </a>
                </li>
                <li>
                    <a
                        href="javascript: void(0)"
                        @click="onDieuLaiClicked()"
                        v-if="pBtnStatus.btnDieuXNVisible"
                        :class="{'disabled': !pBtnStatus.btnDieuLaiEnabled}"
                    >
                        <span
                            class="icon arrows-1_curved-next nc-icon-glyph"
                        ></span>
                        Điều lại
                    </a>
                    <confirmPopup
                        :content="xacNhanDieuLai"
                        idModal="popup-confirmDieuLai_hdtb"
                        @onOk="onDieuLaiConfirmed"
                    />
                </li>
                <li>
                    <a :href="lichSuKSUrl" target="_blank">
                        <span
                            class="icon files_single-paragraph nc-icon-glyph"
                        ></span>
                        Lịch sử KS
                    </a>
                </li>
                <!-- <li>
                    <a href="javascript: void(0)" @click="$bvModal.show('frmKhaoSatKH_HDTB_frmLichSuBaoHong')" >
                        <span class="icon files_single-copy-04 nc-icon-glyph" ></span> Lịch sử BH
                    </a>
                    <frmLichSuBaoHong :thueBaoId="thueBaoId" id="frmKhaoSatKH_HDTB_frmLichSuBaoHong"/>
                </li> -->
                <li>
                    <a href="javascript: void(0)" @click="onLichSuHenBHClicked">
                        <span class="icon business_notes nc-icon-glyph" ></span>
                        Lịch sử hẹn
                    </a>
                    <frmLichSuHenBaoHong ref="popupLichSuHenBH" />
                    <!-- <a href="javascript: void(0)" @click="$bvModal.show('frmKhaoSatKH_HDTB_frmLichSuHenBaoHong')">
                        <span class="icon business_notes nc-icon-glyph"></span>
                        Lịch sử hẹn
                    </a>
                    <frmLichSuHenBaoHong id="frmKhaoSatKH_HDTB_frmLichSuHenBaoHong" :hdtbId="hdtbId" :kieu="1" /> -->

                </li>
                <!-- <li>
                    <a href="http://10.70.52.164:8081/FILE/hdsd/frmKhaoSatKH_HDTB.html" target="_blank">
                        <span class="icon files_single-content-02 nc-icon-glyph" ></span>
                        Trợ giúp
                    </a>
                </li> -->
            </ul>
        </div>
        <div class="popup-body">
            <div class="box-form">
                <div class="legend-title">
                    <span class="icon -ap icon-plus3"></span> Thông tin khách
                    hàng
                </div>
                <div class="row">
                    <div class="col-sm-6 col-12">
                        <div class="row">
                            <div class="col-sm-6 col-12">
                                <div class="info-row">
                                    <div class="key w100">Số máy/Acc</div>
                                    <div class="value">
                                        <input
                                            type="text"
                                            class="form-control highlight"
                                            ref="txtMaTB"
                                            v-model="pTxtMaTB"
                                        />
                                    </div>
                                </div>
                            </div>
                            <div class="col-sm-6 col-12">
                                <div class="info-row">
                                    <div class="key w100">Ngày YC</div>
                                    <div class="value">
                                        <div class="input-icon-right">
                                            <input
                                                type="text"
                                                class="form-control"
                                                ref="txtNgayYC"
                                                v-model="pTxtNgayYC"
                                            />
                                            <span
                                                class="icon one-calendar"
                                            ></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-sm-6 col-12">
                                <div class="info-row">
                                    <div class="key w100">
                                        Loại hợp đồng
                                    </div>
                                    <div class="value">
                                        <input
                                            type="text"
                                            class="form-control"
                                            ref="txtLoaiHD"
                                            v-model="pTxtLoaiHD"
                                        />
                                    </div>
                                </div>
                            </div>
                            <div class="col-sm-6 col-12">
                                <div class="info-row">
                                    <div class="key w100">Ngày HT</div>
                                    <div class="value">
                                        <div class="input-icon-right">
                                            <input
                                                type="text"
                                                class="form-control"
                                                ref="txtNgayHT"
                                                v-model="pTxtNgayHT"
                                            />
                                            <span
                                                class="icon one-calendar"
                                            ></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="info-row">
                            <div class="key w100">Kiểu yêu cầu</div>
                            <div class="value">
                                <input
                                    type="text"
                                    class="form-control"
                                    ref="txtKieuLD"
                                    v-model="pTxtKieuLD"
                                />
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-sm-6 col-12">
                                <div class="info-row">
                                    <div class="key w100">
                                        Tên KH
                                    </div>
                                    <div class="value">
                                        <input
                                            type="text"
                                            class="form-control"
                                            ref="txtLoaiHD"
                                            v-model="pTxtTenKH"
                                        />
                                    </div>
                                </div>
                            </div>
                            <div class="col-sm-6 col-12">
                                <div class="info-row">
                                    <div class="key w100">Mã KH</div>
                                    <div class="value">
                                        <input
                                            type="text"
                                            class="form-control"
                                            ref="txtNgayHT"
                                            v-model="pTxtMaKH"
                                        />
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-sm-6 col-12">
                                <div class="info-row">
                                    <div class="key w100">
                                        HDKH_ID
                                    </div>
                                    <div class="value">
                                        <input
                                            type="text"
                                            class="form-control"
                                            ref="txtLoaiHD"
                                            v-model="hdkhId"
                                        />
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="title-bg-main">
                            <span class="title">Thông tin cập nhật</span>
                        </div>
                        <div class="row">
                            <div class="col-sm-6 col-12">
                                <div class="info-row">
                                    <div class="key w100">
                                        Người trả lời
                                    </div>
                                    <div class="value">
                                        <input
                                            type="text"
                                            class="form-control"
                                            v-model="pTxtTenNguoiTL"
                                            ref="txtTenNguoiTL"
                                        />
                                    </div>
                                </div>
                            </div>
                            <div class="col-sm-6 col-12">
                                <div class="info-row">
                                    <div class="key w100">Số liên hệ</div>
                                    <div class="value">
                                        <input
                                            type="text"
                                            class="form-control"
                                            v-model="pTxtSoLH"
                                            ref="txtSoLH"
                                        />
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="info-row">
                            <div class="key w100">Ghi chú</div>
                            <div class="value">
                                <textarea
                                    class="form-control"
                                    style="height: 100px; resize: vertical"
                                    v-model="pTxtGhiChu"
                                    ref="txtGhiChu"
                                ></textarea>
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-6 col-12">
                        <div class="info-row">
                            <div class="key w90">Tên thuê bao</div>
                            <div class="value">
                                <input
                                    type="text"
                                    class="form-control"
                                    v-model="pTxtTenTB"
                                    ref="txtTenTB"
                                />
                            </div>
                        </div>
                        <div class="info-row">
                            <div class="key w90">Địa chỉ LĐ</div>
                            <div class="value">
                                <input
                                    type="text"
                                    class="form-control"
                                    v-model="pTxtDiaChiLD"
                                    ref="txtDiaChiLD"
                                />
                            </div>
                        </div>
                        <div class="info-row">
                            <div class="key w90">Số liên hệ</div>
                            <div class="value">
                                <input
                                    type="text"
                                    class="form-control"
                                    v-model="pTxtDienThoaiLH"
                                    ref="txtDienThoaiLH"
                                />
                            </div>
                        </div>
                        <div class="info-row">
                            <div class="key w90">Ghi chú HT</div>
                            <div class="value">
                                <input
                                    type="text"
                                    class="form-control"
                                    v-model="pTxtGhiChuHT"
                                    ref="txtGhiChuHT"
                                />
                            </div>
                        </div>
                        <div class="title-bg-main padt2 padb2">
                            <div class="title pull-left mart5">
                                Danh sách lần hỏi
                            </div>
                            <div class="pull-right">
                                <div class="info-row marb0">
                                    <div class="key red">
                                        <div class="check-action">
                                            <input
                                                type="checkbox"
                                                class="check"
                                                v-model="pCboLyDoKTL"
                                            />
                                            <span class="name font-weight-bold" style="width:150px !important;"
                                                >Không trả lời</span
                                            >
                                        </div>
                                    </div>
                                    <div class="value" style="min-width: 300px">
                                        <div class="select-custom">
                                            <!-- <appSelect2
                                                name="lyDoKTLOpt"
                                                :options="pDsLyDoKTL"
                                                v-model=" pCboLyDoKTLSelected "
                                                :disabled="!pCboLyDoKTL"
                                            >
                                            </appSelect2> -->
                                            <SelectExt v-model.trim="pCboLyDoKTLSelected" :dataSource="pDsLyDoKTL" dataTextField="LYDO_KTL"
                  dataValueField="LYDOKTL_ID" :disabled="!pCboLyDoKTL"/>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="clearfix"></div>
                        </div>
                        <div class="row">
                            <div class="col-sm-6 col-12">
                                <div class="info-row">
                                    <div class="key w70">
                                        <div class="check-action">
                                            <input
                                                type="checkbox"
                                                class="check"
                                                v-model="pchkHenKS_Tu"
                                                :disabled="!(pCboLyDoKTL && isKhachHangHen)"
                                            />
                                            <span class="name">Hẹn từ</span>
                                        </div>
                                    </div>
                                    <div class="value">
                                        <ejs-datepicker
                                            v-model="pDtpHenKS_Tu"
                                            :value="today"
                                            :format="'dd/MM/y'"
                                            :showClearButton="false"
                                            :enabled="pchkHenKS_Tu"
                                        >
                                        </ejs-datepicker>
                                    </div>
                                </div>
                            </div>
                            <div class="col-sm-6 col-12">
                                <div class="info-row">
                                    <div class="key w70">
                                        <div class="check-action">
                                            <input
                                                type="checkbox"
                                                class="check"
                                                v-model="pchkHenKS_Den"
                                                :disabled="!(pCboLyDoKTL && isKhachHangHen)"
                                            />
                                            <span class="name">Đến</span>
                                        </div>
                                    </div>
                                    <div class="value">
                                        <ejs-datepicker
                                            v-model="pDtpHenKS_Den"
                                            :value="today"
                                            :format="'dd/MM/y'"
                                            :showClearButton="false"
                                            :enabled="pchkHenKS_Den"
                                        >
                                        </ejs-datepicker>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="table-content mart10" style="height: 140px">
                            <DataGrid3
                                v-bind:columns="[
                                        {
                                            fieldName: 'NGUOI_HOI',
                                            headerText: 'Người hỏi',
                                            allowFiltering: true,
                                            allowSorting: true
                                        },
                                        {
                                            fieldName: 'NGUOI_TL',
                                            headerText: 'Người trả lời',
                                            allowFiltering: true,
                                            allowSorting: true
                                        },
                                        {
                                            fieldName: 'DIENTHOAI_LH',
                                            headerText: 'Điện thoại',
                                            allowFiltering: true,
                                            allowSorting: true
                                        },
                                        {
                                            fieldName: 'NGAY_HOI',
                                            headerText: 'Ngày hỏi	',
                                            allowFiltering: true,
                                            allowSorting: true
                                        },
                                        {
                                            fieldName: 'TRANGTHAI',
                                            headerText: 'Trạng thái',
                                            allowFiltering: true,
                                            allowSorting: true
                                        },
                                        {
                                            fieldName: 'LYDO_KTL',
                                            headerText: 'Lý do KTL',
                                            allowFiltering: true,
                                            allowSorting: true
                                        },
                                        {
                                            fieldName: 'GHICHU',
                                            headerText: 'Ghi chú',
                                            allowFiltering: true,
                                            allowSorting: true
                                        }
                                    ]"
                                v-bind:dataSource="this.pDsLanGoiChuaTL"
                                :showFilter="true"
                                :allowSorting="true"
                                :allowPaging="true"
                    :enablePagingServer="false"
                            ></DataGrid3>
                        </div>
                    </div>
                </div>
            </div>
            <div class="box-form">
                <div class="legend-title">Danh sách thuê bao</div>
                <div class="table-content">
                    <DataGrid3
                        v-bind:columns="[
                                {
                                    fieldName: 'MA_TB',
                                    headerText: 'Số máy/Acc',
                                    allowFiltering: true,
                                    allowSorting: true
                                },
                                {
                                    fieldName: 'NGAY_HT',
                                    headerText: 'Ngày HT',
                                    allowFiltering: true,
                                    allowSorting: true
                                },
                                {
                                    fieldName: 'LOAIHINH_TB',
                                    headerText: 'Loại hình',
                                    allowFiltering: true,
                                    allowSorting: true
                                },
                                {
                                    fieldName: 'TOCDO',
                                    headerText: 'Tốc độ',
                                    allowFiltering: true,
                                    allowSorting: true
                                },
                                {
                                    fieldName: 'LYDOHUY',
                                    headerText: 'Lý do hủy',
                                    allowFiltering: true,
                                    allowSorting: true
                                },
                                {
                                    fieldName: 'TEN_DVVT',
                                    headerText: 'Dịch vụ',
                                    allowFiltering: true,
                                    allowSorting: true
                                },
                                {
                                    fieldName: 'TEN_KIEULD',
                                    headerText: 'Kiểu lắp đặt',
                                    allowFiltering: true,
                                    allowSorting: true
                                },
                                {
                                    fieldName: 'TEN_TB',
                                    headerText: 'Tên TB',
                                    allowFiltering: true,
                                    allowSorting: true
                                },
                                {
                                    fieldName: 'DIACHI_LD',
                                    headerText: 'Địa chỉ lắp đặt',
                                    allowFiltering: true,
                                    allowSorting: true
                                },
                                {
                                    fieldName: 'TRANGTHAI_HD',
                                    headerText: 'Trạng thái HĐ',
                                    allowFiltering: true,
                                    allowSorting: true
                                },
                                {
                                    fieldName: 'NHANVIEN_NT',
                                    headerText: 'Nhân viên NT',
                                    allowFiltering: true,
                                    allowSorting: true
                                },
                                {
                                    fieldName: 'DONVI_NT',
                                    headerText: 'Đơn vị NT',
                                    allowFiltering: true,
                                    allowSorting: true
                                },
                                {
                                    fieldName: 'NHANVIEN_KHD',
                                    headerText: 'Nhân viên KHĐ',
                                    allowFiltering: true,
                                    allowSorting: true
                                },
                                {
                                    fieldName: 'DONVI_KHD',
                                    headerText: 'Đơn vị KHĐ',
                                    allowFiltering: true,
                                    allowSorting: true
                                }
                            ]"
                        v-bind:dataSource="this.pDsThueBao"
                        :showFilter="true"
                        :allowSorting="true"
                        :allowPaging="true"
                        :enablePagingServer="false"
                        ref="gridDsThueBao"
                        @selectedRowChanged="onGridDsThueBao_RowSelected"
                    ></DataGrid3>
                </div>
            </div>
            <div class="box-form">
                <cauHoiKS
                    ref="cauHoiKS"
                    :hinhThuc="1"
                    :nhanVienId="6"
                    :tbtlId="tbtlId"
                />
            </div>
        </div>
    </div>
</ejs-dialog>
