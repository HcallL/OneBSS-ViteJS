<ejs-dialog
    :enableResize="true"
    :allowDragging="true"
    ref="frmKhaoSatKH_TB"
    :header="'KHẢO SÁT THUÊ BAO TRONG DANH BẠ' + txtTitle"
    :animationSettings="animationSettings"
    showCloseIcon="true"
    width="90%"
    :visible="false"
    :target="target"
    :open="dialogOpen"
    :close="closeDialog"
    :isModal="true"
>
    <div class="">
        <div class="list-actions-top">
            <ul class="list">
                <li>
                    <a href="javascript: void(0)" @click="onGhiLaiClicked" data-toggle="tooltip" title="Ghi lại"> <span class="icon one-save"></span>Ghi lại </a>
                </li>
                <li v-if="this.pBtnStatus.btnDieuLaiVisible">
                    <a href="javascript: void(0)" @click="onDieuLaiClicked" data-toggle="tooltip" title="Điều lại" :class="{'disabled': !pBtnStatus.btnDieuLaiEnabled}">
                        <span class="icon one-file-refresh"></span>Điều lại
                    </a>
                    <confirmPopup :content="xacNhanDieuLai" idModal='popup-confirmDieuLai_tb' @onOk="onDieuLaiConfirmed"/>
                </li>
                <li>
                    <a href="javascript: void(0)" data-toggle="tooltip" title="Lịch sử hỏng" @click="onLichSuBHClicked">
                        <span class="icon one-file-history"></span>Lịch sử hỏng
                    </a>
                    <!-- <frmLichSuBaoHong ref="popupLichSuBH" /> -->
                    <LichSuBaoHong :soMay="pTxtMaTB"/>
                </li>
                <!-- <li>
                    <a href="http://10.70.52.164:8081/FILE/hdsd/frmKhaoSatKH_TB.html" target="_blank">
                        <span class="icon files_single-content-02 nc-icon-glyph" ></span>
                        Trợ giúp
                    </a>
                </li> -->
            </ul>
        </div>
        <div class="popup-body">
            <div class="row">
                <div class="col-sm-6 col-12">
                    <div class="box-form">
                        <div class="legend-title">Thông tin khách hàng / Thuê bao</div>
                        <div class="row">
                            <div class="col-sm-6 col-12">
                                <div class="info-row">
                                    <div class="key">Số máy/ Acc</div>
                                    <div class="value">
                                        <input
                                            type="text"
                                            class="form-control"
                                            ref="txtMaGD"
                                            v-model="pTxtMaTB"
                                        />
                                    </div>
                                </div>
                            </div>
                            <div class="col-sm-6 col-12">
                                <div class="info-row">
                                    <div class="key w120">TG Bắt đầu KS:</div>
                                    <div class="value">
                                        <!-- <input
                                            type="text"
                                            class="form-control"
                                            ref="txtNgayYC"
                                            v-model="pTxtNgayYC"
                                        /> -->
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-sm-6 col-12">
                                <div class="info-row">
                                    <div class="key">Loại hình/tốc độ</div>
                                    <div class="value">
                                        <input
                                            type="text"
                                            class="form-control"
                                            ref="txtLoaiHD"
                                            v-model="pTxtLoaiHD"
                                        />
                                    </div>
                                </div>
                            </div>
                            <div class="col-sm-6 col-12">
                                <div class="info-row">
                                    <div class="key w120">
                                        Loại hình / tốc độ
                                    </div>
                                    <div class="value">
                                        <input
                                            type="text"
                                            class="form-control"
                                            ref="txtLoaiHinh"
                                            v-model="pTxtLoaiHinh"
                                        />
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="info-row">
                            <div class="key">Tên thuê bao</div>
                            <div class="value">
                                <input
                                    type="text"
                                    class="form-control"
                                    ref="txtTenKH"
                                    v-model="pTxtTenKH"
                                />
                            </div>
                        </div>
                        <div class="info-row">
                            <div class="key">Địa chỉ lắp đặt</div>
                            <div class="value">
                                <input
                                    type="text"
                                    class="form-control"
                                    ref="txtDiaChiKH"
                                    v-model="pTxtDiaChiKH"
                                />
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-sm-6 col-12">
                                <div class="info-row">
                                    <div class="key">Điện thoại LH</div>
                                    <div class="value">
                                        <input
                                            type="text"
                                            class="form-control"
                                            ref="txtDienThoaiLH"
                                            v-model="pTxtDienThoaiLH"
                                        />
                                    </div>
                                </div>
                            </div>
                            <div class="col-sm-6 col-12">
                                <div class="info-row">
                                    <div class="key w80">Trạng thái</div>
                                    <div class="value">
                                        <input
                                            type="text"
                                            class="form-control"
                                            ref="txtDienThoaiLH"
                                            v-model="pTxtTrangThai"
                                        />
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="box-form">
                        <div class="legend-title">Thông tin cập nhật</div>
                        <div class="info-row">
                            <div class="key">Người trả lời</div>
                            <div class="value">
                                <input
                                    type="text"
                                    class="form-control"
                                    ref="txtTenNguoiTL"
                                    v-model="pTxtTenNguoiTL"
                                />
                            </div>
                        </div>
                        <div class="info-row">
                            <div class="key">Số liên hệ</div>
                            <div class="value">
                                <input
                                    type="text"
                                    class="form-control"
                                    ref="txtSoLH"
                                    v-model="pTxtSoLH"
                                />
                            </div>
                        </div>
                        <div class="info-row">
                            <div class="key">Ghi chú</div>
                            <div class="value">
                                <textarea
                                    class="form-control"
                                    style="height: 30px;resize: vertical;"
                                    ref="txtGhiChu"
                                    v-model="pTxtGhiChu"
                                ></textarea>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-sm-6 col-12">
                                <div class="info-row">
                                    <div class="key w70">
                                        <div class="check-action">
                                            <input
                                                type="checkbox"
                                                class="check"
                                                v-model="pchkHenKS_Tu"
                                            />
                                            <span class="name">Hẹn từ</span>
                                        </div>
                                    </div>
                                    <div class="value">
                                        <ejs-datetimepicker
                                            v-model="pDtpHenKS_Tu"
                                            :value="today"
                                            :format="'dd/MM/y HH:mm'"
                                            :showClearButton="false"
                                            :enabled="pchkHenKS_Tu"
                                        >
                                        </ejs-datetimepicker>
                                    </div>
                                </div>
                            </div>
                            <div class="col-sm-6 col-12">
                                <div class="info-row">
                                    <div class="key w70">
                                        <div class="check-action">
                                            <input
                                                type="checkbox"
                                                class="check"
                                                v-model="pchkHenKS_Den"
                                            />
                                            <span class="name">Đến</span>
                                        </div>
                                    </div>
                                    <div class="value">
                                        <ejs-datetimepicker
                                            v-model="pDtpHenKS_Den"
                                            :value="today"
                                            :format="'dd/MM/y HH:mm'"
                                            :showClearButton="false"
                                            :enabled="pchkHenKS_Den"
                                        >
                                        </ejs-datetimepicker>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="info-row" v-show="!!pTxtMoTa">
                            <div class="key">Mô tả</div>
                            <div class="value" v-html="pTxtMoTa">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-sm-6 col-12">
                    <div class="box-form padt5">
                        <div class="legend-title">
                            <div class="pull-left mart5">
                                Danh sách lần hỏi
                            </div>
                            <div class="pull-right">
                                <div class="info-row marb0 ">
                                    <div class="key">
                                        <div class="check-action normal red">
                                            <input
                                                type="checkbox"
                                                class="check"
                                                v-model="pCboLyDoKTL"
                                            />
                                            <span class="name font-weight-bold" style="width:150px !important;"
                                                >Không trả lời</span
                                            >
                                        </div>
                                    </div>
                                    <div class="value">
                                        <div class="select-custom" style="width: 350px;">
                                            <!-- <appSelect2
                                                name="lyDoKTLOpt"
                                                :options="pDsLyDoKTL"
                                                v-model=" pCboLyDoKTLSelected "
                                                :disabled="!pCboLyDoKTL"
                                            >
                                            </appSelect2> -->
                                            <SelectExt v-model.trim="pCboLyDoKTLSelected" :dataSource="pDsLyDoKTL" dataTextField="LYDO_KTL"
                  dataValueField="LYDOKTL_ID" :disabled="!pCboLyDoKTL"/>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="clearfix"></div>
                        </div>
                        <div class="table-content" >
                            <DataGrid3
                                v-bind:columns="[
                                        { fieldName: 'NGUOI_HOI', headerText: 'Người hỏi', allowFiltering: true, allowSorting: true },
                                        { fieldName: 'NGUOI_TL', headerText: 'Người trả lời', allowFiltering: true, allowSorting: true },
                                        { fieldName: 'DIENTHOAI_LH', headerText: 'Điện thoại', allowFiltering: true, allowSorting: true },
                                        { fieldName: 'NGAY_HOI', headerText: 'Ngày hỏi	', allowFiltering: true, allowSorting: true },
                                        { fieldName: 'TRANGTHAI', headerText: 'Trạng thái', allowFiltering: true, allowSorting: true },
                                        { fieldName: 'LYDO_KTL', headerText: 'Lý do KTL', allowFiltering: true, allowSorting: true },
                                        { fieldName: 'GHICHU', headerText: 'Ghi chú', allowFiltering: true, allowSorting: true }
                                    ]"
                                @selectedRowChanged="onDsLanGoiRowSelected"
                                v-bind:dataSource="this.dsLanGoiChuaTraLoi"
                                :showFilter="true"
                                :allowSorting="true"
                                :allowPaging="true"
                    :enablePagingServer="false"
                            ></DataGrid3>
                        </div>
                    </div>
                </div>
            </div>
            <div class="box-form">
                <!-- @fakedata -->
                <cauHoiKS
                    :hinhThuc="hinhThucId"
                    :nhanVienId="95"
                    ref="cauHoiKS"
                    :tbtlId="tbtlId"
                />
            </div>
        </div>
    </div>
</ejs-dialog>
