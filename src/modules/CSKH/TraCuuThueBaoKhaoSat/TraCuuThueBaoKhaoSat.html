<div class="ds-thuebao-ks">
    <div class="list-actions-top">
        <ul class="list">
            <li>
                <a href="javascript: void(0)" @click="onTimKiemClicked(false)" data-toggle="tooltip" title="Tìm kiếm">
                    <span class="icon one-search"></span> Tìm kiếm
                </a>
            </li>
            <!-- <li>
                <a href="javascript: void(0)" @click="onTimKiemClicked(true)">
                    <span class="icon one-search"></span> Tìm kiếm - Dữ liệu cứng
                </a>
            </li> -->
            <li>
                <a href="javascript: void(0)" @click="onChiTietKSClicked" data-toggle="tooltip" title="Chi tiết thông tin khảo sát">
                    <span class="icon ui-2_phone nc-icon-glyph"></span> Chi tiết KS
                </a>
                <frmKhaoSatKH ref="frmKhaoSatKH" :baoHongId="p_BAOHONG_ID"/>
                <frmKhaoSatKH_LM ref="frmKhaoSatKH_LM"/>
                <frmKhaoSatKH_HDTB ref="frmKhaoSatKH_HDTB"/>
            </li>
            <li>
                <a href="javascript: void(0)" data-toggle="tooltip" title="Xuất Excel" @click="onExportExcel">
                    <!-- <downloadexcel :fields="exportExcelFields" :data="this.DsThueBaoKS" worksheet="export"
                        name="export.xls" :before-generate="onStartDownload">
                        <span class="icon one-excel"></span> Xuất Excel
                    </downloadexcel> -->
                    <span class="icon one-excel"></span> Xuất Excel
                </a>

            </li>
            <li>
                <a href="javascript: void(0)" @click="onXuatFileClicked" data-toggle="tooltip" title="Xuất file">
                    <span class="icon one-download"></span> Xuất file
                </a>
                <appModalXuatDuLieu id="modal-xuat-dulieu" :thuocTinh="dsThuocTinh" :data="DsThueBaoKS"/>
            </li>
            <!-- <li>
                <a href="http://10.70.52.164:8081/FILE/hdsd/frmTraCuuTBKS.html" target="_blank" data-toggle="tooltip" title="Trợ giúp">
                    <span class="icon ui-2_alert-circle nc-icon-glyph"></span> Trợ giúp
                </a>
            </li> -->
        </ul>
    </div>
    <div class="page-content">
        <div class="row">
            <div class="col-sm-3 col-12">
                <div class="box-form">
                    <div class="legend-title">Đơn vị</div>
                    <div class="tree-plus padl10" style="height: 300px;overflow: auto;">
                        <ejs-treeview id="treeObj" ref="treeObj" :fields='treeDonViFields' :showCheckBox='false' :dataBound="onCayDonViDataBound"></ejs-treeview>
                    </div>
                </div>
            </div>
            <div class="col-sm-6 col-12">
                <div class="box-form">
                    <div class="legend-title">Thời gian khảo sát</div>
                    <div class="row">
                        <div class="col-sm-6 col-12">
                            <div class="info-row">
                                <div class="key w100">Từ ngày<span class="required"> *</span> </div>
                                <div class="value">
                                    <ejs-datepicker ref="tuNgay" v-model="pTxtThoiGianKSTu" :value="today" :max="today" :format="'dd/MM/y'" :allowEdit="true" :showClearButton="false">
                                    </ejs-datepicker>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-6 col-12">
                            <div class="info-row">
                                <div class="key w100">Đến ngày<span class="required"> *</span> </div>
                                <div class="value">
                                    <ejs-datepicker ref="denNgay" v-model="pTxtThoiGianKSDen" :value="today" :max="today" :format="'dd/MM/y'" :allowEdit="true" :showClearButton="false">
                                    </ejs-datepicker>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="box-form" style="height: 255px;" >
                    <div class="legend-title">Thông tin thuê bao</div>
                    <div class="row">
                        <div class="col-sm-6 col-12">
                            <div class="info-row">
                                <div class="key w100">Ngày khảo sát </div>
                                <div class="value">
                                    <input v-model="pTxtNgayKS" type="text" class="form-control" >
                                    </input>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-6 col-12">
                            <div class="info-row">
                                <div class="key w100">Ngày yêu cầu </div>
                                <div class="value">
                                    <input v-model="pTxtNgayYC" type="text" class="form-control" >
                                    </input>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-6 col-12">
                            <div class="info-row">
                                <div class="key w100">Số máy/Acc </div>
                                <div class="value">
                                    <div class="input-more-button">
                                        <input type="text" class="form-control highlight" v-model="pTxtMaTB" @keypress="onMaTBKeyPress">
                                        <button class="btn" @click.prevent="onShowSearchAccount">
                                            <span class="-ap icon-more_horiz"></span>
                                        </button>
                                    </div>
                                    <!-- <div class="input-icon-right">
                                        <input type="text" class="form-control highlight" v-model="pTxtMaTB" @keypress="onMaTBKeyPress">
                                        <span class="icon -ap icon-more_horiz"></span>
                                    </div> -->
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-6 col-12">
                            <div class="info-row">
                                <div class="key w100">Ngày HT </div>
                                <div class="value">
                                    <input v-model="pTxtNgayHT" type="text" class="form-control" >
                                    </input>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="info-row">
                        <div class="key w100">Ghi chú </div>
                        <div class="value">
                            <input type="text" class="form-control" v-model="pTxtGhiChu">
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-sm-3 col-12">
                <div class="box-form">
                    <div class="legend-title">
                        <div class="check-action">
                            <input type="checkbox" class="check" v-model="pCboAllCauHoi">
                            <span class="name">Câu hỏi/ trả lời</span>
                        </div>
                        <!-- <div class="arrow"></div> Câu hỏi/ trả lời -->
                    </div>
                    <div class="tree-plus padl10" style="height: 300px;overflow: auto;">
                        <ejs-treeview id="treeCauHoiObj" ref="treeCauHoiObj" :fields='treeCauHoiFields' :showCheckBox='false'></ejs-treeview>
                    </div>
                </div>
            </div>
        </div>
        <div class="box-form">
            <div class="legend-title">Danh sách thuê bao được khảo sát</div>
            <div class="text-main marb10">{{txtTongSoThueBao}}</div>
            <!-- <div class="title-bg-main">Thông tin các lần khảo sát</div> -->
            <div class="table-content table-custom">
                <DataGrid
                    :columns='[
                        { headerText: "Thông tin các lần khảo sát", columns: thongtinColumns },
                        { headerText: "Nhân viên", columns: nhanVienColumns},
                        { headerText: "Dịch vụ", columns: dichVuColumns},
                        { headerText: "Tổng hợp", columns: tongHopColumns}
                    ]'
                    :dataSource="DsThueBaoKS"
                    :showFilter="true"
                    dataKeyField="STT"
                    ref="gridThueBaoKS"
                    :allowPaging="true"
                    :enablePagingServer="false"
                    :enabledSelectFirstRow="true"
                    @selectedRowChanged="gridThueBaoKS_rowClicked">
                </DataGrid>
            </div>
        </div>
        <div class="box-form">
            <div class="legend-title">Chi tiết</div>
            <div class="table-content">
                <CSKHGrid
                    :columns="fieldNoiDungKhaoSat"
                    :dataSource="pDsChiTietTraLoi"
                    :showFilter="true"
                    ref="danhsach"
                    :allowPaging="false" :enablePagingServer="false"
                />
                <!-- <ejs-grid
                    ref='grid-noidung-ks'
                    class="table-result tree-grid-2"
                    locale='vi-VN'
                    gridLines='Both'
                    clipMode="EllipsisWithTooltip"
                    :groupSettings="{showDropArea: false, captionTemplate: '${key}', columns: ['CAUHOI']}"
                    :dataSource="pDsChiTietTraLoi"
                    :dataBound="onDataBoundTienTrinh"
                    :allowSorting="true"
                    :allowFiltering='true'
                    :allowResizing='true'
                    :allowGrouping='true'>
                    <e-columns>
                        <e-column headerText='' textAlign="Center" width="20" :allowResizing="false" :allowFiltering="false" :template='columnTemplate'></e-column>
                        <e-column field='CAUHOI' headerText='' headerTextAlign='Center' width="50" :visible="false" :filterBarTemplate='filterBarTemplate'></e-column>
                        <e-column field='TRALOI' headerText='Trả lời' headerTextAlign='Center' width="130" :filterBarTemplate='filterBarTemplate'></e-column>
                        <e-column field='NOIDUNG' headerText='Mô tả thêm' headerTextAlign='Center' width="130" :filterBarTemplate='filterBarTemplate' ></e-column>

                    </e-columns>
                </ejs-grid> -->
                <!-- <ejs-treegrid :dataSource='pDsChiTietTraLoiGridData' childMapping='Childs'
                          :allowPaging='false'
                          :treeColumnIndex='0'
                          :allowFiltering='true' :allowSorting='true'>
                    <e-columns>
                        <e-column field='TRALOI' headerText='Trả lời' ></e-column>
                        <e-column field='NOIDUNG' headerText='Mô tả thêm'></e-column>
                    </e-columns>
                </ejs-treegrid> -->
            </div>
        </div>
    </div>
    <b-modal id="popupComponents" size="xl"
        hide-footer
        hide-header
        hide-header-close
        body-class="modal-body p-0">
        <component :is="popupComponent" @form-close="searchAccountClosed" :isPopup="true"></component>
    </b-modal>
    <b-modal id="popup-audio" size="sm" hide-footer hide-header body-class="modal-body p-0" centered>
        <div class="modal-content popup-box">
            <audio :src="srcAudio" controls autoplay></audio>
        </div>
    </b-modal>
</div>
