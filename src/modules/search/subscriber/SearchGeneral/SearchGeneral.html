<div class="main-wrapper SearchGeneral">
  <breadcrumb :class="hideBreadcrumb" :header="header" />
  <div class="list-actions-top">
    <ul class="list">
      <li>
        <a href="#" @click.prevent="btnVatTu"> <span class="icon one-vt"></span> Vật tư </a>
      </li>
      <li>
        <a href="#" @click.prevent="btnChiTietTB"> <span class="icon one-mobile-search"></span> Chi tiết TB </a>
      </li>
      <li>
        <a href="#" @click.prevent="btnToaNha"> <span class="icon one-building"></span> Tòa nhà </a>
      </li>
      <li>
        <a href="#" @click.prevent="btnIvan"> <span class="icon  one-search"></span> Thông tin Backend </a>
      </li>
      <!-- <li>
                <a href="#" @click.prevent="btnTest">
                    <span class="icon  one-search"></span> Load form test
                </a>
            </li> -->
    </ul>
  </div>
  <div class="page-content">
    <div class="row">
      <div class="col-sm-6 col-12">
        <div class="box-form">
          <div class="legend-title">Thông tin khách hàng</div>
          <div class="row">
            <div class="col-sm-7 col-12">
              <div class="info-row">
                <div class="key">Mã khách hàng</div>
                <div class="value">
                  <div class="input-more-button">
                    <button class="btn" @click="btnMaKH_Click">
                      <span class="-ap icon-more_horiz"></span>
                    </button>
                    <input type="text" class="form-control highlight text fw6" v-model="MaKH" ref="MaKH" value="NDH-00373685" v-on:keyup.enter="onMaKHEnter" />
                  </div>
                </div>
              </div>
            </div>
            <div class="col-sm-5 col-12">
              <div class="info-row">
                <div class="key w80">Mã KH cũ</div>
                <div class="value">
                  <input type="text" class="form-control  text fw6" v-model="MaKHCu" ref="MaKHCu" readonly />
                </div>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-sm-7 col-12">
              <div class="info-row">
                <div class="key">Tên khách hàng</div>
                <div class="value">
                  <input type="text" class="form-control  text fw6" v-model="TenKH" ref="TenKH" readonly />
                </div>
              </div>
            </div>
            <div class="col-sm-5 col-12">
              <div class="info-row">
                <div class="key w80">PL KH</div>
                <div class="value">
                  <input type="text" class="form-control text-main fw6" v-model="PLKH" ref="PLKH" readonly />
                </div>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-12">
              <div class="info-row">
                <div class="key">Địa chỉ KH</div>
                <div class="value">
                  <div class="input-more-button">
                    <button class="btn" @click="openMapTB(DiaChiKH, 'DiaChiKH')">
                      <span class="one-map-location f20"></span>
                    </button>
                    <input type="text" class="form-control  text fw6" v-model="DiaChiKH" ref="DiaChiKH" readonly />
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-sm-7 col-12">
              <div class="info-row">
                <div class="key">Tiền TT</div>
                <div class="value">
                  <input type="text" class="form-control  text fw6 tright highlight" v-model="TienTT" ref="TienTT" />
                </div>
              </div>
            </div>
            <div class="col-sm-5 col-12">
              <div class="info-row">
                <div class="key w80">Còn nợ</div>
                <div class="value">
                  <input type="text" class="form-control red fw6 highlight tright" v-model="ConNo" ref="ConNo" />
                </div>
              </div>
            </div>
          </div>
          <div class="legend-title mart20">Thông tin thanh toán</div>
          <div class="row">
            <div class="col-sm-7 col-12">
              <div class="info-row">
                <div class="key">Mã thanh toán</div>
                <div class="value">
                  <input type="text" class="form-control  text fw6 highlight" v-model="MaTT" ref="MaTT" v-on:keyup.enter="onMaTTEnter" />
                </div>
              </div>
            </div>
            <div class="col-sm-5 col-12">
              <div class="info-row">
                <div class="key w80">Mã ĐD</div>
                <div class="value">
                  <input type="text" class="form-control text fw6 highlight" v-model="MaDD" ref="MaDD" />
                </div>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-12">
              <div class="info-row">
                <div class="key">Tên thanh toán</div>
                <div class="value">
                  <input type="text" class="form-control  text fw6" v-model="TenTT" ref="TenTT" readonly />
                </div>
              </div>
            </div>
          </div>

          <div class="row">
            <div class="col-12">
              <div class="info-row">
                <div class="key">Địa chỉ TT</div>
                <div class="value">
                  <div class="input-more-button">
                    <button class="btn" @click="openMapTB(DiaChiTT, 'DiaChiTT')">
                      <span class="one-map-location f20"></span>
                    </button>
                    <input type="text" class="form-control  text fw6" v-model="DiaChiTT" ref="DiaChiTT" readonly />
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-12">
              <div class="info-row">
                <div class="key">Địa chỉ BC</div>
                <div class="value">
                  <div class="input-more-button">
                    <button class="btn" @click="openMapTB(DiaChiBC, 'DiaChiBC')">
                      <span class="one-map-location f20"></span>
                    </button>
                    <input type="text" class="form-control  text fw6" v-model="DiaChiBC" ref="DiaChiBC" readonly />
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-sm-7 col-12">
              <div class="info-row">
                <div class="key">Hình thức TT</div>
                <div class="value">
                  <div class="select-custom">
                    <select2 :options="listbox.hinhthuctt.list" v-model="listbox.hinhthuctt.value.HTTT_ID" @change="HienThi_LoaiHinh" class="disabled">
                      <option disabled value="0">Select one</option>
                    </select2>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-sm-5 col-12">
              <div class="info-row">
                <div class="key w80">Mã in ghép</div>
                <div class="value">
                  <input type="text" class="form-control fw6 text" v-model="MaInGhep" ref="MaInGhep" readonly />
                </div>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-sm-7 col-12">
              <div class="info-row">
                <div class="key">Tiền TT</div>
                <div class="value">
                  <input type="text" class="form-control  text fw6 tright highlight" v-model="TienTT_TT" ref="TienTT_TT" />
                </div>
              </div>
            </div>
            <div class="col-sm-5 col-12">
              <div class="info-row">
                <div class="key w80">Còn nợ</div>
                <div class="value">
                  <input type="text" class="form-control red fw6 highlight tright" v-model="ConNo_TT" ref="ConNo_TT" />
                </div>
              </div>
            </div>
          </div>
          <div class="legend-title mart20">Thông tin thuê bao</div>
          <div class="row">
            <div class="col-sm-7 col-12">
              <div class="info-row">
                <div class="key">Dịch vụ</div>
                <div class="value">
                  <div class="select-custom">
                    <select2 :options="listbox.dichvu.list.filter(x=>x.DICHVUVT_ID > 0).map(x=>({id:x.DICHVUVT_ID,text:x.TEN_DVVT}))" v-model="listbox.dichvu.value.DICHVUVT_ID" @change="DichVuChange" class="disabled">
                      <option disabled value="0">Select one</option>
                    </select2>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-sm-5 col-12">
              <div class="info-row">
                <div class="key w80">Loại hình</div>
                <div class="value">
                  <div class="select-custom">
                    <select2 :options="listbox.loaihinh.list" v-model="listbox.loaihinh.value.LOAITB_ID" @change="HienThi_LoaiHinh" class="disabled">
                      <option disabled value="0">Select one</option>
                    </select2>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-sm-4 col-12">
              <div class="info-row">
                <div class="key">Số máy/Acc</div>
                <div class="value">
                  <input type="text" class="form-control highlight" v-model="MaTB" ref="MaTB" v-on:keyup.enter="onMaTBEnter" />
                </div>
              </div>
            </div>
            <div class="col-sm-3 col-12">
              <div class="info-row">
                <div class="key w60">Số ảo</div>
                <div class="value">
                  <input type="text" class="form-control highlight" v-model="SoAo" ref="SoAo" />
                </div>
              </div>
            </div>
            <div class="col-sm-5 col-12">
              <div class="info-row">
                <div class="key w80">Đối tượng</div>
                <div class="value">
                  <div class="select-custom">
                    <select2 :options="listbox.doituong.list" v-model="listbox.doituong.value.id" @change="HienThi_LoaiHinh" class="disabled">
                      <option disabled value="0">Select one</option>
                    </select2>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-12">
              <div class="info-row">
                <div class="key">Địa chỉ TB</div>
                <div class="value">
                  <div class="input-more-button" @click="openMapTB(DiaChiTB, 'DiaChiTB')">
                    <button class="btn">
                      <span class="one-map-location f20"></span>
                    </button>
                    <input type="text" class="form-control  text fw6" v-model="DiaChiTB" ref="DiaChiTB" readonly />
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-12">
              <div class="info-row">
                <div class="key">Địa chỉ LĐ</div>
                <div class="value">
                  <div class="input-more-button">
                    <button class="btn" @click="openMapTB(DiaChiLD, 'DiaChiLD')">
                      <span class="one-map-location f20"></span>
                    </button>
                    <input type="text" class="form-control  text fw6" v-model="DiaChiLD" ref="DiaChiLD" readonly />
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-sm-7 col-12">
              <div class="info-row">
                <div class="key">Trạng thái TB</div>
                <div class="value">
                  <input type="text" class="form-control  red highlight" v-model="TrangThaiTB" ref="TrangThaiTB" />
                </div>
              </div>
            </div>
            <div class="col-sm-5 col-12">
              <div class="info-row">
                <div class="key w80">Khu vực</div>
                <div class="value">
                  <div class="input-more-button">
                    <button class="btn" @click="btnKhuVuc">
                      <span class="-ap icon-more_horiz"></span>
                    </button>
                    <input type="text" class="form-control fw6 text" v-model="KhuVuc" ref="KhuVuc" readonly />
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-sm-7 col-12">
              <div class="info-row">
                <div class="key">Tiền TT</div>
                <div class="value">
                  <input type="text" class="form-control  text fw6 tright highlight" v-model="TienTT_Tbao" ref="TienTT_Tbao" />
                </div>
              </div>
            </div>
            <div class="col-sm-5 col-12">
              <div class="info-row">
                <div class="key w80">Còn nợ</div>
                <div class="value">
                  <input type="text" class="form-control red fw6 highlight tright" v-model="ConNo_Tbao" ref="ConNo_Tbao" />
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="box-form">
          <div class="legend-title">Danh sách nhóm/gói - <span class="normal red">Các biến động: liên quan đến thuê bao gói có thể dẫn đến hủy gói</span></div>
          <div class="table-content" style="height: 200px;">
            <table class="table-result table-gachle">
              <DataGrid v-bind:columns="listbox.ds_nhomgoi.header" v-bind:dataSource="listbox.ds_nhomgoi.list" :enable-paging-server="false" :allowPaging="true" :showFilter="true" :showColumnCheckbox="false" ref="ds_nhomgoi"> </DataGrid>
            </table>
          </div>
        </div>
      </div>
      <div class="col-sm-6 col-12">
        <div class="box-form">
          <div class="legend-title">
            <div class="pull-left">Khuyến mại: <span class="red">{{txtKhuyenMai}}</span></div>
            <div class="pull-right normal">
              <div class="check-action">
                <input type="checkbox" class="check" v-model="chkAll_KM" />
                <span class="name">Tất cả</span>
              </div>
            </div>
            <div class="clearfix"></div>
          </div>
          <div class="table-content" style="height: 265px;">
            <table class="table-result table-gachle">
              <DataGrid v-bind:columns="listbox.ds_khuyenmai.header" v-bind:dataSource="listbox.ds_khuyenmai.list" :enable-paging-server="false" :allowPaging="true" :showFilter="true" :showColumnCheckbox="false" ref="ds_khuyenmai"> </DataGrid>
            </table>
          </div>

          <div class="legend-title mart20">Các biến động thuê bao chưa hoàn thành của KH</div>
          <div class="table-content" style="height: 265px;">
            <table class="table-result table-gachle">
              <DataGrid v-bind:columns="listbox.ds_bdchuahoanthanh.header" v-bind:dataSource="listbox.ds_bdchuahoanthanh.list" :enable-paging-server="false" :allowPaging="true" :showFilter="true" :showColumnCheckbox="false" ref="ds_bdchuahoanthanh"> </DataGrid>
            </table>
          </div>

          <div class="legend-title mart20">Danh sách thuê bao</div>
          <div class="table-content" style="height: 265px;">
            <table class="table-result table-gachle">
              <DataGridCustom
                v-bind:columns="listbox.ds_thuebao.header"
                v-bind:dataSource="listbox.ds_thuebao.list"
                :enabledSelectFirstRow="true"
                :allowPaging="true"
                :showFilter="true"
                :showColumnCheckbox="false"
                ref="ds_thuebao"
                @selectedRowChanged="gridChanged"
                @actionComplete="selectRowsChon"
                :enablePagingServer="true"
                @pageChanged="gridDanhSachTB_pageChanged"
                :totalRecords="totalRecords"
              >
              </DataGridCustom>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- <ejs-dialog :enableResize='true' :allowDragging='true' :visible="false" ref="DetailSub"
    :header='"Thông tin chi tiết thuê bao hiện tại trên hệ thống ĐHSX"' showCloseIcon=true width='80%' :target='toptarget' height="800">
    <div>
        <DetailSub :dulieu="popupDetailSubData"/>
    </div>
    </ejs-dialog> -->
  <!-- <ejs-dialog :enableResize='true'  :allowDragging='true' :visible="false" ref="pop_TraCuuPharmacy" :header='"Tra cứu thông tin dịch vụ VNPT Pharmacy"' style="resize: none;"
              showCloseIcon=true target=".main-wrapper" width='60%' height="800" body-class="modal-body p-0 bhxh-body">
    <TraCuuPharmacy/>
  </ejs-dialog> -->

  <ModalChonToaDo idModalChonToaDo="ModalChonToaDo" @XacNhanToaDo="XacNhanToaDo" :position="map" :diachi="map_info.dia_chi" :ten_kc="map_info.title" ref="chonbando"></ModalChonToaDo>
  <ModalTraCuuVT ref="formVattu" idModalTraCuuVT="ModalTraCuuVT"></ModalTraCuuVT>

  <ejs-dialog :enableResize="true" :allowDragging="true" :visible="false" ref="pop_toanha" :header='"Tra cứu thông tin tòa nhà"' showCloseIcon="true" target=".main-wrapper" width="60%" height="800">
    <ThueBao_ToaNha ref="formDiachi" :ma_gd="MaKH" :ma_kh="MaKH" :ma_tb="MaTB" :tag="'tracuu_danhba'" :dataDiachi="dataDiachi" />
  </ejs-dialog>

  <ejs-dialog :enableResize="true" :allowDragging="true" :visible="false" ref="pop_ivan" :header='"Tra cứu thông tin BHXH"' style="resize: none;" showCloseIcon="true" target=".main-wrapper" width="60%" height="800" body-class="modal-body p-0 bhxh-body">
    <tracuuBHXH ref="ipop_ivan" :ma_tb="MaTB" />
  </ejs-dialog>

  <ejs-dialog :enableResize="true" :allowDragging="true" :visible="false" ref="pop_hddt" :header='"Tra cứu thông tin HDDT"' style="resize: none;" showCloseIcon="true" target=".main-wrapper" width="60%" height="800" body-class="modal-body p-0 bhxh-body">
    <TraCuuHDDT ref="ipop_hddt" :dulieu="dl_db_cntt" />
  </ejs-dialog>

  <popupNhanVienDiaBan modalId="popupNVDB" :data="dataPopupNVDB" @form-close="closePopupNVDB" />
  <b-modal id="popupComponents" size="xl" hide-footer :title="popupTitle" body-class="modal-body p-0">
    <component :is="popupComponent" ref="popupComponent" :dulieu="popupComponentData" isPopup="true" @form-close="popupClosed"></component>
  </b-modal>
  <ejs-dialog :enableResize="true" :allowDragging="true" :visible="false" ref="popupComponentejs" :header='"Danh sách khách hàng"' showCloseIcon="true" target=".main-wrapper" width="60%" height="800">
    <popupChonGrid ref="popupChonGrid" :dulieu="popupComponentData" @form-close="popupClosed"></popupChonGrid>
    <!--v-dynamic-events="popupComponentEvents"-->
  </ejs-dialog>
  <TraCuuThongSoKTModal ref="traCuuThongSoKTModal" :dichvuvt_id="listbox.dichvu.value.DICHVUVT_ID" :loaitb_id="listbox.loaihinh.value.LOAITB_ID" :kieu="1" :thuebao_id="parseInt(thuebao_id)" :ma_tb="MaTB" />
  <!-- <CatHuyCuaHangPharmacyVue ref="CatHuyCuaHangPharmacy"/> -->
</div>
