<div>
    <vue-bread-crumb :header="header" />
    <vue-nav>
        <ul class="list">
            <li>
                <a v-on:click="clickButton('nhapmoi')" :class="{ disabled: !button.nhapmoi }">
                    <span class="one-file-plus2"></span> Nhập mới (F5) </a>
            </li>
            <li>
                <a v-on:click="clickButton('ghilai')" :class="{ disabled: !button.ghilai }">
                    <span class="one-save"></span> Ghi lại (F9)
                </a>
            </li>
            <li>
                <a v-on:click="clickButton('huy')" :class="{ disabled: !button.huy }">
                    <span class="one-cancel"></span> Hủy
                </a>
            </li>
            <li>
                <a v-on:click="clickButton('xoaHD')" :class="{ disabled: !button.xoaHD }">
                    <span class="fa fa-times"></span> Xóa HĐ (F8)
                </a>
            </li>
            <li>
                <a v-on:click="clickButton('thanhtoan')" :class="{ disabled: !button.thanhtoan }">
                    <span class="fa fa-database"></span> Thanh toán
                </a>
            </li>
            
        </ul>
        <div class="col-sm-5 col-12 p-2" style="display: flex; position: absolute; right: 7px; transform: translate(0, -2px)">
            <div class="col-sm-6 col-12">
                <div class="info-row">
                    <div class="key w90">
                        Ngày yêu cầu
                    </div>
                    <vue-date labelWidth="0" v-model="form.ngay_yc" type="date" format="DD/MM/YYYY">
                    </vue-date>
                </div>
            </div>
            <div class="col-sm-6 col-12">
                <div class="info-row">
                    <div class="key w70">
                        Tổng tiền
                    </div>
                    <input type="text" class="form-control tright" v-model="form.tong_tien" />
                </div>
            </div>
        </div>
    </vue-nav>
    <div class="page-content">
        
        <div class="box-form">
            
            <div class="row">
                <div class="col-sm-6 col-12">
                    <!-- THONG TIN KHACH HANG -->
                    <div class="box-form">
                        <!-- THONG TIN KHACH HANG -->
                        <div class="legend-title">
                            <span class="pointer icon fa fa-angle-up"></span>
                            Thông tin thanh toán
                            <div class="clearfix"></div>
                        </div>
                        <b-row>
                            <div class="col-sm-6 col-12">
                                <div class="info-row">
                                    <div class="key w120">Mã giao dịch</div>
                                    <div class="value">
                                        <div class="input-more-button">
                                            <button class="btn" @click="openSearchContract">
                                                <span class="-ap icon-more_horiz"></span>
                                            </button>
                                            <input type="text" class="form-control" v-model="TTTT.ma_gd" @keyup.enter.prevent="txtMaGD_KeyPress"/> 
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-sm-6 col-12">
                                <div class="info-row">
                                    <div class="key w80">
                                        Ngày YC
                                    </div>
                                    <vue-date labelWidth="0" v-model="TTTT.ngay_yc" type="date" format="DD/MM/YYYY">
                                    </vue-date>
                                </div>
                            </div>
                            <div class="col-sm-12 col-12">
                                <div class="info-row">
                                    <div class="key w120">Mã HĐ</div>
                                    <div class="value">
                                        <input type="text" class="form-control" v-model="TTTT.ma_hd" />
                                    </div>
                                </div>
                            </div>
                            <div class="col-sm-12 col-12">
                                <div class="info-row">
                                    <div class="key w120">Mã thuê bao</div>
                                    <div class="value">
                                        <div class="input-more-button">
                                            <button class="btn" @click="OpenpopupModalNormalizeCAinformation">
                                                <span class="-ap icon-more_horiz"></span>
                                            </button>
                                            <input type="text" class="form-control" v-model="TTTT.ma_tb" @keyup.enter.prevent="txtMaTB_KeyPress"/>
                                        </div>
                                        
                                    </div>
                                </div>
                            </div>
                            <div class="col-sm-12 col-12">
                                <div class="info-row">
                                    <div class="key w120 nowrap">Địa chỉ</div>
                                    <!-- <ejs-textbox v-model="form.ma_tb" /> -->
                                    <div class="value">
                                        <div class="input-more-button">
                                            <a @click="btnChonbando" class="btn">
                                                <span class="one-map-location f20"></span>
                                            </a>
                                            <ejs-textbox cssClass="font-weight-bold" v-model="TTTT.dia_chi"></ejs-textbox>
                                        </div>
                                    </div>
                                    <!-- <div class="value">
                                        
                                        <div class="input-more-button">
                                            <button class="btn">
                                                <span class="-ap icon-more_horiz"></span>
                                            </button>
                                            <input type="text" class="form-control" v-model="TTTT.dia_chi" />
                                        </div>
                                    </div> -->
                                </div>
                            </div>
                            <div class="col-sm-12 col-12">
                                <div class="info-row">
                                    <div class="key w120">Dịch vụ</div>
                                    <div class="value">
                                        <SelectExt v-model="TTTT.dich_vu" :allowFiltering="true" data-text-field="TEN_DVVT"
                                            data-value-field="DICHVUVT_ID"
                                            :dataSource="cbDichVu" @change='changeDV'/>
                                    </div>
                                </div>
                            </div>
                            <div class="col-sm-12 col-12">
                                <div class="info-row">
                                    <div class="key w120">Ghi chú</div>
                                    <div class="value">
                                        <input type="text" class="form-control" v-model="TTTT.ghi_chu" />
                                    </div>
                                </div>
                            </div>
            
                            <div class="col-sm-12 col-12">
                                <div class="info-row">
                                    <div class="key w120">Giá gói</div>
                                    <div class="value">
                                        <input type="text" @keypress="onlyNumber" class="form-control" v-model="TTTT.gia_goi" />
                                    </div>
                                </div>
                            </div>
                        </b-row>
                    </div>
                    <!-- THÔNG TIN THIẾT BỊ -->
                    <div class="box-form">
                        <ejs-tab id="tab_default">
                            <div class="e-tab-header">
                                <div>{{headerText0.text}}</div>
                                <!-- <div>{{headerText1.text}}</div> -->
                            </div>
                            <div class="e-content">
                                <!-- tab 1 -->
                                <div>
                                    <div class="mt-3">
                                        <b-row>
                                            <div class="col-sm-12 col-12 mb-3">
                                                <div class="info-row">
                                                    <div class="value">
                                                        <div class="input-more-button">
                                                            <button class="btn" @click="btnLayThietBi_Click">
                                                                <span class="-ap icon-more_horiz"></span>
                                                            </button>
                                                            <div id='container'>
                                                                <ejs-listbox :dataSource='TBI.txtareaTBI' height='100px' locale="vi-VN"></ejs-listbox>
                                                            </div>
                                                            <!-- <textarea type="text" class="form-control" v-model="TBI.txtareaTBI"></textarea> -->
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-sm-6 col-12">
                                                <div class="info-row">
                                                    <div class="key w120">Tổng tiền</div>
                                                    <div class="vlaue">
                                                        <div class="input-more-button">
                                                            <input type="text" class="form-control text-right" v-model="TBI.tong_tien"/>
                                                            <button class="btn" @click="OpenpopupTienKM">
                                                                <span class="-ap icon-more_horiz"></span>
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-sm-6 col-12">
                                                <div class="info-row">
                                                    <div class="key w20">Vat</div>
                                                    <div class="value">
                                                        <input type="text" class="form-control text-right" v-model="TBI.vat" />
                                                    </div>
                                                </div>
                                            </div>
                                        </b-row>
                                    </div>
                                </div>
                                <!-- tab 2 -->
                                <!-- <div>
                                    <div class="box-form mt-3">
                                        <b-row>
                                            <div class="col-sm-12 col-12">
                                                <div class="info-row">
                                                    <div class="value">
                                                        <div class="input-more-button">
                                                            <button class="btn">
                                                                <span class="-ap icon-more_horiz"></span>
                                                            </button>
                                                            <div id='container'>
                                                                <ejs-listbox :dataSource='TBI.txtareaVatTu' height='100px' locale="vi-VN"></ejs-listbox>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </b-row>
                                    </div>
                                </div> -->
                            </div>
                        </ejs-tab>
                        <!-- <ejs-tab id='element'>
                            <e-tabitems>
                                <e-tabitem :header='headerText0' :content="content0" :selectedItem="selected"></e-tabitem>
                                <e-tabitem :header='headerText1' :content="content1"></e-tabitem>
                                
                            </e-tabitems>
                        </ejs-tab> -->
                    </div>
                </div>
                <div class="col-sm-6 col-12">
                    <div class="box-form">
                        <!-- THONG TIN KHACH HANG -->
                        <div class="legend-title">
                            <span class="pointer icon fa fa-angle-up"></span>
                            <div class="clearfix"></div>
                        </div>
                        <b-row>
                            <div class="col-sm-12 col-12">
                                <div class="info-row">
                                    <div class="key w120">Mã khách hàng</div>
                                    <div class="value">
                                        <input type="text" class="form-control" v-model="TTTT.ma_kh" />
                                    </div>
                                </div>
                            </div>
                            <div class="col-sm-12 col-12">
                                <div class="info-row">
                                    <div class="key w120">
                                        tên khách hàng
                                    </div>
                                    <div class="value">
                                        <input type="text" class="form-control" v-model="TTTT.ten_kh" />
                                    </div>
                                </div>
                            </div>
                            <div class="col-sm-12 col-12">
                                <div class="info-row">
                                    <div class="key w120">Tên thuê bao</div>
                                    <div class="value">
                                        <input type="text" class="form-control" v-model="TTTT.ten_tb" />
                                    </div>
                                </div>
                            </div>
                            <div class="col-sm-12 col-12">
                                <div class="info-row">
                                    <div class="key w120 nowrap">Địa chỉ lắp đặt</div>
                                    <!-- <ejs-textbox v-model="TTTT.ma_tb" /> -->
                                    <div class="value">
                                        <div class="input-more-button">
                                            <a @click="btnChonbando" class="btn">
                                                <span class="one-map-location f20"></span>
                                            </a>
                                            <ejs-textbox cssClass="font-weight-bold" v-model="TTTT.diachi_ld"></ejs-textbox>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-sm-12 col-12">
                                <div class="info-row">
                                    <div class="key w120">Loại hình</div>
                                    <div class="value">
                                        <SelectExt v-model="TTTT.loai_hinh" :allowFiltering="true" data-text-field="LOAIHINH_TB"
                                            data-value-field="LOAITB_ID" :dataSource="cbLoaiHinh" />
                                    </div>
                                </div>
                            </div>
                            <div class="col-sm-12 col-12">
                                <div class="info-row">
                                    <div class="key w120">Trạng thái TB</div>
                                    <div class="value">
                                        <input type="text" class="form-control" v-model="TTTT.trang_thaitb" />
                                        <!-- <SelectExt v-model="TTTT.trang_thaitb" :allowFiltering="true" data-text-field="ketqua_xl" 
                                            data-value-field="kqxl_id"
                                            :dataSource="cbTrangThaiTB" /> -->
                                    </div>
                                </div>
                            </div>
                    
                            <div class="col-sm-12 col-12">
                                <div class="info-row">
                                    <div class="key w120">Kiểu yêu cầu</div>
                                    <div class="value">
                                        <SelectExt v-model="TTTT.kieu_yc" :allowFiltering="true" data-text-field="ten_kieuld" 
                                            data-value-field="kieuld_id"
                                            :dataSource="cbKieuYC" />
                                    </div>
                                </div>
                            </div>
                        </b-row>
                    </div>
                    <div class="box-form">
                        <div class="legend-title">
                            <span class="pointer icon fa fa-angle-up"></span>
                            Thông tin đính kèm
                        </div>
                        <b-row>
                            <div class="col-sm-12 col-12 mb-3">
                                <div class="info-row">
                                    <div class="value">
                                        <div class="input-more-button">
                                            <button class="btn" @click="btnDinhKemChiTiet_Click">
                                                <span class="-ap icon-more_horiz"></span>
                                            </button>
                                            <div id='container'>
                                                <ejs-listbox :dataSource='TTDK.txtareaTB' height='100px' locale="vi-VN"></ejs-listbox>
                                            </div>
                                            <!-- <textarea type="text" class="form-control" v-model="TTDK.txtareaTB" ></textarea>  -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-sm-12 col-12">
                                <div class="info-row">
                                    <div class="key w120">Tổng doanh thu</div>
                                    <div class="value">
                                        <input type="text" class="form-control" v-model="TTDK.tong_doanh_thu" />
                                    </div>
                                </div>
                            </div>
                        </b-row>
                    </div>
                </div>
            </div>

            <!-- <ejs-splitter id='splitter' ref='splitterObj' height='200px'>
                <e-panes>
                    <e-pane :collapsible=true :content="contentTTKHLeft" min='30%' max='60%'>
                    </e-pane>
                    <e-pane :collapsible=true :content="contentTTKHRight" min='30%' max='60%'>
                    </e-pane>
                </e-panes>
            </ejs-splitter> -->

        </div>

        <div class="box-form">
            <div class="legend-title">
                <span class="pointer icon fa fa-angle-up"></span> Thông tin đơn vị
            </div>
            <!-- <div class="row" v-if="TTTT.kieu_yc == 49">
                <div class="col-sm-12 col-12">
                    <div class="info-row">
                        <div class="key w120">Trạm thi công</div>
                        <div class="value">
                            <SelectExt v-model="TTDV.tram_thicong" :allowFiltering="true" data-text-field="ten_loaidv" 
                            data-value-field="loaidv_dich_id"
                                :dataSource="cbTram" />
                        </div>
                    </div>
                </div>
            </div> -->
            <div class="row">
                <div class="col-sm-12 col-12">
                    <div class="info-row">
                        <div class="key w120">Trạm thi công</div>
                        <div class="value">
                            <SelectExt v-model="TTDV.tram_thicong" :allowFiltering="true" data-text-field="ten_dv"
                                data-value-field="donvi_id" :dataSource="cbTram" />
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="box-form">
        
            <div class="legend-title">
                <span class="pointer icon fa fa-angle-up"></span> Danh sách/hợp đồng thiết bị
            </div>
            <DataGrid 
                        ref="grid" 
                        :searchSettings="{fields: ['ma_tb']}" 
                        :showFilter="true" :allowPaging="true" 
                        :enablePagingServer="false"
                        :dataSource="options.hopdong" 
                        :columns="config.hopdong" />
            <!-- <b-model ref="dialogGiaoPhieuNV" hide-footer title="Giao phiếu nhân viên">
                        <GiaoPhieuNV />
                    </b-model> -->
            <!-- <ejs-dialog :visible='false' ref="dialogGiaoPhieuNV" :header='"Giao phiếu nhân viên"' showCloseIcon=true width='80%'
                target='#app .main-wrapper'>
                <GiaoPhieuNV />
            </ejs-dialog> -->
        </div>

        <!-- popup hop dong, phu luc -->
        <SearchContractModal ref="popupSearchContract" @accept="acceptSearchContract" 
        :loai_hd_id="loai_hd_id" :trangthai_hd="trangthai_hd" :ngay_yc="ngay_yc"/>
        <ModalNormalizeCAinformation ref="popupModalNormalizeCAinformation" @xacnhan="acceptMaTB"/>

        <!-- devices -->
        <b-modal
            ref="popupBuyDevices"
            id="frmCTMuaTBI"
            size="xl"
            hide-header
            
            hide-footer
            body-class="p-0"
        >
            <div class="modal-content popup-box">
                <div class="popup-header">
                    <div class="title">
                        <span class="icon one-notepad"></span> Mua thiết bị
                    </div>
                    <div class="close -ap icon-close" data-dismiss="modal" @click="hideModalBuyDevice"></div>
                </div>
                <ModalBuyDevices :dulieu="dataDevice" @form-close="closeFormDevice"/>

            </div>
        </b-modal>
        <b-modal ref="popupChooseDevices" id="frmChonTbi" size="xl" hide-header hide-footer body-class="p-0">
            <div class="modal-content popup-box">
                <div class="popup-header">
                    <div class="title">
                        <span class="icon one-notepad"></span> Chọn thiết bị
                    </div>
                    <div class="close -ap icon-close" data-dismiss="modal" @click="hideModalChooseDevice"></div>
                </div>
                <ModalChooseDevices :dulieu="dataDevice" @form-close="closeFormChooseDevice" />
            </div>
        </b-modal>
        <!-- TIEN KM -->
        <b-modal ref="popupTienKM" id="frmCT_TienKM" size="xl" hide-header hide-footer body-class="p-0">
            <div class="modal-content popup-box">
                <!-- <div class="popup-header">
                    <div class="title">
                        <span class="icon one-notepad"></span> Chi tiết tiền khoản mục
                    </div>
                    <div class="close -ap icon-close" data-dismiss="modal" @click="hideModalTienKM"></div>
                </div> -->
                <ModalTienKM :dulieu="dataTienKM" @form-close="closeFormTienKM"/>
            </div>
        </b-modal>

        <!-- THANH TOAN HD -->
        <b-modal ref="popupPayment" id="frmThanhToanHD" size="xl" hide-header hide-footer body-class="p-0">
            <div class="modal-content popup-box">
                <PayMent />
            </div>
        </b-modal>

        <!-- DIA CHI THUE BAO -->
        <!-- <b-modal ref="showModalMap" id="modal-center-map" style="width: 600px" modal-class="popup-box"
            header-class="popup-header" body-class="none-padding" size="lg" hide-footer centered :title="
                map.lat * map.lng
                ? map.lat + ',' + map.lng
                : 'Vị trí tương đối theo địa chỉ: ' + map.description">
            <Map :lat="map.lat" :lng="map.lng" :description="map.dia_chi" :hdtb_id="this.model.hdtb_id" :mode="modeMap" />
        </b-modal> -->

        <!-- CHỌN TOA DO  -->
        <ModalChonToaDo idModalChonToaDo="ModalChonToaDo" @XacNhanToaDo="XacNhanToaDo" :position="map" :diachi="TTTT.dia_chi"
            :ten_kc="'Vị trí tương đối theo địa chỉ:\r\n' + TTTT.ma_tb"></ModalChonToaDo>

        <!-- POPUP THONG TIN DINH KEM -->
        <b-modal ref="popupDinhKem" id="frmCT_TienKM" size="xl" hide-header hide-footer body-class="p-0">
            <div class="modal-content popup-box">
                <!-- <div class="popup-header">
                            <div class="title">
                                <span class="icon one-notepad"></span> Chi tiết tiền khoản mục
                            </div>
                            <div class="close -ap icon-close" data-dismiss="modal" @click="hideModalTienKM"></div>
                        </div> -->
                <ModalDinhKem :dulieu="dataDinhKem" @form-close="closeFormDinhKem" />
            </div>
        </b-modal>
    </div>
</div>