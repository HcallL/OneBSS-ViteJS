<div class="main-wrapper">
  <breadcrumb :header="header"/>
  <div class="list-actions-top" style="position: unset;">
    <ul class="list" style="position: unset;">

      <li class="disabled" style="cursor:pointer;" v-if="!tsbtnNhapMoi">
        <a class="disabled-color">
          <span class="icon one-file-plus"></span>Nhập mới
        </a>
      </li>
      <li style="cursor:pointer;" v-if="tsbtnNhapMoi" @click="tsbtnNhapMoi_Click">
        <a>
          <span class="icon one-file-plus"></span>Nhập mới
        </a>
      </li>

      <li class="disabled" style="cursor:pointer;" v-if="!tsbtnGhiLai">
        <a class="disabled-color">
          <span class="icon one-save"></span>Ghi lại
        </a>
      </li>
      <li style="cursor:pointer;" v-if="tsbtnGhiLai" @click="tsbtnGhiLai_Click">
        <a>
          <span class="icon one-save"></span>Ghi lại
        </a>
      </li>

      <li class="disabled" style="cursor:pointer;" v-if="!tsbtnHuy">
        <a class="disabled-color">
          <span class="icon fa fa-close"></span>Huỷ bỏ
        </a>
      </li>
      <li style="cursor:pointer;" v-if="tsbtnHuy" @click="tsbtnHuy_Click">
        <a>
          <span class="icon fa fa-close"></span>Huỷ bỏ
        </a>
      </li>

      <li class="disabled" style="cursor:pointer;" v-if="!tsbtnXoa">
        <a class="disabled-color">
          <span class="icon one-trash"></span>Xoá HĐ
        </a>
      </li>
      <li style="cursor:pointer;" v-if="tsbtnXoa" @click="tsbtnXoa_Click">
        <a>
          <span class="icon one-trash"></span>Xoá HĐ
        </a>
      </li>

      <li class="disabled" style="cursor:pointer;" v-if="!tsbtnHoanThien">
        <a class="disabled-color">
          <span class="icon fa fa-check-circle"></span>Hoàn thiện <span class="fa fa-angle-down text-desc"></span>
        </a>
      </li>
      <li style="cursor:pointer;" v-if="tsbtnHoanThien" @click="myFunction" class="dropbtn">
        <a>
          <span class="icon fa fa-check-circle"></span>Hoàn thiện
          <span class="fa fa-angle-down text-desc"></span>
        </a>

        <div id="myDropdown" class="dropdown-content">
          <a @click="btnDuyet_Click" class="dropdown-item"><span class="icon fa fa-check"></span>Duyệt</a>
          <a @click="btnKoDuyet_Click" class="dropdown-item"><span class="icon fa fa-close"></span>Không duyệt</a>
        </div>

      </li>

      <li class="disabled" style="cursor:pointer;" v-if="!tsbtnHuyVTCI">
        <a class="disabled-color">
          <span class="icon one-file-cancel"></span>Huỷ viễn thông công ích
        </a>
      </li>
      <li style="cursor:pointer;" v-if="tsbtnHuyVTCI" @click="tsbtnHuyVTCI_Click">
        <a>
          <span class="icon one-file-cancel"></span>Huỷ viễn thông công ích
        </a>
      </li>

      <li class="disabled" style="cursor:pointer;" v-if="!tsbtnInPhieu">
        <a class="disabled-color">
          <span class="icon one-print"></span>In phiếu
        </a>
      </li>
      <li style="cursor:pointer;" v-if="tsbtnInPhieu">
        <a>
          <span class="icon one-print"></span>In phiếu
        </a>
      </li>
    </ul>
  </div>
  <div class="page-content">
    <div class="row">
      <div class="col-sm-6 col-12">
        <div class="box-form">
          <div class="legend-title">Thông tin thuê bao</div>
          <div class="row">
            <div class="col-sm-6 col-12">
              <div class="info-row">
                <div class="key w90">Dịch vụ</div>
                <div class="value">
                  <div class="select-custom">
                    <SelectExt
                      dataValueField="dichvuvt_id"
                      dataTextField="ten_dvvt"
                      v-model="cboDichVuVT.value"
                      :settings="{ dropdownParent: $refs['dichvuvt_id'] }"
                      :dataSource="cboDichVuVT.option"
                      @change="cboDichVuVT_EditValueChanged"
                    />
                  </div>
                </div>
              </div>
              <div class="info-row">
                <div class="key w90">Số máy/Acc</div>
                <div class="value">
                  <div class="input-more-button -left">
                    <button class="btn" @click="btnTraCuuTB_Click">
                      <span class="-ap icon-more_horiz"></span>
                    </button>
                    <input v-model="txtMaTB" type="text" class="form-control highlight"
                           v-on:keyup.enter="txtMaTB_KeyPress">

                    <b-modal ref="popupSearchAccount" size="xl" hide-footer hide-header hide-header-close
                             body-class="modal-body p-0 frm-chon-port">
                      <SearchAccount @form-close="acceptSearchAccount" :isPopup="true"/>
                    </b-modal>

                  </div>
                </div>
              </div>
            </div>
            <div class="col-sm-6 col-12">
              <div class="info-row">
                <div class="key w90">Loại hình</div>
                <div class="value">
                  <div class="select-custom">
                    <SelectExt
                      dataValueField="LOAITB_ID"
                      dataTextField="LOAIHINH_TB"
                      v-model="cboLoaiHinhTB.value"
                      :settings="{ dropdownParent: $refs['LOAITB_ID'] }"
                      :dataSource="cboLoaiHinhTB.option"
                    />
                  </div>
                </div>
              </div>
              <div class="info-row">
                <div class="key w90">Tên TB</div>
                <div class="value">
                  <input v-model="txtTenTB" type="text" class="form-control">
                </div>
              </div>
            </div>

          </div>
          <div class="info-row">
            <div class="key w90">Địa chỉ TB</div>
            <div class="value">
              <input v-model="txtDiaChiTB" type="text" class="form-control">
            </div>
          </div>
          <div class="row">
            <div class="col-sm-6 col-12">
              <div class="info-row">
                <div class="key w90">Mã KH</div>
                <div class="value">
                  <input v-model="txtMaKH" type="text" class="form-control">
                </div>
              </div>
              <div class="info-row">
                <div class="key w90">Loại KH</div>
                <div class="value">
                  <input v-model="txtLoaiKH" type="text" class="form-control">
                </div>
              </div>
            </div>
            <div class="col-sm-6 col-12">
              <div class="info-row">
                <div class="key w90">Tên KH</div>
                <div class="value">
                  <input v-model="txtTenKH" type="text" class="form-control">
                </div>
              </div>
              <div class="info-row">
                <div class="key w90">Ngành nghề</div>
                <div class="value">
                  <input v-model="txtNganhNghe" type="text" class="form-control">
                </div>
              </div>
            </div>

          </div>

        </div>
      </div>
      <div class="col-sm-6 col-12">
        <div class="box-form">
          <div class="legend-title">Thông tin công ích</div>
          <div class="row">
            <div class="col-sm-6 col-12">
              <div class="info-row">
                <div class="key w90">Mã chủ hộ</div>
                <div class="value">
                  <input v-model="txtMaCH" type="text" class="form-control">
                </div>
              </div>
              <div class="info-row">
                <div class="key w90">Gói VTCI</div>
                <div class="value">
                  <div class="select-custom">
                    <SelectExt
                      dataValueField="goi_id"
                      dataTextField="ten_goi"
                      v-model="cboGoiVTCI.value"
                      :settings="{ dropdownParent: $refs['goi_id'] }"
                      :dataSource="cboGoiVTCI.option"
                      @change="cboGoiVTCI_EditValueChanged"
                    />
                  </div>
                </div>
              </div>
              <div class="info-row">
                <div class="key w85">Tháng BĐ</div>
                <div class="value">
                  <vue-date v-model="deThangBD" :format="dateFormat" type="Date" labelWidth="120"
                            label=""
                            readonly></vue-date>
                </div>
              </div>
            </div>
            <div class="col-sm-6 col-12">
              <div class="info-row">
                <div class="key w90">Tên chủ hộ</div>
                <div class="value">
                  <input v-model="txtTenCH" type="text" class="form-control">
                </div>
              </div>
              <div class="info-row">
                <div class="key w90">Tiền hỗ trợ</div>
                <div class="value">
                  <!--                  <input v-model="txtTienHoTro" type="text" class="form-control" style="text-align: right" disabled>-->
                  <vue-numeric class="form-control"
                               empty-value="0"
                               :precision="4"
                               :decimal-separator="'.'"
                               maxlength="6"
                               v-model="txtTienHoTro"
                               :minus="false"
                               :separator="','"
                               disabled style="text-align: right"></vue-numeric>
                </div>
              </div>
              <div class="info-row">
                <div class="key w85">Tháng KT</div>
                <div class="value">
                  <vue-date v-model="deThangKT" :format="dateFormat" type="Date" labelWidth="0"
                            label=""
                            readonly></vue-date>
                </div>
              </div>
            </div>

          </div>
          <div class="info-row">
            <div class="key w90">Ghi chú</div>
            <div class="value">
              <input v-model="txtGhiChu" type="text" class="form-control">
            </div>
          </div>
          <div class="info-row">
            <div class="key w95">
              <a class="link underline inline padt7" style="cursor: pointer" @click="uploadFile">Chọn file</a>
              <input ref="inputFile" type="file" id="upload" style="display:none" @change="importFile"
                     accept=".xls, .xlsx"/>
            </div>
            <div class="table-content">
              <!--              <table class="table-result table-gachle table-filter">-->
              <!--                <tbody>-->
              <!--                <tr v-for="item in gcDSFile" :key="item.name">-->
              <!--                  <td class="w20 center">-->
              <!--                  </td>-->
              <!--                  <td>{{ item.name }}</td>-->
              <!--                  <td class="nowrap w30 center">-->
              <!--                    <a class="act" @click="removeFile(item.name)" style="cursor: pointer">-->
              <!--                      <span class="icon nc fa fa-remove"></span>-->
              <!--                    </a>-->
              <!--                    <a class="act" style="cursor: pointer">-->
              <!--                      <span class="icon nc fa fa-download"></span>-->
              <!--                    </a>-->
              <!--                  </td>-->
              <!--                </tr>-->
              <!--                </tbody>-->
              <!--              </table>-->

              <DataGrid
                :columns="[
                            {fieldName: 'file_name', headerText: '', allowFiltering: true},
                            {fieldName: '', headerText: '', allowFiltering: false, template: this.getColumnAction(this), width: 20 }
                          ]"
                ref="dataGridFile"
                v-bind:dataSource="gcDSFile"
                :showColumnCheckbox="false"
                :enable-paging-server="false"
                :allowPaging="true"
                :showFilter="false"
                :pageSize="3"
                :enabledSelectFirstRow="false"
                :visibleHeader="false"
              />

            </div>
          </div>


        </div>
      </div>
    </div>

    <div class="box-form">
      <div class="legend-title">Danh sách biến động</div>
      <div class="row">
        <div class="col-sm-9 col-12">
          <div class="info-row">
            <div class="key" style="width: 80px;">
              <div class="check-action">
                <input v-model="chkTatCa" type="checkbox" class="check" @change="chkTatCa_CheckedChanged">
                <span class="name">Tất cả</span>
              </div>
            </div>
            <div class="key" style="width: 80px;">
              <div class="check-action">
                <input v-model="chkHieuLuc" type="checkbox" class="check" @change="chkHieuLuc_CheckedChanged">
                <span class="name">Hiệu lực</span>
              </div>
            </div>
            <div class="key w100" style="padding-left: 7px;">
              <div class="check-action">
                <input v-model="chkTrangThai" type="checkbox" class="check">
                <span class="name">Trạng thái</span>
              </div>
            </div>
            <div class="value">
              <div class="select-custom">
                <SelectExt
                  dataValueField="status_id"
                  dataTextField="status"
                  v-model="cboTrangThai.value"
                  :settings="{ dropdownParent: $refs['status_id'] }"
                  :dataSource="cboTrangThai.option"
                  @change="cboTrangThai_EditValueChanged"
                />
              </div>
            </div>
            <div class="key w90" style="padding-left: 7px;">
              <div class="check-action">
                <input v-model="chkGoiTK" type="checkbox" class="check">
                <span class="name">Gói VTCI</span>
              </div>
            </div>
            <div class="value">
              <div class="select-custom">
                <SelectExt
                  dataValueField="goi_id"
                  dataTextField="ten_goi"
                  v-model="cboGoi_TK.value"
                  :settings="{ dropdownParent: $refs['goi_id'] }"
                  :dataSource="cboGoi_TK.option"
                  @change="cboGoi_TK_EditValueChanged"
                />
              </div>
            </div>
            <div class="key w100" style="padding-left: 7px;">
              <div class="check-action">
                <input v-model="chkThangBD" type="checkbox" class="check">
                <span class="name">Tháng BĐ</span>
              </div>
            </div>
            <div class="value w100">
              <vue-date v-model="deThangBD_TK" :format="dateFormat" type="Date" labelWidth="120"
                        label="" @change="deThangBD_TK_EditValueChanged"></vue-date>
            </div>


          </div>

        </div>
        <div class="col-sm-3 col-12">
          <div class="info-row">
            <div class="key w100">
              <div class="check-action">
                <input v-model="chkThangKT" type="checkbox" class="check">
                <span class="name">Tháng KT</span>
              </div>
            </div>
            <div class="value w100">
              <vue-date v-model="deThangKT_TK" :format="dateFormat" type="Date" labelWidth="120"
                        label="" @change="deThangKT_TK_EditValueChanged"></vue-date>
            </div>
            <div class="value tright left">
              <button class="btn btn-second" style="min-width: 100px;" @click="btnTimKiem_Click">
                <span class="icon one-search"></span> Tìm kiếm
              </button>
            </div>


          </div>

        </div>
      </div>

      <div class="table-content">
        <DataGrid
          :columns="[
                            {fieldName: 'trangthai', headerText: 'Trạng thái', allowFiltering: true},
                            {fieldName: 'ma_tb', headerText: 'Số máy/Account', allowFiltering: true},
                            {fieldName: 'ten_dvvt', headerText: 'Dịch vụ', allowFiltering: true},
                            {fieldName: 'loaihinh_tb', headerText: 'Loại hình', allowFiltering: true},
                            {fieldName: 'ma_ch', headerText: 'Mã chủ hộ', allowFiltering: true},
                            {fieldName: 'ten_ch', headerText: 'Tên chủ hộ', allowFiltering: true},
                            {fieldName: 'ten_goi', headerText: 'Gói VTCI', allowFiltering: true},
                            {fieldName: 'tien_ht', headerText: 'Tiền hỗ trợ', allowFiltering: true},
                            {fieldName: 'thang_bd', headerText: 'Tháng BĐ', allowFiltering: true},
                            {fieldName: 'thang_kt', headerText: 'Tháng KT', allowFiltering: true},
                            {fieldName: 'thang_huy', headerText: 'Tháng hủy', allowFiltering: true},
                            {fieldName: 'hieuluc', headerText: 'Hiệu lực', allowFiltering: true, template: this.getColumnHieuLuc(this)},
                            {fieldName: 'nguoi_cn', headerText: 'Người CN', allowFiltering: true}
                          ]"
          ref="dataGrid"
          v-bind:dataSource="gcDs"
          :showColumnCheckbox="false"
          :enable-paging-server="false"
          :allowPaging="true"
          :enabled-select-first-row="true"
          :showFilter="true"
          @selectedItemsChanged="grvDs_FocusedRowChanged"
          @rowClicked="focusItem"
        />
      </div>
      <!--      @rowSelected="grvDs_FocusedRowChanged"-->

    </div>
  </div>


</div>
