<div class="main-wrapper">
    <div class="breadcrumb-top">
        <div class="main-title">{{ header.title }}</div>
        <ul class="breadcrumb">
            <li class="breadcrumb-item"><a href="/"><span class="nc-icon-outline ui-1_home-simple"></span> Trang chủ
                </a></li>
            <li class="breadcrumb-item"><a href="javascript: void(0)" class="router-link-active">Xử lý thuê bao</a></li>
            <li class="breadcrumb-item"><a href="javascript: void(0)" class="router-link-active">Danh sách thuê bao không khóa mở</a></li>
        </ul>
    </div>
    <div class="list-actions-top">
        <ul class="list">
            <li>
                <a href="javascript: void(0)" @click="onLayDS(1)" title="Lấy lại danh sách đã lưu">
                    <span class="icon one-file-attach1"></span>Lấy DS
                </a>
                <PopupDanhSachThueBao :input="TTThueBao_Items" @acceptChange="selectThueBao" ref="dlgDanhsachthuebao"></PopupDanhSachThueBao>
            </li>
            <li>
                <a href="javascript: void(0)" @click="onNhapMoi" :class="{'disabled': !nhapMoiBtnEnable}" title="Nhập mới">
                    <span class="icon one-file-plus"></span>Nhập mới
                </a>
            </li>
            <li>
                <a href="javascript: void(0)" @click="onGhiLai" :class="{'disabled': !ghiLaiBtnEnable}" title="Ghi lại">
                    <span class="icon one-save"></span>Ghi lại
                </a>
            </li>
            <li>
                <a href="javascript: void(0)" @click="onHuy" :class="{'disabled': !huyBoBtnEnable}" title="Hủy">
                    <span class="icon nc-icon-glyph ui-1_circle-remove"></span>Huỷ
                </a>
            </li>
            <li>
                <a href="javascript: void(0)" @click="onXoa" :class="{'disabled': !xoaBtnEnable}" title="Xóa">
                    <span class="icon one-trash"></span>Xoá
                </a>
            </li>
            <li>
                <a href="javascript: void(0)" @click="openDocFileThem" title="Đọc file thêm">
                    <span class="icon one-book"></span>Đọc file Thêm
                </a>
                <PopupDocFileDSKhoaMo :input="docFileThem_params" @acceptChange="onDocFileThem($event)" ref="dlgDocFileDSKhoaMo" />
            </li>
            <li>
                <a href="javascript: void(0)" @click="openXoaFileThem" title="Đọc file xóa">
                    <span class="icon one-file-find"></span>Đọc file Xoá
                </a>
                <PopupXoaFileDSKhoaMo :input="docFileThem_params" @acceptChange="onXoaFileThem($event)" ref="dlgXoaFileDSKhoaMo" />
            </li>
            <li>
                <a href="javascript: void(0)" @click="onXuatFile" title="Xuất file">
                    <span class="icon one-download"></span>Xuất File
                </a>
                <appModalXuatDuLieu
                    id="modal-xuat-file"
                    :thuocTinh="[
                        {fieldName: 'RDS_ID', headerText: 'RDS_ID', allowFiltering: true, allowSorting: false, width: 100},
                        {fieldName: 'MA_TT', headerText: 'MA_TT', allowFiltering: true, allowSorting: false, width: 120},
                        {fieldName: 'THUEBAO_ID', headerText: 'THUEBAO_ID', allowFiltering: true, allowSorting: false, width: 120},
                        {fieldName: 'MA_TB', headerText: 'MA_TB', allowFiltering: true, allowSorting: false, width: 120},
                        {fieldName: 'LOAITB_ID', headerText: 'LOAITB_ID', allowFiltering: true, allowSorting: false, width: 120},
                        {fieldName: 'TEN_TB', headerText: 'TEN_TB', allowFiltering: true, allowSorting: false, width: 120},
                        {fieldName: 'LOAIHINH_TB', headerText: 'LOAIHINH_TB', allowFiltering: true, allowSorting: false, width: 120},
                        {fieldName: 'TRANGTHAI', headerText: 'TRANGTHAI', allowFiltering: true, allowSorting: false, width: 120},
                        {fieldName: 'NGAY_CN', headerText: 'NGAY_CN', allowFiltering: true, allowSorting: false, width: 120},
                        {fieldName: 'TEN_DVVT', headerText: 'TEN_DVVT', allowFiltering: true, allowSorting: false, width: 120},
                        {fieldName: 'NGAY_TH', headerText: 'NGAY_TH', allowFiltering: true, allowSorting: false, width: 120},
                        {fieldName: 'LYDO', headerText: 'LYDO', allowFiltering: true, allowSorting: false, width: 120},
                        {fieldName: 'GHICHU', headerText: 'GHICHU', allowFiltering: true, allowSorting: false, width: 120},
                        {fieldName: 'THANHTOAN_ID', headerText: 'THANHTOAN_ID', allowFiltering: true, allowSorting: false, width: 120},
                        {fieldName: 'DICHVUVT_ID', headerText: 'DICHVUVT_ID', allowFiltering: true, allowSorting: false, width: 120},
                        {fieldName: 'TRANGTHAI_TB', headerText: 'TRANGTHAI_TB', allowFiltering: true, allowSorting: false, width: 120},
                        {fieldName: 'NGUOI_CN', headerText: 'NGUOI_CN', allowFiltering: true, allowSorting: false, width: 120}
                    ]"
                    :data="TTTraCuu_grid.items"
                />
            </li>
        </ul>
    </div>
    <div class="page-content" style="top: 80px !important; padding-bottom: 56px;">
        <div class="box-form padt8 padb5">
            <div class="pull-right">
                <app-ky-cuoc :isDisabled=true></app-ky-cuoc>
            </div>
            <div class="clearfix"></div>
        </div>
        <div class="row">
            <div class="col-sm-4 col-12">
                <div class="box-form">
                    <div class="legend-title">Thông tin tra cứu</div>
                    <div class="row">
                        <div class="col-12">
                            <div class="info-row">
                                <div class="key w90">Loại DS</div>
                                <div class="value">
                                    <div class="select-custom">
                                        <select name="" id="" class="form-control" v-model="params.loaiDS_Selected">
                                            <option v-for="item in params.loaiDS_Options" :value="item.id">{{ item.text }}</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-12">
                            <div class="info-row">
                                <div class="key w90">Số máy/Acc</div>
                                <div class="value">
                                    <div class="input-more-button">
                                        <button class="btn" @click="showTraCuuDanhBa">
                                            <span class="-ap icon-more_horiz"></span>
                                        </button>
                                        <input type="text" class="form-control highlight" v-model="params.soMayAcc" @keyup.enter="onKeyPress" ref="soMayAcc" :class="{'is-invalid': $v.params.soMayAcc.$error }">
                                    </div>
                                    <PopupTraCuuDanhBa ref="dlgTraCuuDanhBa" @accept="acceptDanhBa"/>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-12">
                            <div class="info-row">
                                <div class="key w90">Tên TB</div>
                                <div class="value">
                                    <input type="text" class="form-control" v-model="params.tenTB" readonly>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-6 col-12">
                            <div class="info-row">
                                <div class="key w90" v-b-tooltip.hover.right title="Ngày thực hiện">
                                    <div class="check-action">
                                        <input type="checkbox" class="check" v-model="params.ngayTH_Checked">
                                        <span class="name">Ngày TH</span>
                                    </div>
                                </div>
                                <div class="value">
                                    <ejs-datepicker
                                        v-model="params.ngayTH"
                                        :value="params.today"
                                        :format="'dd/MM/y HH:mm'"
                                        :showClearButton="false"
                                        :placeholder="'Chọn ngày'"
                                        :enabled="params.ngayTH_Checked"
                                    >
                                    </ejs-datepicker>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-6 col-12">
                            <div class="info-row">
                                <div class="key w90">
                                    <div class="check-action">
                                        <input type="checkbox" class="check" v-model="params.denNgay_Checked">
                                        <span class="name">Đến ngày</span>
                                    </div>
                                </div>
                                <div class="value">
                                    <ejs-datepicker
                                        v-model="params.denNgay"
                                        :value="params.today"
                                        :format="'dd/MM/y HH:mm'"
                                        :showClearButton="false"
                                        :placeholder="'Chọn ngày'"
                                        :enabled="params.denNgay_Checked"
                                    >
                                    </ejs-datepicker>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-12">
                            <div class="info-row">
                                <div class="key w90">Lý do <BssRequiredMarker class="ml-1"/></div>
                                <div class="value">
                                    <input type="text" class="form-control" v-model="params.lyDo" ref="lyDo" :class="{'is-invalid': $v.params.lyDo.$error }">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-12">
                            <div class="info-row">
                                <div class="key w90">Ghi chú</div>
                                <div class="value">
                                    <textarea name="" id="" cols="30" rows="10" v-model="params.ghiChu" class="form-control" ref="ghiChu" style="height: 100px;resize: vertical;" :class="{'is-invalid': $v.params.ghiChu.$error }"></textarea>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-sm-8 col-12">
                <div class="box-form">
                    <div class="legend-title">Kết quả tìm kiếm</div>
                    <DataGrid v-bind:columns="[
                        {fieldName: 'MA_TB', headerText: 'Số máy/Acc', allowFiltering: true, allowSorting: false, width: 120, cssClass: 'text-left'},
                        {fieldName: 'TRANGTHAI_TB', headerText: 'Trạng thái', allowFiltering: true, allowSorting: false, width: 120, cssClass: 'trang-thai'},
                        {fieldName: 'TEN_DVVT', headerText: 'Dịch vụ', allowFiltering: true, allowSorting: false, width: 120},
                        {fieldName: 'LOAIHINH_TB', headerText: 'Loại hình', allowFiltering: true, allowSorting: false, width: 120},
                        {fieldName: 'TEN_TB', headerText: 'Tên thuê bao', allowFiltering: true, allowSorting: false, width: 120},
                        {fieldName: 'THANGNO', headerText: 'Tháng nợ', allowFiltering: true, allowSorting: false, width: 100},
                        {fieldName: 'TONGNO', headerText: 'Tổng nợ', allowFiltering: true, allowSorting: false, width: 100, cssClass: 'tien-tra', type: 'number', format: 'N0'}
                    ]"
                        v-bind:dataSource="TTThueBao_grid.items"
                        dataKeyField="MA_TB"
                        :selectionSettings="{checkboxOnly: true, type: 'Multiple'}"
                        :showFilter="true"
                        :allowPaging="true"
                        :enablePagingServer="false"
                        :showColumnCheckbox="true"
                        :enabledSelectFirstRow="false"
                        :aggregates="TBaggregatesColumns"
                        ref="thueBaoGrid"
                        @selectedItemsChanged="onTBItemsChecked"
                        :key="TTThueBao_grid.key"
                    >
                    </DataGrid>
                </div>
            </div>
        </div>
        <div class="box-form">
            <div class="legend-title">Thông tin tra cứu</div>
            <DataGrid v-bind:columns="[
                {fieldName: 'ISCHECK', headerText: '', allowSorting:false , allowFiltering:false, textAlign:'Center', width: 40, headerTemplate: columnsCheckboxAll, template: columnsCheckbox},
                {fieldName: 'MA_TB', headerText: 'Số máy/Acc', allowFiltering: true, allowSorting: false, width: 120, cssClass: 'text-left'},
                {fieldName: 'TRANGTHAI_TB', headerText: 'Trạng thái', allowFiltering: true, allowSorting: false, width: 120, cssClass: 'trang-thai'},
                {fieldName: 'TEN_DVVT', headerText: 'Dịch vụ', allowFiltering: true, allowSorting: false, width: 120},
                {fieldName: 'LOAIHINH_TB', headerText: 'Loại hình', allowFiltering: true, allowSorting: false, width: 120},
                {fieldName: 'TEN_TB', headerText: 'Tên thuê bao', allowFiltering: true, allowSorting: false, width: 120},
                {fieldName: 'LYDO', headerText: 'Lý do', allowFiltering: true, allowSorting: false, width: 120},
                {fieldName: 'DONVI_QL_TT', headerText: 'Đơn vị QL', allowFiltering: true, allowSorting: false, width: 120},
                {fieldName: 'NGUOI_CN', headerText: 'Người CN', allowFiltering: true, allowSorting: false, width: 120},
                {fieldName: 'NHANVIEN', headerText: 'Nhân viên', allowFiltering: true, allowSorting: false, width: 120},
                {fieldName: 'DONVI', headerText: 'Đơn vị', allowFiltering: true, allowSorting: false, width: 120},
                {fieldName: 'NGAY_TH', headerText: 'Ngày thực hiện', allowFiltering: true, allowSorting: false, width: 120, cssClass: 'text-right'},
                {fieldName: 'NGAY_TH_DEN', headerText: 'Ngày TH đến', allowFiltering: true, allowSorting: false, width: 120, cssClass: 'text-right'},
                {fieldName: 'TRANGTHAI', headerText: 'Trạng thái', allowFiltering: true, allowSorting: false, width: 120, cssClass: 'trang-thai'}
            ]"
                v-bind:dataSource="TTTraCuu_grid.items"
                dataKeyField="MA_TB"
                :showFilter="true"
                :allowPaging="true"
                :enablePagingServer="false"
                :showColumnCheckbox="false"
                :aggregates="TCaggregatesColumns"
                ref="traCuuGrid"
                @rowSelected="onTCRowSelected"
            >
            </DataGrid>
        </div>
    </div>
</div>
