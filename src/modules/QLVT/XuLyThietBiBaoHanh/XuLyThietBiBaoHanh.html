<div>
    <div class="breadcrumb-top">
        <div class="main-title">{{header.title}}</div>
        <div class="close -ap icon-close" data-dismiss="modal" @click="$router.push({path: 'MoHinhBaoHanhThietBi', query: { quytrinh_id: quytrinh_id, luongphieu_id: luong_id }})"></div>
    </div>

    <div class="page-content xulythietbibaohanh" style="top: 55px;">
        <div class="box-form">
            <div class="legend-title">Thông tin tiếp nhận bảo hành thiết bị</div>
            <div class="row">
                <div class="col-sm-6 col-12">
                    <div class="info-row">
                        <div class="key w130">Mã thuê bao</div>
                        <div class="value">
                            <input type="text" class="form-control" v-model="p_mathuebao" disabled="true">
                        </div>
                    </div>
                </div>
                <div class="col-sm-6 col-12">
                    <div class="info-row">
                        <div class="key w130">Đơn vị tiếp nhận</div>
                        <div class="value">
                            <input type="text" class="form-control" v-model="p_donvi" disabled="true">
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-sm-6 col-12">
                    <div class="info-row">
                        <div class="key w130">Tên thuê bao</div>
                        <div class="value">
                            <input type="text" class="form-control" v-model="p_tenthuebao" disabled="true">
                        </div>
                    </div>
                </div>
                <div class="col-sm-6 col-12">
                    <div class="info-row">
                        <div class="key w130">Nhân viên tiếp nhận </div>
                        <div class="value">
                            <input type="text" class="form-control" v-model="p_nhanvien" disabled="true">
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-sm-6 col-12">
                    <div class="info-row">
                        <div class="key w130">Địa chỉ</div>
                        <div class="value">
                            <input type="text" class="form-control" v-model="p_diachi" disabled="true">
                        </div>
                    </div>
                </div>
                <div class="col-sm-4 col-12">
                    <div class="info-row">
                        <div class="key w130">Ngày tiếp nhận</div>
                        <div class="value">
                            <input type="text" class="form-control" v-model="p_ngay_tn" disabled="true">
                        </div>
                    </div>
                </div>
                <div class="col-sm-2 col-12">
                    <div class="info-row">
                        <div class="key w130">Điện thoại LH</div>
                        <div class="value">
                            <input type="text" class="form-control" v-model="p_dienthoai_lh" disabled="true">
                        </div>
                    </div>
                </div>
            </div>
            <div class="legend-title mart10">Thông tin thiết bị bảo hành</div>
            <div class="row">
                <div class="col-sm-6 col-12">
                    <div class="info-row">
                        <div class="key w130">Kiểu bảo hành</div>
                        <div class="value">
                            <input type="text" class="form-control" v-model="p_kieubh" disabled="true">
                        </div>
                    </div>
                </div>
                <div class="col-sm-6 col-12">
                    <div class="info-row">
                        <div class="key w90">Tình trạng</div>
                        <div class="value">
                            <input type="text" class="form-control" v-model="p_tinhtrang" disabled="true">
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-sm-4 col-12">
                    <div class="info-row">
                        <div class="key w130">Loại thiết bị</div>
                        <div class="value">
                            <input type="text" class="form-control" v-model="p_loai_tb" disabled="true">
                        </div>
                    </div>
                </div>
                <div class="col-sm-2 col-12">
                    <div class="info-row">
                        <div class="key w60">MAC</div>
                        <div class="value">
                            <input type="text" class="form-control" v-model="p_mac" disabled="true">
                        </div>
                    </div>
                </div>
                <div class="col-sm-4 col-12">
                    <div class="info-row">
                        <div class="key w90">Phụ kiện</div>
                        <div class="value">
                            <input type="text" class="form-control" v-model="p_phukien" disabled="true">
                        </div>
                    </div>
                </div>
                <div class="col-sm-2 col-12">
                    <div class="info-row">
                        <div class="key w100">Phí bảo hành</div>
                        <div class="value">
                            <input type="text" class="form-control" v-model="p_phibh" :disabled="disable.phiBH">
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-sm-6 col-12">
                    <div class="info-row">
                        <div class="key w130">Số seri</div>
                        <div class="value">
                            <input type="text" class="form-control" v-model="p_soseri" v-on:keyup.enter="txtSeriCu_KeyPress">
                        </div>
                    </div>
                </div>
                <div class="col-sm-4 col-12">
                    <div class="info-row">
                        <div class="key w90">Ghi chú</div>
                        <div class="value">
                            <input type="text" class="form-control" v-model="p_ghichu">
                        </div>
                    </div>
                </div>
                <div class="col-sm-2 col-12">
                    <div class="info-row">
                        <div class="key w100">Linh kiện</div>
                        <div class="value">
                            <input type="text" class="form-control" v-model="p_linhkien"  @doubleClick="txtLinkKien_DoubleClick" :disabled="disable.linhKien">
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-sm-6 col-12">
                    <div class="info-row">
                        <div class="key w130">Serial mới</div>
                        <div class="value">
                            <input type="text" class="form-control" v-model="p_serialmoi" :disabled="disable.serialMoi">
                        </div>
                    </div>
                </div>
                <div class="col-sm-6 col-12">
                    <div class="info-row">
                        <div class="key w90">Kết quả BH</div>
                        <div class="value w20">
                            <!-- <div class="check-action" @click="btnCapNhatKetQua_Click">
                                <input type="checkbox" class="check">
                                <span class="name"></span>
                            </div> -->
                            <button class="btn btn-outline-primary form-control f18 border w40" style="padding: 0px;" @click="btnCapNhatKetQua_Click">
                                <span class="icon fa fa-check" style="color: green;"></span>
                            </button>
                        </div>
                        <div class="value">
                            <input type="text" class="form-control" v-model="p_ketquabh">
                        </div>
                    </div>
                </div>
            </div>
            <div class="box-move-select-table mart10">
                <div class="box-col">
                    <div class="legend-title">
                        <div class="pull-left padt7">Danh sách thiết bị bảo hành hiện tại</div>
                        <div class="pull-right">
                            <div class="d-flex">
                                <button class="btn-second btn border" @click='btnExcel_Click'>
                                    <span class="one-excel"></span> Excel
                                </button>
                                <div class="align-self-center padr7" v-if="visible.tuKho">Nhà cung cấp</div>
                                <div class="select-custom" style="min-width: 200px;" v-if="visible.tuKho">
                                    <ejs-dropdownlist
                                        class="form-control"
                                        ref="cboTinhTrang"
                                        locale='vi'
                                        v-model="params.p_tukho"
                                        :dataSource='DsTuKho' 
                                        :fields="{value:'khoId', text: 'tenKNew'}"
                                        :allowFiltering="true" 
                                        popupWidth="500px"                                     
                                        >
                                    </ejs-dropdownlist>    
                                   
                                </div>
                            </div>
                        </div>
                        <div class="clearfix"></div>
                    </div>
                    <div class="table-content"  style="overflow-x: scroll;">
                        
                        <DataGrid
                            v-bind:columns="[
                            {fieldName: '', headerText: '', allowSorting:false , allowFiltering:false, cssClass: 'text-center', allowEditing:false , width: 43, headerTemplate:colCheckboxAllBaoHanh ,template:colCheckboxBaoHanh, freeze: 'Left'},
                            {fieldName: 'LOAI_TBI', headerText: 'Loại thiết bị',textAlign: 'Left', allowFiltering: true, allowSorting: false, freeze: 'Left'},
                            {fieldName: 'LOHANG', headerText: 'Lô hàng',textAlign: 'Left', allowFiltering: true, allowSorting: true },
                            {fieldName: 'DONGIA', headerText: 'Đơn giá',textAlign: 'Right',format: 'N3', type: 'number', allowFiltering: true, allowSorting: true},
                            {fieldName: 'SERIAL_MOI', headerText: 'Serial mới', textAlign: 'Left',allowFiltering: true, allowSorting: true},
                            {fieldName: 'SERIAL', headerText: 'Serial cũ',textAlign: 'Left', allowFiltering: true, allowSorting: true},
                            {fieldName: 'SOLUONG', headerText: 'Số lượng',textAlign: 'Right',format: 'N0', type: 'number', allowFiltering: true, allowSorting: true},
                            {fieldName: 'TEN_DV', headerText: 'Đơn vị TN',textAlign: 'Left', allowFiltering: true, allowSorting: true},
                            {fieldName: 'NGAY_TN', headerText: 'Ngày TN',textAlign: 'Right', allowFiltering: true, allowSorting: true},
                            {fieldName: 'NGAYGIAO', headerText: 'Ngày giao',textAlign: 'Right', allowFiltering: true, allowSorting: true},
                            {fieldName: 'TEN_KHO', headerText: 'Nhà cung cấp',textAlign: 'Left', allowFiltering: true, allowSorting: true},
                            {fieldName: 'TT', headerText: 'Trạng thái', allowFiltering: true,textAlign: 'Left', allowSorting: true, freeze: 'Right'},
                            {fieldName: 'KEY', headerText:'', visible:false, isPrimaryKey:true} 
                            ]"
                            dataKeyField="KEY"
                            v-bind:dataSource="DanhSachNguon"
                            :showFilter="true"
                            :enablePagingServer=false
                            :allowPaging="true"
                            :allowExcelExport="true"
                            :totalRecords="DanhSachNguon.length"
                            :pageSize="DanhSachNguonPage.maxSize"
                            :pageIndex="DanhSachNguonPage.page"
                            @selectedRowChanged="onSelectedRowNguon"
                            @pageChanged="DanhSachNguonPageHandler"
                            :showColumnCheckbox='false'
                            :enabledSelectFirstRow="false"
                            ref="tableNguon"
                            >
                        </DataGrid>
                    </div>
                    
                </div>
                <div class="actions" style="margin-top: 90px;">
                    <button class="btn" @click="btnNext_Click">
                        <span class="fa fa-angle-right"></span>
                    </button>
                    <button class="btn" @click="btnNextAll_Click">
                        <span class="fa fa-angle-double-right"></span>
                    </button>
                    <button class="btn" @click="btnPrevie_Click">
                        <span class="fa fa-angle-left"></span>
                    </button>
                    <button class="btn" @click="btnPrevieAll_Click">
                        <span class="fa fa-angle-double-left"></span>
                    </button>
                    
                </div>
                <div class="box-col">
                    <div class="legend-title">
                        <div class="pull-left padt7">Trạng thái bảo hành đích</div>
                        <div class="pull-right">
                            <div class="inline" style="min-width: 300px;">
                                <div class="select-custom">
                                    <!-- <select name="" id="" class="form-control">
                                        <option>4. Thiết bị bảo hành</option>
                                    </select> -->
                                    <b-form-select
                                    id="ttbhdich"
                                    ref="ttbhdich"
                                    v-model="p_trangthaibhdich"
                                    :options="DSTrangThaiBHDich"
                                    value-field="TTBH_ID"
                                    text-field="TRANGTHAI_BH"
                                    class="form-control"
                                    @change="onTrangThaiBHChange()"
                                    >
                                    
                                    </b-form-select>
                                </div>
                            </div>
                            <button class="btn-second btn border" @click="btnInPhieu_Click">
                                <span class="nc-icon-outline tech_print"></span> In phiếu
                            </button>
                        </div>
                        <div class="clearfix"></div>
                    </div>
                    <div class="table-content">                      
                        <DataGrid
                            v-bind:columns="[
                            {fieldName: 'LOAI_TBI', headerText: 'Loại thiết bị',textAlign: 'Left', allowFiltering: true, allowSorting: false, freeze: 'Left'},
                            {fieldName: 'LOHANG', headerText: 'Lô hàng',textAlign: 'Left', allowFiltering: true, allowSorting: true },
                            {fieldName: 'DONGIA', headerText: 'Đơn giá',textAlign: 'Right',format: 'N3', type: 'number', allowFiltering: true, allowSorting: true},
                            {fieldName: 'SERIAL_MOI', headerText: 'Serial mới', textAlign: 'Left',allowFiltering: true, allowSorting: true},
                            {fieldName: 'SERIAL', headerText: 'Serial cũ',textAlign: 'Left', allowFiltering: true, allowSorting: true},
                            {fieldName: 'SOLUONG', headerText: 'Số lượng',textAlign: 'Right',format: 'N0', type: 'number', allowFiltering: true, allowSorting: true},
                            {fieldName: 'TEN_DV', headerText: 'Đơn vị TN',textAlign: 'Left', allowFiltering: true, allowSorting: true},
                            {fieldName: 'NGAY_TN', headerText: 'Ngày TN',textAlign: 'Right', allowFiltering: true, allowSorting: true},
                            {fieldName: 'NGAYGIAO', headerText: 'Ngày giao',textAlign: 'Right', allowFiltering: true, allowSorting: true},
                            {fieldName: 'TEN_KHO', headerText: 'Nhà cung cấp',textAlign: 'Left', allowFiltering: true, allowSorting: true},
                            ]"
                            v-bind:dataSource="DanhSachDich"
                            :showFilter="true"
                            :enablePagingServer=false
                            :allowPaging="true"
                            :allowExcelExport="true"
                            :totalRecords="DanhSachDich.length"
                            :pageSize="DanhSachDichPage.maxSize"
                            :pageIndex="DanhSachDichPage.page"
                            @selectedRowChanged="onSelectedRowDich"
                            @pageChanged="DanhSachDichPageHandler"
                            :showColumnCheckbox='true'
                            :enabledSelectFirstRow="false"
                            ref="tableDich"
                            >
                        </DataGrid>
                    </div>
                    
                </div>
            </div>
        </div>
    </div>
</div>