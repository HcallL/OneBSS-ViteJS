<div>
    <div class="list-actions-top">
        <ul class="list">
            <!-- <li>
                <a @click="onClickSua" >
                    <span class="icon one-file-attach"></span>Test Sửa
                </a>
            </li> -->
            <li @click="onClickLayThongTin" :class="{ disabledInput: enable.btnLayTT }">
                <a>
                    <span class="icon one-file-attach"></span>Lấy TT
                </a>
            </li>
            <li @click="onClickXacNhan" v-if="visible.btnXacNhan">
                <a>
                    <span class="icon nc-icon-glyph ui-1_check-circle-08"></span>Xác nhận
                </a>
            </li>
            <li @click="onClickHuyXacNhan" v-if="visible.btnHuyXN">
                <a>
                    <span class="icon nc-icon-glyph ui-1_circle-remove"></span>Hủy bỏ
                </a>
            </li>
            <li @click="onClickTraLai" v-if="visible.btnTraLai">
                <a>
                    <span class="icon one-file-arrow-left"></span>Trả phiếu
                </a>
            </li>
            <li @click="onClickHoanThanh" v-if="visible.btnHoanCong">
                <a>
                    <span class="icon one-file-check"></span>Hoàn Thành
                </a>
            </li>

        </ul>
    </div>
    <div class="page-content">
        <div class="row">
            <!-- <Split :gutterSize="5">
                <SplitArea :size="50" :minSize="300"> -->
            <div class="col-sm-6 col-12">
                <div class="box-form">
                    <div class="legend-title">
                        <span :class="classIconHiddenBox" @click="onClickHiddenBox()"></span> Thông tin quyết
                        toán
                    </div>
                    <div class="row" v-if="visible.boxSearch">
                        <div class="col-sm-7 col-12">
                            <div class="info-row">
                                <div class="key w110">Mã CT</div>
                                <div class="value">
                                    <input type="text" class="form-control highlight" v-model="params.maChungTu">
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-5 col-12">
                            <div class="info-row">
                                <div class="key w100">Kiểu thực hiện</div>
                                <div class="value">
                                    <div class="select-custom">
                                        <ejs-dropdownlist class="form-control" v-model="params.kieuTbiId"
                                            :dataSource='DSKieuTbi' :fields="{value:'kieuTbiId', text: 'kieuTbi'}"
                                            @change="onChangeKieuTbi">
                                        </ejs-dropdownlist>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row" v-if="visible.boxSearch">
                        <div class="col-sm-7 col-12">
                            <div class="info-row">
                                <div class="key w110">Ngày chứng từ</div>
                                <div class="value">
                                    <div class="input-icon-right">
                                        <ejs-datepicker class="form-control" v-model="params.ngayCTTu"
                                            :format="'dd/MM/y'">
                                        </ejs-datepicker>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-5 col-12">
                            <div class="info-row">
                                <div class="key w100">Trạng thái</div>
                                <div class="value">
                                    <div class="select-custom">
                                        <ejs-dropdownlist class="form-control" v-model="params.trangThai"
                                            :dataSource='DSTrangthai' :fields="{value:'ID', text: 'TRANGTHAI'}"
                                            @change="onChangeTrangThai">
                                        </ejs-dropdownlist>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row" v-if="visible.boxSearch">
                        <div class="col-sm-7 col-12">
                            <div class="info-row">
                                <div class="key w110">
                                    <div class="check-action">
                                        <input type="checkbox" class="check" v-model="params.isTuNgay">
                                        <span class="name">Từ ngày</span>
                                    </div>
                                </div>
                                <div class="value">
                                    <div class="input-icon-right">
                                        <ejs-datepicker class="form-control" v-model="params.tuNgay"
                                            :format="'dd/MM/y'">
                                        </ejs-datepicker>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-5 col-12">
                            <div class="info-row">
                                <div class="key w100">Đến ngày</div>
                                <div class="value">
                                    <div class="input-icon-right">
                                        <ejs-datepicker class="form-control" v-model="params.denNgay"
                                            :format="'dd/MM/y'">
                                        </ejs-datepicker>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="info-row" v-if="visible.boxSearch">
                        <div class="key w110">
                            Kho giao
                        </div>
                        <div class="value">
                            <div class="input-more-button -right">
                                <button class="btn" @click="refreshKhoGiao">
                                    <span class="nc-icon-outline arrows-1_refresh-68 f20"></span>
                                </button>
                                <div class="select-custom">
                                    <ejs-dropdownlist class="form-control" v-model="params.khoGiaoId"
                                        :dataSource='DSKhoGiao' :fields="{value:'khoID', text: 'tenKho'}" @change="">
                                    </ejs-dropdownlist>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="info-row" v-if="visible.boxSearch">
                        <div class="key w110">
                            Kho CT
                        </div>
                        <div class="value">
                            <div class="input-more-button -right">
                                <button class="btn" @click="refreshKhoNhan">
                                    <span class="nc-icon-outline arrows-1_refresh-68 f20"></span>
                                </button>
                                <div class="select-custom">
                                    <ejs-dropdownlist class="form-control" v-model="params.khoCTId"
                                        :dataSource='DSKhoNhan' :fields="{value:'khoID', text: 'tenKho'}" @change="">
                                    </ejs-dropdownlist>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="info-row" v-if="visible.boxSearch">
                        <div class="key w110">
                            Nội dung trả
                        </div>
                        <div class="value">
                            <textarea class="form-control" style="height: 100px;resize: none;"
                                v-model="params.noiDungTra"></textarea>
                        </div>
                    </div>
                </div>
            </div>
            <!-- </SplitArea>
                <SplitArea :size="50" :minSize="300"> -->
            <div class="col-sm-6 col-12">
                <div class="box-form">
                    <div class="legend-title">Danh sách công trình</div>
                    <div class="table-content" v-if="visible.boxSearch">

                        <DataGrid ref="tableDSCongTrinh" class="table-result table-gachle" v-bind:columns="[
                                    {fieldName: '', headerText: '', allowSorting:false , allowFiltering:false, textAlign:'Center', allowEditing:false , width: 40, headerTemplate:CheckboxAllCT ,template:CheckboxCT},
                                    {fieldName: 'NGAYLAP', headerText: 'Ngày Lập', allowFiltering: true, allowSorting: true},
                                    {fieldName: 'MA_CT', headerText: 'Mã CT', allowFiltering: true, allowSorting: true}, 
                                    {fieldName: 'SOHIEU_CT', headerText: 'Số hiệu CT', allowFiltering: true, allowSorting: true}, 
                                    {fieldName: 'TEN_CT', headerText: 'Tên CT', allowFiltering: true, allowSorting: true},
                                    {fieldName: 'LOAI_CT', headerText: 'Loại CT', allowFiltering: true, allowSorting: true},
                                    {fieldName: 'NGUONVON', headerText: 'Nguồn vốn', allowFiltering: true, allowSorting: true},   
                                    {fieldName: 'CONGTRINH_ID', headerText:'', visible:false, isPrimaryKey:true}                          
                                    ]" v-bind:dataSource="DSCongTrinh" :showFilter="true" dataKeyField="CONGTRINH_ID"
                            @selectedRowChanged="gridDSCongTrinhSelected" :showColumnCheckbox="false"
                            :allowPaging="true" :enablePagingServer="false">
                        </DataGrid>
                    </div>
                    <!-- @selectedItemsChanged="gridDSCongTrinhCheckBox" -->

                </div>
            </div>
            <!-- </SplitArea>
            </Split> -->

        </div>
        <div class="box-form">
            <div class="nav tabs tab-over">
                <a href="#congtrinh" data-toggle="tab" :class="classCongTrinh" @click="onClickBoxCongTrinh()">Danh sách
                    vật tư công trình</a>
                <a href="#xacnhan" data-toggle="tab" :class="classXacNhan" @click="onClickBoxXacNhan()">Danh sách vật tư
                    xác nhận</a>
            </div>
            <div class="tab-content">
                <div class="tab-pane" :class="classCongTrinh" id="congtrinh">
                    <div class="table-content">

                        <DataGrid ref="gridVatTuCap" class="table-result table-gachle" v-bind:columns="[
                            {fieldName: 'NGAY_CAP', headerText: 'Ngày cấp', allowFiltering: true, allowSorting: true , isGroupedColumn:true},
                            {fieldName: 'TEN_VT', headerText: 'Tên vật tư', allowFiltering: true, allowSorting: true}, 
                            {fieldName: 'MA_TBI', headerText: 'Mã Tbị', allowFiltering: true, allowSorting: true}, 
                            {fieldName: 'SERIAL', headerText: 'Serial', allowFiltering: true, allowSorting: true},
                            {fieldName: 'SOLUONG', headerText: 'Số lượng', allowFiltering: true, allowSorting: true},
                            {fieldName: 'SERIAL_GP', headerText: 'Serial GP', allowFiltering: true, allowSorting: true},
                            {fieldName: 'LOHANG', headerText: 'Lô hàng', allowFiltering: true, allowSorting: true},
                            {fieldName: '', headerText: 'Mô tả', allowFiltering: true, allowSorting: true},
                            {fieldName: 'DVI_TINH', headerText: 'ĐVT', allowFiltering: true, allowSorting: true},                             
                            {fieldName: 'STATUS', headerText: 'Trạng thái', allowFiltering: true, allowSorting: true},
                            {fieldName: 'KIEUTBI_ID', headerText: 'Kiểu T.Bị', allowFiltering: true, allowSorting: true},   
                            {fieldName: 'TT_TBI', headerText: 'Tình trạng Tbị', allowFiltering: true, allowSorting: true}, 
                            {fieldName: 'TRANGBI', headerText: 'Kiểu trang bị', allowFiltering: true, allowSorting: true}, 
                            {fieldName: 'MUCDICH', headerText: 'Lý do cấp', allowFiltering: true, allowSorting: true}, 
                            {fieldName: 'KHOCAP', headerText: 'Kho cấp', allowFiltering: true, allowSorting: true}, 
                            ]" v-bind:dataSource="DSVatTuCap" :showFilter="true" @selectedRowChanged=""
                            :allowPaging="true" :enablePagingServer="false">
                        </DataGrid>
                    </div>
                </div>
                <div class="tab-pane" :class="classXacNhan" id="xacnhan">
                    <div class="row">
                        <div class="col-sm-8 col-12">
                            <div class="info-row">
                                <div class="key w90">Lô hàng</div>
                                <div class="value">
                                    <div class="select-custom">
                                        <ejs-dropdownlist class="form-control" v-model="params.loHangId"
                                            :dataSource='DSLoHang' :fields="{value:'loHang', text: 'loHang'}">
                                        </ejs-dropdownlist>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="table-content">

                        <DataGrid3 ref="gridLichSuVatTu" class="table-result table-gachle" v-bind:columns="[
                            {fieldName: 'TEN_CT', headerText: 'Công trình', allowFiltering: true, allowSorting: true , isGroupedColumn:true},
                            {fieldName: 'NGAY_CAP', headerText: 'Ngày cấp', allowFiltering: true, allowSorting: true , isGroupedColumn:true}, 
                            {fieldName: 'TEN_VT', headerText: 'Tên vật tư', allowFiltering: true, allowSorting: true}, 
                            {fieldName: 'SERIAL', headerText: 'Serial', allowFiltering: true, allowSorting: true},
                            {fieldName: 'SERIAL_GP', headerText: 'Serial GP', allowFiltering: true, allowSorting: true},
                            {fieldName: 'MA_TBI', headerText: 'Mã Tbị', allowFiltering: true, allowSorting: true},
                            {fieldName: 'SOLUONG', headerText: 'Số lượng', allowFiltering: true, allowSorting: true},
                            {fieldName: 'DVI_TINH', headerText: 'ĐVT', allowFiltering: true, allowSorting: true},
                            {fieldName: 'LOHANG', headerText: 'Lô hàng', allowFiltering: true, allowSorting: true},
                            {fieldName: 'MOTA', headerText: 'Mô tả', allowFiltering: true, allowSorting: true},
                            {fieldName: 'KIEUTBI_ID', headerText: 'Kiểu T.Bị', allowFiltering: true, allowSorting: true},                             
                            {fieldName: 'STATUS', headerText: 'Trạng thái', allowFiltering: true, allowSorting: true},                        
                            {fieldName: 'TT_TBI', headerText: 'Tình trạng Tbị', allowFiltering: true, allowSorting: true}, 
                            {fieldName: 'TRANGBI', headerText: 'Kiểu trang bị', allowFiltering: true, allowSorting: true}, 
                            {fieldName: 'MUCDICH', headerText: 'Lý do cấp', allowFiltering: true, allowSorting: true}, 
                            {fieldName: 'KHOCAP', headerText: 'Kho cấp', allowFiltering: true, allowSorting: true}, 
                            {fieldName: 'LH', headerText: 'Lô hàng', allowFiltering: true, allowSorting: true},
                            {fieldName: 'DONGIA', headerText: 'Đơn giá', allowFiltering: true, allowSorting: true},
                            {fieldName: '', headerText: 'Sửa', allowFiltering: true, allowSorting: true , template: btnTBTemplate, width: '80' },
                            ]" v-bind:dataSource="DSLichSuVatTu" :showFilter="true" @selectedRowChanged=""
                            :allowPaging="true" :enablePagingServer="false" :showColumnCheckbox="true"
                            @selectedItemsChanged="DSLichSuVatTuCheckbox" @keyPressed="DSLichSuVatTu_KeyDown"
                            :enabledSelectFirstRow="false">
                        </DataGrid3>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <b-modal no-close-on-backdrop hide-footer hide-header hide-header-close class="modal" id="popupNhapNoiDung">

        <div class="modal-content popup-box">
            <div class="popup-header">
                <div class="title">Nhập thông tin quyết toán</div>
                <div class="close -ap icon-close" @click="$bvModal.hide('popupNhapNoiDung')" data-dismiss="modal">
                </div>
            </div>
            <div class="list-actions-top">
                <ul class="list">
                    <li>
                        <a @click="onClickXacNhanNoiDung()">
                            <span class="icon nc-icon-glyph ui-1_check-circle-08"></span> Xác nhận
                        </a>
                    </li>
                </ul>
            </div>
            <div class="popup-body">
                <div class="info-row">
                    <div class="key w90">
                        Ngày chứng từ
                    </div>
                    <div class="value">
                        <ejs-datetimepicker class="form-control" :format="dateConfig.formatDayTime" v-model="ngayCT">
                        </ejs-datetimepicker>
                    </div>
                </div>
                <div class="info-row">
                    <div class="key w90">
                        Nội dung
                    </div>
                    <div class="value">
                        <textarea class="form-control" v-model="noiDungGiao" value="noiDungGiao"
                            style="height: 100px;resize: vertical;"></textarea>
                    </div>
                </div>
            </div>
        </div>

    </b-modal>

    <b-modal no-close-on-backdrop hide-footer hide-header hide-header-close class="modal" id="popupSuaVT">

        <div class="modal-content popup-box">
            <div class="popup-header">
                <div class="title">Đổi vật tư</div>
                <div class="close -ap icon-close" @click="$bvModal.hide('popupSuaVT')" data-dismiss="modal">
                </div>
            </div>
            <div class="list-actions-top">
                <ul class="list">
                    <li>
                        <a @click="XacNhanSuaVT()">
                            <span class="icon nc-icon-glyph ui-1_check-circle-08"></span> Xác nhận
                        </a>
                    </li>
                </ul>
            </div>
            <div class="popup-body">
                <div class="info-row">
                    <div class="key w90">
                        Vật tư
                    </div>
                    <div class="value">
                        <ejs-dropdownlist class="form-control" ref="cboDonVi_FMIS" locale='vi' v-model="SuaVTId"
                            :dataSource='DSVatTu_DVT' :fields="{value:'VATTU_ID', text: 'TEN_VT'}"
                            :allowFiltering="true">
                        </ejs-dropdownlist>
                    </div>
                </div>
            </div>
        </div>

    </b-modal>
</div>