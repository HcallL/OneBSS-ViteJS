<div class="main-wrapper">
    <div class="breadcrumb-top">
        <div class="main-title">đăng ký gói đa dịch vụ</div>
        <ul class="breadcrumb">
            <li class="breadcrumb-item"><a href="/"><span class="nc-icon-outline ui-1_home-simple"></span>Trang chủ</a></li>
            <li class="breadcrumb-item"><a href="/contract">Lập hợp đồng</a></li>
            <li class="breadcrumb-item active">Đăng ký gói đa dịch vụ</li>
        </ul>
    </div>
    <div class="list-actions-top">
        <ul class="list">
            <li title="Nhập mới">
                <a href="javascript:void(0)" @click.prevent="tsbtnNhapMoi_Click" :class="{disabled: !tsbtnNhapMoi}">
                    <span class="icon one-file-plus"></span>Nhập mới
                </a>
            </li>
            <li title="Ghi lại">
                <a href="javascript:void(0)" :class="{disabled: !tsbtnGhiLai}" @click.prevent="tsbtnGhiLai_Click">
                    <span class="icon one-save"></span>Ghi lại
                </a>
            </li>
            <li title="Hủy">
                <a href="javascript:void(0)" @click.prevent="tsbtnHuyBo_Click" :class="{disabled: !tsbtnHuyBo}">
                    <span class="icon nc-icon-glyph ui-1_circle-remove"></span>Hủy
                </a>
            </li>
            <li title="Xóa">
                <a href="javascript:void(0)" @click.prevent="tsbtnXoa_Click" :class="{disabled: !tsbtnXoa}">
                    <span class="icon one-trash"></span>Xóa
                </a>
            </li>
            <li title="Thêm thuê bao">
                <a href="javascript:void(0)" @click.prevent="tsbtnThemTB_Click" :class="{disabled: !tsbtnThemTB}">
                    <span class="icon one-mobile-plus"></span>Thêm TB
                </a>
            </li>
            <li title="Xóa thuê bao">
                <a href="javascript:void(0)" :class="{disabled: !tsbtnXoaTB}" @click.prevent="XoaHDTB">
                    <span class="icon one-phone-remove"></span>Xóa TB
                </a>
            </li>
            <li title="Gia Hạn K+">
                <a href="javascript:void(0)" @click.prevent="tsbtnGiaHanKPlus_Click">
                    <span class="icon one-phone-remove"></span>Gia hạn K+
                </a>
            </li>
            <li title="Hoàn thiện">
                <a href="javascript:void(0)" @click.prevent="tsbtnCapNhatDB_Click">
                    <span class="icon one-file-check"></span>Hoàn thiện
                </a>
            </li>
            <li title="Liên hệ">
                <a href="javascript:void(0)">
                    <span class="icon nc-icon-glyph business_contacts"></span>Liên hệ
                </a>
            </li>
            <li @click.prevent="tsbtnEmail_Click" title="Email">
                <a href="javascript:void(0)">
                    <span class="icon one-email"></span>Email
                </a>
            </li>
        </ul>
    </div>
    <div class="page-content">
        <div class="box-form padt8 padb8">
            <div class="row">
                <div class="col-sm-8 col-12">
                    
                </div>
                <div class="col-sm-2 col-12">
                    <div class="info-row">
                        <div class="key w20 nowrap">
                            <div class="check-action">
                                <input type="checkbox" class="check" ref="chkCTV" v-model="filterbox.ctv.ischecked" @change="ShowPopupCTV()">
                                <span class="name fw6">Cộng tác viên</span>
                            </div>
                        </div>
                        <div class="value" :class="{disabled:!filterbox.ctv.ischecked}">
                            <input type="text" ref="txtCTV" class="form-control"  v-model="filterbox.ctv.value" :readonly="true">
                        </div>
                    </div>
                </div>
                <div class="col-sm-2 col-12">
                    <div class="info-row">
                        <div class="key w20 nowrap">
                            <div class="check-action">
                                <input type="checkbox" class="check" ref="chkNguoiGT" v-model="filterbox.nguoigt.ischecked" @change="ShowPopupNguoiGT()">
                                <span class="name fw6">Người giới thiệu</span>
                            </div>
                        </div>
                        <div class="value" :class="{disabled:!filterbox.nguoigt.ischecked}">
                            <input type="text" ref="txtNguoiGT" class="form-control" v-model="filterbox.nguoigt.value" :readonly="true">
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="grid-stack-box">
            <div class="box-col box-form" id="boxLeft">
                <div class="legend-title">Thông tin gói</div>
                <div class="row">
                    <div class="col-sm-8 col-12">
                        <div class="info-row">
                            <div class="key w90">Mã giao dịch</div>
                            <div class="value">
                                <div class="input-more-button">
                                    <button class="btn" @click="showPopupSearchContract">
                                        <span class="-ap icon-more_horiz"></span>
                                    </button>
                                    <input type="text" class="form-control" ref="txtMaGD" title="Tìm kiếm mã giao dịch" v-on:keyup.enter="txtMaGD_KeyPress">
                                    <!-- <ejs-dialog cssClass="custom_popup_cucmanh" :enableResize='true' :visible="false" ref="popupFrmTraCuuHopDong"
                                        :header='"Tra cứu hợp đồng, phụ lục"' showCloseIcon=true width="80%" :target="target" :position="position" height="800">
                                        <SearchContractModal ref="searchContractModal" :donviId="Number($root.token.getDonViID())" :nhanvienId="Number($root.token.getNhanVienID())" :loaihd_id="modalSearch.loai_hd_id" :kieu="1" :tthd_id="modalSearch.tthd_id"
                                        @accept="acceptSearchContract"/>
                                    </ejs-dialog> -->
                                    <SearchContractModal ref="popupSearchContract" @accept="acceptSearchContract" :loai_hd_id="27" :dichvu_id="1" :ngay_yc="params.p_today_string" :ngay_kt="params.p_today_string" :trangthai_hd="1" />
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-4 col-12">
                        <div class="info-row">
                            <div class="key w90">Ngày yêu cầu</div>
                            <div class="value">
                                <ejs-datepicker v-model="dtpNgayLHD" :value="params.p_today"
                                    :format="'dd/MM/y'" :showClearButton="false" :placeholder="'Chọn ngày'"
                                    :disabled="params.disable">
                                </ejs-datepicker>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-8 col-12">
                        <div class="info-row">
                            <div class="key w90">Dịch vụ</div>
                            <div class="value">
                                <div class="select-custom">
                                    <Select2 ref="dichVuVienThongId" :disabled='false' v-model="cboDichVuVienThong.value"
                            :options="cboDichVuVienThong.list" @select="cboDichVuVT_SelectedValueChanged" :settings="settingSelect2"/>
                                </div>

                            </div>
                        </div>
                    </div>
                    <div class="col-sm-4 col-12">
                        <div class="info-row">
                            <div class="key w90">Loại hình TB</div>
                            <div class="value">
                                <div class="select-custom">
                                    <Select2 ref="loaiHinhTbId" :disabled='false' v-model="cboLoaiHinhThueBao.value"
                            :options="cboLoaiHinhThueBao.list" :settings="settingSelect2" @select="cboLoaihinhTB_SelectedValueChanged"/>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="info-row">
                    <div class="key w90">Kiểu yêu cầu</div>
                    <div class="value">
                        <div class="select-custom">
                            <Select2 ref="goiId" :disabled='false' v-model="cboKieuLapDat.value"
                            :options="cboKieuLapDat.list" :settings="settingSelect2"/>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-8 col-12">
                        <div class="info-row">
                            <div class="key w90">Số máy/Acc</div>
                            <div class="value">
                                <div class="input-more-button">
                                    <button class="btn" @click="bntLayMaKh_Click">
                                        <span class="-ap icon-more_horiz"></span>
                                    </button>
                                    <input type="text" class="form-control highlight" ref="txtMaTB" v-on:keyup.enter="txtMaTB_KeyPress" v-model="txtMaTB" title="Chọn số máy/Acc">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-4 col-12">
                        <div class="info-row">
                            <div class="key w90">Hiệu lực</div>
                            <div class="value">
                                <div class="select-custom">
                                    <Select2 ref="hieuLucId" :disabled='false' v-model="cboHieuLuc.value"
                            :options="cboHieuLuc.list" :settings="settingSelect2"/>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="info-row">
                    <div class="key w90">Tên gói</div>
                    <div class="value">
                        <div class="input-more-button">
                            <button class="btn">
                                <span class="-ap icon-more_horiz"></span>
                            </button>
                            <div class="select-custom">
                                <ComboboxGrid :valueField="cboDanhSachGoi.valueField" :textField="cboDanhSachGoi.textField"
                                    v-model="cboDanhSachGoi.value" :value="cboDanhSachGoi.value" :columns="cboDanhSachGoi.headers"
                                    :panelDataHeight="cboDanhSachGoi.panelDataHeight" :enabledSelectFirstRow="true"
                                    :dataSource="cboDanhSachGoi.list" @selectedChanged="cboTenGoi2_EditValueChanged">
                                </ComboboxGrid>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-8 col-12">
                        <div class="info-row">
                            <div class="key w90">Số CA</div>
                            <input type="text" class="form-control " v-model="txtSoCA">
                        </div>
                    </div>
                    <div class="col-sm-4 col-12">
                        <div class="info-row">
                            <div class="key w90">MST CA</div>
                            <div class="value">
                                <input type="text" class="form-control" v-model="txtMaSoThueCA">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="info-row">
                    <div class="key w90"></div>
                    <div class="value padt7">
                        <div class="check-action">
                            <input type="checkbox" class="check" v-model="chkChuNhom">
                            <span class="name">Chủ nhóm</span>
                        </div>
                    </div>
                </div>
                <div class="info-row">
                    <div class="key w90">Mô tả</div>
                    <div class="value">
                        <textarea name="" v-model="txtMoTa" class="form-control" style="height: 100px;resize: none;"></textarea>
                    </div>
                </div>
            </div>
            <div class="box-col box-form" id="boxRight">
                <div class="legend-title">Thông tin khách hàng</div>
                <div class="info-row">
                    <div class="key">Mã khách hàng</div>
                    <div class="value">
                        <input type="text" class="form-control" v-model="txtMaKH" disabled="true">
                    </div>
                </div>
                <div class="info-row">
                    <div class="key">Tên khách hàng</div>
                    <div class="value">
                        <input type="text" class="form-control" v-model="txtTenKH" disabled="true">
                    </div>
                </div>
                <div class="info-row">
                    <div class="key">Địa chỉ KH</div>
                    <div class="value">
                        <input type="text" class="form-control" v-model="txtDiaChiKH" disabled="true">
                    </div>
                </div>
                <div class="info-row">
                    <div class="key">Ghi chú</div>
                    <div class="value">
                        <textarea name="" class="form-control" style="height: 240px;resize: none;" v-model="txtGhiChu"></textarea>
                    </div>
                </div>
            </div>
        </div>
        <div class="box-form">
            <div class="legend-title">Dánh sách các thuê bao thuộc gói</div>
            <div class="table-content">
                <DataGrid
                    ref="danhSachGoiThueBao"
                    v-bind:columns="danhSachThueBaoGoiTable.header"                    
                    v-bind:dataSource="danhSachThueBaoGoiTable.list"
                    :enable-paging-server="false"                                        
                    :allowPaging="true"
                    :showFilter="true"
                    :showColumnCheckbox="false"
                    @selectedRowChanged="dgrList_SelectionChanged"
                >
                </DataGrid>
            </div>
        </div>
    </div>
    <!-- <footer class="footer">
        VNPT-IT &copy; 2021
    </footer>
    <script src="../vendor/jquery/split.js"></script>
    <script type="text/javascript">
        Split(['#boxLeft', '#boxRight'], {
            sizes: [50, 50],
            gutterSize: 16,
            onDragEnd: function (sizes) {
            },
        });
       
    </script> -->
    <frmNguoiGT ref="frmNguoiGT" @chonNhanvien="chonNhanvien" />
    <ChonCongTacVienModal ref="chonCongTacVienModal" @accept="acceptCTV" />
    <ChonNguoiGTModal ref="chonNguoiGTModal" @accept="acceptNguoiGT" />
    <ejs-dialog :enableResize="true" :visible="false" :position="position" ref="searchAccountDialog" showCloseIcon="true" target="#app" width="80%" height="800" class="searchAccountDialogClass">
        <div class="SubcriberHistory-popup popupBody">
          <searchAccount :isPopup="true" @form-close="searchAccountDialogClose"/>
        </div>
    </ejs-dialog>
    <b-modal ref="ThongTinEmail" id="ThongTinEmail" size="xl" title="Thôn tin Email" hide-footer
        body-class="p-0 thanhtoan-modal">
        <ThongTinEmail :hdkh_id="hdkh_id" :khachhang_id="khachhang_id" />
    </b-modal>
    <ThueBaoCungMa id="thuebaocungma" ref="thuebaocungma"></ThueBaoCungMa>
</div>