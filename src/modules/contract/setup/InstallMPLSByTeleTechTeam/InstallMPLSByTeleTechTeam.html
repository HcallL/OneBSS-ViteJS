<div class="main-wrapper" @click="hideDropdownMenu">
  <vue-bread-crumb :header="header" />
  <div class="list-actions-top">
    <ul class="list" style="overflow: none !important;">
      <li class="cursor-pointer">
        <a @click="btnLayTTOnClick()" :class="form_button.btnLayTTMoi ? '' : 'disabled'">
          <span class="icon one-file-attach"></span> Lấy TT
        </a>
      </li>
      <li>
        <a @click="Cap_Nhat()" :class="form_button.tsbtnChapNhan ? '' : 'disabled'">
          <span class="icon one-reload1"></span> Cập nhật
        </a>
      </li>

      <li v-if="form_button.isTsbtnGiaoPhieu">
        <!-- @click="$bvModal.show('bv-modal-handover-ticket')" -->
        <!-- @click="Giao_Phieu()" -->
        <a @click="Giao_Phieu()
        " :class="form_button.tsbtnGiaoPhieu ? '' : 'disabled'">
          <span class="icon one-file-arrow-right1"></span>
          Giao phiếu
        </a>
      </li>
      <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false"> <span
            class="icon one-file-arrow-right1"></span>Xuất phiếu <span class="caret"></span></a>
        <ul class="dropdown-menu" role="menu">
          <li><a href="#" style="color: #007bff;"> <span class="icon one-file-arrow-right1"></span>Phiếu thi công</a>
          </li>
          <li><a href="#" style="color: #007bff;"><span class="icon one-file-arrow-right1"></span>In phiếu</a></li>

        </ul>
      </li>

      <li v-if="form_button.isTsbtnTraPhieu">

        <!-- @click="$bvModal.show('bv-modal-tra-phieu')" -->
        <!-- btnGiaoPhieuOnClick()" -->
        <a @click="() => 
          showModalTraphieu = true" :class="form_button.tsbtnTraPhieu ? '' : 'disabled'">
          <span class="icon one-file-back"></span>
          Trả phiếu
        </a>
      </li>
      <li>

        <a href="#">
          <span class="dropdown-icon one-vt"></span> Vật tư
        </a>
      </li>

      <li>
        <a @click="btnHenKHOnClick()" :class="form_button.tsbtnHen ? '' : 'disabled'">
          <span class="dropdown-icon one-henld"></span>
          Hẹn LĐ
        </a>
      </li>

      <li>
        <a @click="btnGiaoPhieuOnClick()" :class="form_button.tsbtnDauNoiCap ? '' : 'disabled'">
          <span class="icon one-connect"></span>
          Đấu nối
        </a>
      </li>

      <li>
        <a @click="tsbtnHuy_HC_Click()" :class="form_button.tsbtnHuy_HC ? '' : 'disabled'">
          <span class="icon one-file-arrow-right1"></span>
          Hủy hoàn công
        </a>
      </li>

      <li>
        <a @click="()=> popupGanKhuVucQuanLyThueBao = true" :class="form_button.tsbtnNVKT ? '' : 'disabled'">
          <span class="dropdown-icon -ap icon-pin"></span>
          Gán KV
        </a>
      </li>

      <li>
        <a @click="btnGiaoPhieuOnClick()" :class="form_button.tsbtnThongTinKT ? '' : 'disabled'">
          <span class="icon one-file-arrow-right1"></span>
          Thông số KT
        </a>
      </li>

      <li v-if="form_button.isTsbtnChuyenTo">
        <a @click="btnChuyenToOnClick()" :class="form_button.tsbtnChuyenTo ? '' : 'disabled'">
          <span class="icon one-change"></span>
          Chuyển tổ
        </a>
      </li>

      <li>
        <a @click="btnPhieuTonOnClick()" :class="form_button.tsbtnGiaoPhieu_Ton ? '' : 'disabled'">
          <span class="dropdown-icon one-calendar-number"></span>
          Tồn phiếu
        </a>
      </li>

    </ul>
    <div class="more dropdown">
      <a href="#" @click.prevent="setDisplayDropDownMenu">
        <span ref="mainWrap" class="icon -ap  icon-dots-three-vertical"></span>
      </a>
      <div v-if="isDisplayMenu" class="dropdown-menu ovauto d-block" style="max-height: 300px;">
        <a @click="btnGiaoViecOnClick()" :class="form_button.tsbtnGiaoViec ? '' : 'disabled'">
          <span class="icon one-file-arrow-right1"></span>
          Giao việc
        </a>
        <a v-if="form_button.isTsbtnHoanThanh" @click="btnHoanThanhOnClick()" :class="form_button.tsbtnHoanThanh ? '' : 'disabled'">
          <span class="icon one-file-arrow-right1"></span>
          Hoàn thành
        </a>

        <a v-if="form_button.isTsbtnHoanCong" @click="btnGiaoPhieuOnClick()" :class="form_button.tsbtnHoanCong ? '' : 'disabled'">
          <span class="dropdown-icon one-hoancong"></span>
          Hoàn công
        </a>
        <!-- <a @click="btnGiaoPhieuOnClick()" :class="form_button.tsbtnVatTu ? '' : 'disabled'">
          <span class="dropdown-icon one-vt"></span>
          Vật tư
        </a> -->

        <a v-if="form_button.isTsbtnVatTu" @click="btnGiaoPhieuOnClick()" :class="form_button.tsbtnVatTuMoi ? '' : 'disabled'">
          <span class="dropdown-icon one-vt"></span>
          Vật tư mới
        </a>
        <a v-if="form_button.isTsbtnGiaoPhieu_KBB" @click="btnGiaoPhieuOnClick()" :class="form_button.tsbtnGiaoPhieu_KBB ? '' : 'disabled'">
          <span class="icon one-file-arrow-right1"></span>
          Giao việc KKB
        </a>

        <a v-if="form_button.isTsbtnDuAn" @click="btnGiaoPhieuOnClick()" :class="form_button.tsbtnDuAn ? '' : 'disabled'">
          <span class="dropdown-icon one-clipart-edit"></span>
          Dự án
        </a>

        <a @click="btnDoKiemOnClick()" :class="form_button.tsbtnKQ_DoKiem ? '' : 'disabled'">
          <span class="dropdown-icon nc-icon-glyph design_design"></span>
          Đo kiểm
        </a>
        <a v-if="form_button.isTsbtnSua_KenhThu" @click="btnGiaoPhieuOnClick()" :class="form_button.tsbtnSua_KenhThu ? '' : 'disabled'">
          <span class="dropdown-icon nc-icon-glyph ui-1_edit-74"></span>
          Sửa kênh thu
        </a>
        <a v-if="form_button.isTsbtnHoanThienHS" @click="btnHoanThien()" :class="form_button.tsbtnHoanThienHS ? '' : 'disabled'">
          <span class="dropdown-icon one-file-check"></span>
          Hoàn thiện
        </a>

      </div>

    </div>
  </div>
  <div class="page-content">
    <ThongTinChung :formProps="form_ThongTinChung" :options="options_thongTinChung"></ThongTinChung>
    <div class="row">
      <div class="col-12 col-lg-6 ">
        <ThongTinKhachHang ref="ThongTinKhachHang" @on-enter=" () => {isEnterMaGD = true; getTableDSThueBao()}"
          :formProps="form_ThongTinKhachHang" :options="options_ThongTinKhachHang"></ThongTinKhachHang>
      </div>
      <div class="col-12 col-lg-6 ">
        <ThongTinGiaoViec ref="ThongTinGiaoViec" :formProps="form_ThongTinGiaoViec" :options="options_ThongTinGiaoViec">
        </ThongTinGiaoViec>
      </div>
    </div>
    <div class="box-form">
      <div class="legend-title">
        <span class="icon fa" :class="isVisibleThongTinHoanCong ? 'fa-angle-up' : 'fa-angle-down'"
          @click="isVisibleThongTinHoanCong = !isVisibleThongTinHoanCong"></span>
        Thông tin hoàn công
      </div>
      <div class="row" v-show="isVisibleThongTinHoanCong">
        <div class="col-12 col-lg-6 ">
          <ThongTinHoanCong_DD :formProps="form_ThongTinHoanCong_DD" :options="options_ThongTinHoanCong_DD"
            ref="tableDD" @display-table="setDisplayTableDD" @btnNDTHOnClick="btnNDTHOnClick">
          </ThongTinHoanCong_DD>
        </div>
        <div class="col-12 col-lg-6 ">
          <ThongTinHoanCong_DC :formProps="form_ThongTinHoanCong_DC" :options="options_ThongTinHoanCong_DC"
            ref="tableDC" @display-table="setDisplayTableDC">
          </ThongTinHoanCong_DC>
        </div>
      </div>
    </div>

    <DanhSachThueBao :formProps="form_DanhSachThueBao"></DanhSachThueBao>
    <div>

<!-- các popup menu -->
      <b-modal id="bv-modal-handover-ticket" hide-footer>

        <div id="modal-handover-ticket" class="d-block text-center" style="height: 80vh;">
          <HandoverTicket />

        </div>
      </b-modal>


      <b-modal v-model="showModalTraphieu" modal-class="popup-box traphieu" header-class="popup-header"
        content-class="traphieu-content" body-class="none-padding traphieu-body" size="lg" title="Trả phiếu"
        hide-footer>
        <traphieu :ma_gd="form_ThongTinKhachHang.txtMaGD" :ma_tb="form_ThongTinKhachHang.txtMaTB"
          :loaihd_id="form_ThongTinKhachHang.cboLoaiHinh" :dichvuvt_id="form_ThongTinKhachHang.dichvuvt_id "
          :ngaygiao="form_ThongTinGiaoViec.ngaygiao" :kieu="kieu" :nhanvien_id="form_ThongTinKhachHang.nhanvien_id" />
      </b-modal>



      <ChuyenTo ref="popupChuyenTo"></ChuyenTo>



      <TonPhieuGiaoModal ref="tonPhieuGiaoModal" :phieu_id="Number(form_ThongTinKhachHang.phieu_id)" :tthd_id="tag || 9" />
      <DoKiemModal ref="doKiem" :hdtb_id="Number(form_ThongTinKhachHang.hdtb_id)" />
      <ejs-dialog :enableResize='true' :visible="false" ref="giaophieunhanvien"
      :header='"Giao phiếu nhân viên"'
      :allowDragging="true"
      showCloseIcon=true
      animationSettings="animationSettings"
      :position="{ X: 'center', Y: 'top' }" 
      width='60%'
      height="800">
      <giaophieunhanvien @giaoviec_success="giveWorkSuccess()"
          ref="formgiaphieu"
          :ngaygiao="form_ThongTinGiaoViec.ngaygiao"
          :nguoigv_id="form_ThongTinGiaoViec.cboNguoiGV"
          :phieu_id="form_ThongTinKhachHang.phieu_id" />
  </ejs-dialog>





  
  <b-modal v-model="popupGanKhuVucQuanLyThueBao" modal-class="popup-box traphieu" header-class="popup-header"
  content-class="traphieu-content" body-class="none-padding traphieu-body" size="lg" title="Gán KV"
  hide-footer>
 <PopupGanKhuVucQuanLyThueBao />
</b-modal>
<!-- end các popup menu -->
<PopupThongTinHenKhachHang ref="popupThongTinHenKH"/>
    </div>

  </div>
</div>

</div>