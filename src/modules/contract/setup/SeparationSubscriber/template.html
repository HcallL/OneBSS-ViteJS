<div class="main-wrapper">
  <vue-bread-crumb :header="header" />
  <vue-nav>
    <ul class="list">
      <li :class="!button.nhapmoi ? 'non-ative' : ''" @click="clickButton('nhapmoi')">
        <a>
          <span class="icon one-file-plus"></span>Nhập mới
        </a>
      </li>
      <li :class="!button.ghilai ? 'non-ative' : ''" @click="clickButton('ghilai')">
        <a> <span class="icon one-save"></span>Ghi lại </a>
      </li>
      <li :class="!button.huybo ? 'non-ative' : ''" @click="clickButton('huybo')">
        <a>
          <span class="icon nc-icon-glyph ui-1_circle-remove"></span>Hủy
        </a>
      </li>
      <li :class="!button.xoa ? 'non-ative' : ''" @click="clickButton('xoa')">
        <a> <span class="icon one-trash"></span>Xóa HĐ </a>
      </li>
      <li :class="!button.thanhtoan ? 'non-ative' : ''" @click="clickButton('thanhtoan')">
        <a>
          <span class="icon nc-icon-glyph shopping_credit-card"></span>Thanh
          toán
        </a>
      </li>

      <li :class="!button.inyc ? 'non-ative' : ''" @click="clickButton('inyc')">
        <a> <span class="icon one-print"></span>Phiếu YC </a>
      </li>
      <li :class="!button.themtb ? 'non-ative' : ''" @click="clickButton('themtb')">
        <a> <span class="icon one-mobile-plus"></span> Thêm TB </a>
      </li>
      <li :class="!button.xoatb ? 'non-ative' : ''" @click="clickButton('xoatb')">
        <a> <span class="icon one-phone-remove"></span> Xóa TB </a>
      </li>
      <li :class="!button.themtb_ds ? 'non-ative' : ''" @click="clickButton('themtb_ds')">
        <a> <span class="icon one-clipart-plus"></span>Thêm DS </a>
      </li>
      <li :class="!button.HTHS ? 'non-ative' : ''" @click="clickButton('HTHS')">
        <a> <span class="icon one-file-check"></span>Hoàn thiện </a>
      </li>
      <li :class="!button.lienhe ? 'non-ative' : ''" @click="clickButton('lienhe')">
        <a>
          <span class="icon nc-icon-glyph business_contacts"></span>Liên hệ
        </a>
      </li>
      <li :class="!button.themtt ? 'non-ative' : ''">
        <a @click="clickButton('themtt')">
          <span class="dropdown-icon one-mobile-plus"></span>Thêm TT
        </a>
      </li>
      <li :class="!button.xoatt ? 'non-ative' : ''">
        <a @click="clickButton('xoatt')">
          <span class="dropdown-icon one-mobile-plus"></span>Xóa TT
        </a>
      </li>
      <li>
        <a @click="ThongTinEmail_Click">
          <span class="dropdown-icon one-mobile-plus"></span>Email
        </a>
      </li>
    </ul>
  </vue-nav>
  <div class="page-content">
    <b-row>
      <b-col md="12">
        <vue-card>
          <b-row>
            <div class="col-sm-8 col-12">
            </div>
            <div class="col-sm-2 col-12">
              <div class="info-row">
                <div class="key w30 nowrap">
                  <div class="check-action">
                    <input type="checkbox" v-model="checkboxNGT" class="check">
                    <span class="name">Người giới thiệu</span>
                  </div>
                </div>
                <div class="value">
                  <ejs-textbox :enabled="checkboxNGT" v-model="form.nhanvien_gt"></ejs-textbox>
                </div>
              </div>
            </div>
            <div class="col-sm-2 col-12">
              <div class="info-row">
                <div class="key w30 nowrap">Tổng tiền</div>
                <div class="value">
                  <input ref="txtTongTien" v-model="form.tongtien_phieu" type="text" class="form-control tright red bold">
                </div>
              </div>
            </div>
          </b-row>
        </vue-card>
      </b-col>
      <b-col md="6">
        <vue-card label="Thông tin phiếu yêu cầu">
          <b-row>
            <vue-element label="Mã giao dịch" class="col-md-7">
              <div class="input-more-button">
                <button @click="chon_magd()" class="btn">
                  <span class="-ap icon-more_horiz"></span>
                </button>
                <vue-input highlight @enter="magd_enter" v-model="form.ma_gd" />
              </div>
            </vue-element>
            <vue-element label="Ngày yêu cầu" class="col-md-5">
              <ejs-datepicker :format="'dd/MM/yyyy'" :disabled="true" v-model="form.ngay_gd" />
            </vue-element>
            <vue-element label="Mã hợp đồng" class="col-md-7">
              <ejs-textbox :enable="false" v-model="form.ma_hd" />
            </vue-element>
            <vue-element label="Ngày lập HĐ" class="col-md-5">
              <ejs-datepicker :disabled="true" :format="'dd/MM/yyyy'" v-model="form.ngaylap_hd" />
            </vue-element>
            <vue-element label="Dịch vụ" class="col-md-7">
              <ejs-dropdownlist v-model="form.dichvuvt_id" :dataSource="options.dichvuVT"
                :fields="{ value: 'dichvuvt_id', text: 'ten_dvvt' }" />
            </vue-element>
            <vue-element label="Loại hình" class="col-md-5">
              <ejs-dropdownlist v-model="form.loaitb_id" :dataSource="options.loaihinhTB" :allowFiltering="true"
                :fields="{ value: 'LOAITB_ID', text: 'LOAIHINH_TB' }" />
            </vue-element>
            <vue-element label="Kiểu yêu cầu" class="col-md-12">
              <ejs-dropdownlist v-model="form.kieuld_id" :dataSource="options.kieuYC"
                :fields="{ value: 'kieuld_id', text: 'ten_kieuld' }" />
            </vue-element>
          </b-row>
        </vue-card>
        <vue-card label="Thông tin thuê bao">
          <b-row>
            <vue-element label="Số máy/Acc" class="col-md-7">
              <div class="input-more-button">
                <button @click="btnThuebao_click" class="btn">
                  <span class="-ap icon-more_horiz"></span>
                </button>
                <input ref="txtMaTB" class="form-control highlight" @keyup.enter="layThongtin" v-model="form.ma_tb" />
              </div>
            </vue-element>
            <vue-element label="Thanh toán" class="col-md-12">
              <ejs-dropdownlist v-model="form.thanhtoan_id" :dataSource="options.thanhtoan" :fields="{
                  value: 'ID', text: 'NAME'
                }" />
            </vue-element>
            <vue-element label="Tên thuê bao" class="col-md-12">
              <ejs-textbox v-model="form.ten_tb" />
            </vue-element>
            <vue-element label="Địa chỉ TB" class="col-md-12">
              <div class="input-more-button">
                <button v-b-modal.popupDiaChiTB class="btn">
                  <span class="-ap icon-more_horiz"></span>
                </button>
                <ChonDiaChiModal @xacnhan="getDiaChiTB" :data="diachiTB" modalId="popupDiaChiTB" />
                <ejs-textbox :enabled="false" v-model="form.diachi_tb" />
              </div>
            </vue-element>
            <vue-element label="Địa chỉ LĐ" class="col-md-12">
              <div class="input-more-button">
                <button class="btn">
                  <span class="-ap icon-more_horiz"></span>
                </button>
                <ejs-textbox :enabled="false" v-model="form.diachi_ld" />
              </div>
            </vue-element>
            <vue-element label="Đối tượng" class="col-md-7">
              <ejs-dropdownlist :enabled="false" v-model="doituong_id" :dataSource="options.doituong"
                :fields="{ value: 'doituong_id', text: 'ten_dt' }" />
            </vue-element>
            <vue-element label="Email" class="col-md-5">
              <ejs-textbox v-model="form.email_tb" />
            </vue-element>
          </b-row>
        </vue-card>
        <vue-card label="Danh sách thuê bao">
          <DataGrid v-bind:columns="collumnDSTB" v-bind:dataSource="options.dsThuebao" :showColumnCheckbox="false"
            :showFilter="false" :allowPaging="false" :enablePagingServer="false"
            :selectionSettings="{ checkboxMode: 'ResetOnRowClick' }" panelDataHeight="200"
            @rowSelected="select_thuebao"></DataGrid>
        </vue-card>
      </b-col>
      <b-col md="6">
        <vue-card label="Thông tin khách hàng">
          <div class="row">
            <vue-element label="Mã khách hàng" class="col-md-12">
              <ejs-textbox :enabled="false" v-model="form.ma_kh" />
            </vue-element>
            <vue-element label="Tên khách hàng" class="col-md-12">
              <ejs-textbox :enabled="false" v-model="form.ten_kh" />
            </vue-element>
            <vue-element label="Địa chỉ khách hàng" class="col-md-12">
              <div class="input-more-button">
                <button v-b-modal.popupDiaChiKH class="btn">
                  <span class="-ap icon-more_horiz"></span>
                </button>
                <ChonDiaChiModal :data="dataDiachikh" modalId="popupDiaChiKH" @xacnhan="getDiaChiKH" />
                <ejs-textbox :enabled="false" v-model="form.diachi_kh" />
              </div>
            </vue-element>
          </div>
        </vue-card>
        <vue-card label="Thông tin thanh toán">
          <b-row>
            <vue-element label="Mã thanh toán" class="col-md-7">
              <div class="input-more-button">
                <button @click="ShowPopupChonMaTT()" class="btn">
                  <span class="-ap icon-more_horiz"></span>
                </button>
                <vue-input disabled @enter="matt_enter" highlight v-model="form.ma_tt" />
              </div>
            </vue-element>
            <vue-element label="Mã đại diện" class="col-md-5">
              <ejs-textbox v-model="form.matb_dd" />
              <!-- <ejs-dropdownlist :enabled="false" v-model="doituong_id" :dataSource="options.doituong"
                :fields="{ value: 'doituong_id', text: 'ten_dt' }" /> -->
            </vue-element>
            <vue-element label="Tên thanh toán" class="col-md-7">
              <ejs-textbox v-model="form.ten_tt" />
            </vue-element>
            <vue-element label="Mã in ghép" class="col-md-5">
              <div class="input-more-button">
                <button @click="btnTaoMIG_Click()" class="btn">
                  <span class="-ap icon-more_horiz"></span>
                </button>
                <ejs-textbox :enabled="false" v-model="form.hdmig_id" />
              </div>
            </vue-element>
            <vue-element label="Địa chỉ TT" class="col-md-12">
              <div class="input-more-button">
                <button v-b-modal.popupDiaChiTT class="btn">
                  <span class="-ap icon-more_horiz"></span>
                </button>
                <ChonDiaChiModal :data="diachiTT" modalId="popupDiaChiTT" @xacnhan="getDiaChiTT" />
                <ejs-textbox :enabled="false" v-model="form.diachi_tt" />
              </div>
            </vue-element>
            <vue-element label="Địa chỉ CT" class="col-md-12">
              <div class="input-more-button">
                <button v-b-modal.popupDiaChiCT class="btn">
                  <span class="-ap icon-more_horiz"></span>
                </button>
                <ChonDiaChiModal :data="diachiCT" modalId="popupDiaChiCT" @xacnhan="getDiaChiCT" />
                <ejs-textbox v-model="form.diachi_ct" />
              </div>
            </vue-element>
            <vue-element label="Địa chỉ BC" class="col-md-12">
              <div class="input-more-button">
                <button v-b-modal.popupDiaChiBC class="btn">
                  <span class="-ap icon-more_horiz"></span>
                </button>
                <ChonDiaChiModal :data="diachiBC" modalId="popupDiaChiBC" @xacnhan="getDiaChiBC" />
                <ejs-textbox :enabled="false" v-model="form.diachi_bc" />
              </div>
            </vue-element>
            <vue-element label="Đơn vị QL" class="col-md-12">
              <ejs-dropdownlist :enabled="false" v-model="donvi_id" :dataSource="options.loaiDV"
                :fields="{ value: 'donvi_id', text: 'ten_dv' }" />
            </vue-element>
            <vue-element label="Hình thức TT" class="col-md-7">
              <ejs-dropdownlist v-model="form.httt_id" :dataSource="options.hinhthucTT"
                :fields="{ value: 'HTTT_ID', text: 'HINHTHUC_TT' }" />
            </vue-element>
            <vue-element label="Mã NVTC (*)" class="col-md-5">
              <PopupTimKiemNhanVienThuCuoc :input="diachiTT" @acceptChange="getNVTCProcess($event)"
                ref="dlgTimKiemNVTC"></PopupTimKiemNhanVienThuCuoc>
              <div class="input-more-button">
                <button @click="popupTimNVThuCuoc()" class="btn">
                  <span class="-ap icon-more_horiz"></span>
                </button>
                <b-row>
                  <b-col md="6 pr-1">
                    <ejs-textbox :enabled="false" v-model="form.ma_nv" />
                  </b-col>
                  <b-col md="6 pl-1">
                    <ejs-textbox :enabled="false" v-model="form.matuyen" />
                  </b-col>
                </b-row>
              </div>
            </vue-element>
            <vue-element label="Tài khoản" class="col-md-7">
              <ejs-textbox v-model="form.stk" />
            </vue-element>
            <vue-element label="Mã số thuế" class="col-md-5">
              <ejs-textbox v-model="form.mst" />
            </vue-element>
            <vue-element label="Ngân hàng" class="col-md-7">
              <div class="input-more-button">
                <button class="btn">
                  <span class="-ap icon-more_horiz"></span>
                </button>
                <ejs-dropdownlist v-model="form.nganhang_id" :dataSource="options.nganhang" :enabled="form.httt_id == 3"
                  :fields="{ value: 'NGANHANG_ID', text: 'TEN_NH' }" />
              </div>
            </vue-element>
            <vue-element label="Mã NVQL" class="col-md-5">
              <ejs-textbox v-model="form.ten_nv_ql" />
            </vue-element>
            <vue-element label="Ghi chú">
              <textarea v-model="form.ghichu" name="" class="form-control"
                style="height: 100px; resize: none"></textarea>
            </vue-element>
          </b-row>
        </vue-card>
        <vue-card label="Chi tiết tiền theo khoản mục">
          <b-row>
            <vue-element labelWidth="90" label="Tiền" class="col-md-7">
              <div class="input-more-button">
                <button @click="ChiTietTienKM_OnClick" class="btn">
                  <span class="-ap icon-more_horiz"></span>
                </button>
                <input disabled v-model="form.tongtien" type="text" class="form-control tright red bold">
              </div>
            </vue-element>
            <vue-element label="VAT" labelWidth="50" class="col-md-5">
              <input disabled v-model="form.tongtienvat" type="text" class="form-control tright red bold">
            </vue-element>
            <vue-element label="Tổng tiền" labelWidth="90" class="col-md-12">
              <input disabled v-model="form.tongtienhd" type="text" class="form-control tright red bold">
            </vue-element>
          </b-row>
        </vue-card>
      </b-col>
      <b-col md="12">
        <vue-card label="Danh sách thanh toán">
          <DataGrid v-bind:columns="collumnDSHD" v-bind:dataSource="options.dsHopdong" :showColumnCheckbox="false"
            :showFilter="false" :allowPaging="false" :enablePagingServer="false"
            :selectionSettings="{ checkboxMode: 'ResetOnRowClick' }" panelDataHeight="200"
            @rowSelected="lvwThanhToan_SelectedIndexChanged"></DataGrid>
        </vue-card>
      </b-col>
    </b-row>
  </div>
  <ejs-dialog :enableResize='true' :visible="false" ref="thongtinemail" :header='"Thông tin Email"' showCloseIcon=true
    target=".main-wrapper" width='60%' height="800">
    <ThongTinEmail />
  </ejs-dialog>
  <SearchContractModal @accept="setMaGD" ref="modal_magd" />
  <popupTraCuuThueBao @chapnhan="setMaTB" ref="tracuuthuebao" />
  <frmTC_DBTB_KH @chapnhan="setDBTB" ref="frmTC_DBTB_KH" />
  <b-modal id="popupComponents" size="xl" hide-footer hide-header hide-header-close body-class="modal-body p-0">
    <component :is="popupComponent" ref="popupComponent" :dulieu="popupComponentData" isPopup="true"
      @form-close="popupClosed" @acceptChangeCTV="popupClosed" @acceptChangeNGT="popupClosed"></component>
    <!--v-dynamic-events="popupComponentEvents"-->
  </b-modal>
  <b-modal id="popup-ChiTietTienKM" size="xl" hide-footer hide-header hide-header-close body-class="modal-body p-0">
    <ChiTietTienKM @acceptTienKM="acceptTienKM($event)" />
  </b-modal>
  <frmNguoiGT ref="frmNguoiGT" @chonNhanvien="chonNhanvien" />
</div>