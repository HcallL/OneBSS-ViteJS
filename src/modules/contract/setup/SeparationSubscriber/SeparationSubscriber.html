<div class="tachnhapthuebao">
    <breadcrumb title_in="Tách, ghép hóa đơn thuê bao"/>
    <div class="list-actions-top">
        <ul class="list">
            <li>
                <a ref="tsbtnNhapMoi" @click="tsbtnNhapMoi_Click" title="Nhập mới">
                    <span class="icon one-file-plus"></span>Nhập mới
                </a>
            </li>
            <li>
                <a ref="tsbtnGhiLai" @click="tsbtnGhiLai_Click" title="Ghi lại">
                    <span class="icon one-save"></span>Ghi lại
                </a>
            </li>
            <li>
                <a ref="tsbtnHuyBo" title="Hủy" @click="tsbtnHuyBo_Click">
                    <span class="icon nc-icon-glyph ui-1_circle-remove"></span>Hủy
                </a>
            </li>
            <li>
                <a ref="tsbtnXoa" title="Xóa HĐ" @click="tsbtnXoa_Click">
                    <span class="icon one-trash"></span>Xóa HĐ (F8)
                </a>
            </li>
            <li>
                <a ref="tsbtnThanhToan" title="Thanh toán" @click="tsbtnThanhToan_Click">
                    <span class="icon nc-icon-glyph shopping_credit-card"></span>Thanh toán
                </a>
            </li>

            <li>
                <a ref="tsbnInPhieuYC" class="disabled" title="Phiếu YC" @click="tsbnInPhieuYC_Click">
                    <span class="icon one-print"></span>Phiếu YC
                </a>
            </li>
            <li>
                <a ref="tsbtnInhopdong" style="display: none;">
                    <span class="icon one-print"></span>In HĐ
                </a>
            </li>
            <li style="display: none;">
                <a ref="tsbtnGiaoPhieu" title="Giao phiếu" class="disabled">
                    <span class="icon one-print"></span>Giao phiếu
                </a>
            </li>
            <li>
                <a ref="tsbtnThemTB" title="Thêm TB" @click="tsbtnThemTB_Click">
                    <span class="icon one-mobile-plus"></span> Thêm TB
                </a>
            </li>
            <li>
                <a ref="tsbtnXoaTB" title="Xóa TB" @click="tsbtnXoaTB_Click">
                    <span class="icon one-phone-remove"></span> Xóa TB
                </a>
            </li>
            <li>
                <a ref="tsbtnThemTT" title="Thêm TT" @click="tsbtnThemTT_Click">
                    <span class="icon one-mobile-plus"></span> Thêm TT
                </a>
            </li>
            <li>
                <a ref="tsbtnXoaTT" title="Xóa TT" @click="tsbtnXoaTT_Click" class="disabled">
                    <span class="icon one-phone-remove"></span> Xóa TT
                </a>
            </li>
            <li>
                <a ref="tsbtnThemTB_DS" title="Thêm DS" @click="tsbtnThemTB_DS_Click">
                    <span class="icon one-clipart-plus"></span>Thêm DS
                </a>
            </li>
            <li>
                <a ref="btnHTHS" @click="btnHTHS_Click" title="Hoàn thiện">
                    <span class="icon one-file-check"></span>Hoàn thiện
                </a>
            </li>


        </ul>
        <div class="more dropdown">
            <a ref="" data-toggle="dropdown">
                <span class="icon -ap  icon-dots-three-vertical"></span>
            </a>
            <div class="dropdown-menu">
                <a ref="tsbtnThongTinLH" title="Liên hệ" @click="tsbtnThongTinLH_Click">
                    <span class="icon nc-icon-glyph business_contacts"></span> Liên hệ
                </a>
                <a ref="tsbtnEmail" title="Email" @click="ThongTinEmail_Click">
                    <span class="dropdown-icon one-email"></span> Email
                </a>
            </div>
        </div>
    </div>
    <div class="page-content">
        <div class="box-form padt8 padb8">
            <div class="row">
                <div class="col-sm-8 col-12">

                </div>
                <div class="col-sm-2 col-12">
                    <div class="info-row">
                        <div class="key w30 nowrap">
                            <div class="check-action">
                                <input ref="chkNguoiGT" @change="chkNguoiGT_CheckedChanged" type="checkbox" class="check">
                                <span class="name">Người giới thiệu</span>
                            </div>
                        </div>
                        <div class="value">
                            <input ref="txtNguoiGT" type="text" class="form-control">
                        </div>
                    </div>
                </div>
                <div class="col-sm-2 col-12">
                    <div class="info-row">
                        <div class="key w30 nowrap">Tổng tiền</div>
                        <div class="value">
                            <input ref="txtTongTienHD" value="0" type="text" class="form-control bold fw6 tright">
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-sm-6 col-12">
                <div class="box-form">
                    <div class="legend-title">Thông tin phiếu yêu cầu</div>
                    <div class="row">
                        <div class="col-sm-7 col-12">
                            <div class="info-row">
                                <div class="key w100">Mã giao dịch</div>
                                <div class="value">
                                    <div class="input-more-button">
                                        <button title="Tìm kiếm theo thông tin giao dịch" ref="btnLayMaGD" @click="btnLayMaGD_Click" class="btn">
                                            <span class="-ap icon-more_horiz"></span>
                                        </button>
                                        <ejs-dialog :enableResize='true' :visible="false" ref="popupFrmTraCuuHopDong"
                                            :header='"Tra cứu hợp đồng, phụ lục"' showCloseIcon=true width="80%"
                                            :target="'#app .main-wrapper'" height="800">
                                            <SearchContractModal ref="searchContractModal"
                                                :donviId="Number($root.token.getDonViID())"
                                                :nhanvienId="Number($root.token.getNhanVienID())"
                                                :loaihd_id="modalSearch.loaihd_id" :kieu="1"
                                                :tthd_id="modalSearch.tthd_id" @accept="acceptSearchContract" />
                                        </ejs-dialog>
                                        <input ref="txtMaGD" @keyup.enter="txtMaGD_KeyPress" type="text" class="form-control bold highlight">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-5 col-12">
                            <div class="info-row">
                                <div class="key w100">Ngày yêu cầu</div>
                                <div class="value">
                                    <VueDateExt disable ref="dtpNgayYC" />
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-7 col-12">
                            <div class="info-row">
                                <div class="key w100">Mã hợp đồng</div>
                                <div class="value">
                                    <input readOnly ref="txtMaHD" type="text" class="form-control bold">
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-5 col-12">
                            <div class="info-row">
                                <div class="key w100">Ngày lập HĐ</div>
                                <div class="value">
                                    <VueDateExt disable ref="dtpNgayLapHD" />
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-7 col-12">
                            <div class="info-row">
                                <div class="key w100">Dịch vụ</div>
                                <div class="value">
                                    <div class="select-custom">
                                        <Select2Ext @change="cboDichVuVT_SelectedValueChanged" ref="cboDichVuVT" />
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-5 col-12">
                            <div class="info-row">
                                <div class="key w100">Loại hình</div>
                                <div class="value">
                                    <div class="select-custom">
                                        <Select2Ext @change="cboLoaihinhTB_SelectedValueChanged"
                                            ref="cboLoaihinhTB" />
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="info-row">
                        <div class="key w100">Kiểu yêu cầu</div>
                        <div class="value">
                            <div class="select-custom">
                                <Select2Ext @change="cboKieuLD_SelectedValueChanged" ref="cboKieuLD" />
                            </div>

                        </div>
                    </div>
                </div>
                <div class="box-form">
                    <div class="legend-title">Thông tin thuê bao</div>
                    <div class="info-row">
                        <div class="key w100">Số máy/Acc</div>
                        <div class="value">
                            <div class="input-more-button">
                                <button title="Chọn các thuê bao khác cùng khách hàng" ref="btnTKMaTB" @click="btnTKMaTB_Click" class="btn">
                                    <span class="-ap icon-more_horiz"></span>
                                </button>
                                <input ref="txtMaTB" @keyup.enter="txtMaTB_KeyPress" type="text"
                                    class="form-control highlight bold">
                            </div>
                        </div>
                    </div>
                    <div class="info-row">
                        <div class="key w100">Thanh toán</div>
                        <div class="value">
                            <div class="select-custom">
                                <Select2Ext ref="cboTT" />
                            </div>
                        </div>
                    </div>
                    <div class="info-row">
                        <div class="key w100">Tên thuê bao</div>
                        <div class="value">
                            <input ref="txtTenTB" type="text" class="form-control bold">
                        </div>
                    </div>
                    <div class="info-row">
                        <div class="key w100">Địa chỉ TB</div>
                        <div class="value">
                            <div class="input-more-button">
                                <button title="Tìm kiếm địa chỉ thuê bao" ref="btnDiaChiTB" @click="btnDiaChiTB_Click" class="btn">
                                    <span class="-ap icon-more_horiz"></span>
                                </button>
                                <input readOnly ref="txtDiaChiTB" type="text" class="form-control bold">
                            </div>
                        </div>
                    </div>
                    <div class="info-row">
                        <div class="key w100">Địa chỉ LĐ</div>
                        <div class="value">
                            <div class="input-more-button">
                                <button disabled ref="btnDiaChiLD" @click="btnDiaChiLD_Click" class="btn">
                                    <span class="-ap icon-more_horiz"></span>
                                </button>
                                <input readOnly ref="txtDiachiLD" type="text" class="form-control bold">
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-sm-7 col-12">
                            <div class="info-row">
                                <div class="key w100">Đối tượng</div>
                                <div class="value">
                                    <div class="select-custom">
                                        <Select2Ext disable ref="cboDoituongTB" />
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-5 col-12">
                            <div class="info-row">
                                <div class="key w100">Email</div>
                                <div class="value">
                                    <input ref="txtEmailTB" type="text" class="form-control">
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
                <div class="box-form">
                    <div class="legend-title">Danh sách thuê bao</div>
                    <div class="table-content" style="height: 250px;">
                        <DataGridCustom v-bind:columns="columnsTB" ref="lvwThueBao"
                            @rowSelected="lvwThueBao_SelectedIndexChanged" />
                    </div>
                </div>
            </div>
            <div class="col-sm-6 col-12">
                <div class="box-form" style="min-height: 223px;">
                    <div class="legend-title">Thông tin khách hàng</div>
                    <div class="info-row">
                        <div class="key">Mã khách hàng</div>
                        <div class="value">
                            <input readOnly ref="txtMaKH" type="text" class="form-control bold">
                        </div>
                    </div>
                    <div class="info-row">
                        <div class="key">Tên khách hàng</div>
                        <div class="value">
                            <input readOnly ref="txtTenKH" type="text" class="form-control bold">
                        </div>
                    </div>
                    <div class="info-row">
                        <div class="key">Địa chỉ KH</div>
                        <div class="value">
                            <div class="input-more-button">
                                <button ref="btnDiaChiKH" @click="btnDiaChiKH_Click" class="btn">
                                    <span class="-ap icon-more_horiz"></span>
                                </button>
                                <input readOnly ref="txtDiaChiKH" type="text" class="form-control bold">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="box-form">
                    <div class="legend-title">Thông tin thanh toán</div>
                    <div class="row">
                        <div class="col-sm-7 col-12">
                            <div class="info-row">
                                <div class="key">Mã thanh toán <span class="red">*</span></div>
                                <div class="value">
                                    <div class="input-more-button">
                                        <button title="Tìm kiếm thông tin thanh toán" ref="btnLayMaTT" @click="btnLayMaTT_Click" class="btn">
                                            <span class="-ap icon-more_horiz"></span>
                                        </button>
                                        <input @keyup.enter="txtMaTT_Enter" disabled ref="txtMaTT" type="text" class="form-control ">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-5 col-12">
                            <div class="info-row">
                                <div class="key w100">Mã đại diện</div>
                                <div class="value">
                                    <div class="select-custom">
                                        <Select2Ext ref="cboMaDD" />
                                        <input type="hidden" ref="txtMaTBDD" />
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-7 col-12">
                            <div class="info-row">
                                <div class="key">Tên thanh toán</div>
                                <div class="value">
                                    <input ref="txtTenTT" type="text" class="form-control bold">
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-5 col-12">
                            <div class="info-row">
                                <div class="key w100">Mã in ghép</div>
                                <div class="value">
                                    <div class="input-more-button">
                                        <button title="Chọn mã thanh toán ghép hóa đơn" @click="btnTaoMIG_Click" ref="btnTaoMIG" class="btn">
                                            <span class="-ap icon-more_horiz"></span>
                                        </button>
                                        <input readOnly ref="txtMaIG" type="text" class="form-control bold">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="info-row">
                        <div class="key">Địa chỉ TT</div>
                        <div class="value">
                            <div class="input-more-button">
                                <button title="Tìm kiếm địa chỉ thanh toán" ref="btnDiaChiTT" @click="btnDiaChiTT_Click" class="btn">
                                    <span class="-ap icon-more_horiz"></span>
                                </button>
                                <input readOnly ref="txtDiaChiTT" type="text" class="form-control bold">
                            </div>
                        </div>
                    </div>
                    <div class="info-row">
                        <div class="key">Địa chỉ CT</div>
                        <div class="value">
                            <div class="input-more-button">
                                <button title="Tìm kiếm địa chỉ chứng từ" ref="btnDiaChiCT" @click="btnDiaChiCT_Click" class="btn">
                                    <span class="-ap icon-more_horiz"></span>
                                </button>
                                <input ref="txtDiachiCT" type="text" class="form-control bold">
                            </div>
                        </div>
                    </div>
                    <div class="info-row">
                        <div class="key">Địa chỉ BC</div>
                        <div class="value">
                            <div class="input-more-button">
                                <button title="Chọn địa chỉ thanh toán" ref="btnDiaChiBC" @click="btnDiaChiBC_Click" class="btn">
                                    <span class="-ap icon-more_horiz"></span>
                                </button>
                                <input readOnly ref="txtDiaChiBC" type="text" class="form-control ">
                            </div>
                        </div>
                    </div>
                    <div class="info-row">
                        <div class="key">Đơn vị QL</div>
                        <div class="value">
                            <div class="select-custom">
                                <Select2Ext disable ref="cboDonViQL" />
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-7 col-12">
                            <div class="info-row">
                                <div class="key">Hình thức TT</div>
                                <div class="value">
                                    <div class="select-custom">
                                        <Select2Ext @change="cboHTTT_SelectedValueChanged" ref="cboHTTT" />
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-5 col-12">
                            <div class="info-row">
                                <div class="key w100">Mã NVTC <span class="red">*</span></div>
                                <div class="value">
                                    <div class="row">
                                        <div class="col-sm-7 col-12">
                                            <div class="input-more-button">
                                                <button title="Tìm kiếm thông tin nhân viên thu cước" @click="btnTraCuuNVTC_Click" class="btn">
                                                    <span class="-ap icon-more_horiz"></span>
                                                </button>
                                                <input readOnly ref="txtMaNVTC" type="text" class="form-control highlight bold">
                                            </div>

                                        </div>
                                        <div class="col-sm-5 col-12">
                                            <input readOnly ref="txtMaTuyen" type="text" class="form-control highlight bold">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-7 col-12">
                            <div class="info-row">
                                <div class="key">Tài khoản</div>
                                <div class="value">
                                    <input ref="txtSTK_TT" type="text" class="form-control">
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-5 col-12">
                            <div class="info-row">
                                <div class="key w100">Mã số thuế</div>
                                <div class="value">
                                    <input ref="txtMST_TT" type="text" class="form-control">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-7 col-12">
                            <div class="info-row">
                                <div class="key">Ngân hàng</div>
                                <div class="value">
                                    <div class="input-more-button">
                                        <button title="Tìm kiếm thông tin ngân hàng" ref="btnNSNN" @click="btnNSNN_Click" class="btn">
                                            <span class="-ap icon-more_horiz"></span>
                                        </button>
                                        <div class="select-custom">
                                            <Select2Ext ref="cboNganHang" />
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-5 col-12">
                            <div class="info-row">
                                <div class="key w100">Mã NVQL</div>
                                <div class="value">
                                    <input readOnly type="text" ref="txtNhanVienQL" class="form-control highlight bold">
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="info-row">
                        <div class="key">Ghi chú</div>
                        <div class="value">
                            <textarea ref="txtGhiChu" name="" class="form-control"
                                style="height: 100px;resize: none;"></textarea>
                        </div>
                    </div>
                </div>
                <div class="box-form">
                    <div class="legend-title" title="Chi tiết tiền theo khoản mục">Chi tiết tiền theo khoản mục</div>
                    <div class="row">
                        <div class="col-sm-7 col-12">
                            <div class="info-row">
                                <div class="key">Tổng tiền</div>
                                <div class="value">
                                    <div class="input-more-button">
                                        <button title="Chọn dịch vụ cộng thêm" @click="btnTien_Click" class="btn">
                                            <span class="-ap icon-more_horiz"></span>
                                        </button>
                                        <input readOnly ref="txtTongTien" type="text" class="form-control bold fw6 red tright"
                                            value="0">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-5 col-12">
                            <div class="info-row">
                                <div class="key w100">Tổng VAT</div>
                                <div class="value">
                                    <input readOnly ref="txtTongVat" type="text" class="form-control bold fw6 red tright" value="0">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="info-row" style="display:none">
                        <div class="key">Tổng tiền</div>
                        <div class="value">
                            <input ref="lblTongTien" readOnly type="text" class="form-control bold fw6 red tright" value="0">
                        </div>
                    </div>

                </div>
            </div>
        </div>
        <div class="box-form">
            <div class="legend-title">Danh sách thanh toán 
            <span class="pull-right red text-bold">
                Tiền thuê bao(Có VAT): {{$refs.lblTongTien ? $refs.lblTongTien.value : 0}}
            </span></div>
            <div class="table-content">
                <DataGridCustom v-bind:columns="columnsTT" @rowSelected="lvwThanhToan_SelectedIndexChanged"
                    ref="lvwThanhToan" />
            </div>
        </div>
    </div>
    <frmNguoiGT ref="frmNguoiGT" @chonNhanvien="chonNhanvien" />
    <popupTraCuuThueBao @chapnhan="setMaTB" ref="tracuuthuebao" />
    <DiaChiModal ref="diaChiModal" :data="dataDiaChi" @accept="onAcceptDiaChi" />
    <frmTC_DBTB_KH @chapnhan="setDBTB" ref="frmTC_DBTB_KH" />
    <b-modal ref="ThongTinEmail" id="ThongTinEmail" size="xl" title="Thông tin Email" hide-footer
        body-class="p-0 thanhtoan-modal">
        <ThongTinEmail :hdkh_id="hdkh_id" :khachhang_id="khachhang_id" />
    </b-modal>
    <b-modal ref="ThongTinLienHe" id="ThongTinLienHe" size="xl" title="Thôn tin liên hệ" hide-footer
        body-class="p-0 thanhtoan-modal">
        <ThongTinLienHe :hdkh_id="hdkh_id" :khachhang_id="khachhang_id" />
    </b-modal>
    <b-modal id="popupComponents" size="xl"
    hide-footer
    hide-header
    hide-header-close
    body-class="modal-body p-0">
        <component :is="popupComponent" ref="generalPopup" :dulieu="popupComponentData" v-bind="popupComponentAttr" isPopup="true" v-on="popupComponentEvts"></component> <!--v-dynamic-events="popupComponentEvents"-->
    </b-modal>
    <InHoSo ref="popupInHoSo" :params="popupInHoSo_Param"/>
    <popupChiTietMLNS ref="popupChiTietMLNS" @hideDialog="acceptNganhang" :nganhang_input="objNganhang"/>
    <frmCT_Tien_KM ref="frmCT_Tien_KM" @closeDialog="btnTien_Close" />
    <b-modal id="SearchGeneral"            
            size="xl"          
            header-class="popup-header"
            content-class="thanhly-content"
            title="Tra cứu danh bạ"
            hide-footer
    >  
      <SearchGeneral  :inMaTB="$refs.txtMaTB ? $refs.txtMaTB.value : ''"/>
    </b-modal>
    <PopupTimKiemNhanVienThuCuoc :input="objNVTC"  @response-data="getNVTCProcess($event)" id="dlgTimKiemNVTC"></PopupTimKiemNhanVienThuCuoc>
    <ejs-dialog :enableResize='true'  :visible='false' ref='thanhtoanDialog' :position='position'
    :header='"THANH TOÁN HỢP ĐỒNG"' showCloseIcon='true' :target='targetTop' width='100%' :open="open_thanhToanPopUp">
    <!-- <thanhToan ref='thanhToanPopUp'  @paymentSuccess="paymentSuccess"/> -->
        <keep-alive>
        <div class="popupComponentPayment">
            <component :is="userComponentModule"  ref='thanhToanPopUp' :ispopup="true" :magiaodich='txtMaGDTT'  v-bind="popupComponentAttr" v-on="popupComponentEvts" />
        </div>
        </keep-alive>
    </ejs-dialog>
</div>