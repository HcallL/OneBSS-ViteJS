<div>
	<!-- <breadcrumb :header="header" v-if="!dulieu.isPopup"/> -->
	<div class="breadcrumb-top">
		<div class="main-title">Đặt cọc trả trước</div>
	</div>
	<div class="list-actions-top">
		<ul class="list">
			<li>
				<a href="javascript:;" @click="btnLayTT_click">
					<span class="icon one-file-attach"></span>Lấy TT
				</a>
			</li>
			<li>
				<a href="javascript:;" :class="{ disabled: !button.tsbtnNhapMoi }" @click="tsbtnNhapMoi_Click">
					<span class="icon one-file-plus"></span>Nhập mới
				</a>
			</li>
			<li>
				<a href="javascript:;" :class="{ disabled: !button.tsbtnGhiLai }" @click="tsbtnGhiLai_Click">
					<span class="icon one-save"></span>Ghi lại
				</a>
			</li>
			<li>
				<a href="javascript:;" :class="{ disabled: !button.tsbtnXoa }" @click="tsbtnXoa_Click">
					<span class="icon one-trash"></span>Xóa
				</a>
			</li>
			<li>
				<a href="javascript:;" :class="{ disabled: !button.tsbtnHuyBo }" @click="tsbtnHuyBo_Click">
					<span class="icon nc-icon-glyph ui-1_circle-remove"></span>Hủy
				</a>
			</li>
			<!-- <li>
				<a href="javascript:;" :class="{ disabled: !button.tsbtnThemTB }" @click="tsbtnThemTB_Click">
					<span class="icon one-mobile-plus"></span>Thêm TB
				</a>
			</li>
			<li>
				<a href="javascript:;" :class="{ disabled: !button.tsbtnXoaTB }" @click="tsbtnXoaTB_Click">
					<span class="icon one-phone-remove"></span>Xóa TB
				</a>
			</li> -->
		</ul>
	</div>
	<div class="page-content">
		<div class="box-form">
			<div class="row">
				<div class="col-sm-8 col-12">

				</div>
				<div class="col-sm-2 col-12">
					<div class="info-row">
						<div class="key w20 nowrap fw6">
							<div class="check-action">
								<input type="checkbox" class="check" v-model="filterbox.ctv.chkCTV" @change="ShowPopupCTV">
								<span class="name">Cộng tác viên</span>
							</div>
						</div>
						<div class="value">
							<input type="text" class="form-control bold" v-bind:value="filterbox.ctv.txtCTV"
								@change="e => filterbox.ctv.txtCTV = e.target.value" disabled>
						</div>
					</div>
				</div>
				<div class="col-sm-2 col-12">
					<div class="info-row">
						<div class="key w20 nowrap fw6">
							<div class="check-action">
								<input type="checkbox" class="check" v-model="filterbox.nguoigt.chkNguoiGT" @change="ShowPopupNguoiGT">
								<span class="name">Người giới thiệu</span>
							</div>
						</div>
						<div class="value">
							<input type="text" class="form-control bold" v-bind:value="filterbox.nguoigt.txtNguoiGT"
								@change="e => filterbox.nguoigt.txtNguoiGT = e.target.value" disabled>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class="row" :key="re_render">
			<div :class="formWidth > 1450 ? 'col-sm-6 col-12' : 'col-sm-12 col-12'" style="vertical-align: baseline">
				<div class="box-form" style="height: calc(100% - 8px)">
					<div class="legend-title" style="height: 32px;">
						<div class="pull-left">Thông tin thuê bao</div>
						<div class="pull-right">
						</div>
						<div class="clearfix"></div>
					</div>
					<div class="row">
						<div class="col-sm-6 col-12">
							<div class="info-row">
								<div class="key w100">Mã giao dịch</div>
								<div class="value">
									<div class="input-more-button">
										<button class="btn" @click="btnLayMaGD_Click" :disabled="!txtMaGD.Enabled">
											<span class="-ap icon-more_horiz"></span>
										</button>
										<input type="text" class="form-control highlight bold" ref="txtMaGD" v-bind:value="txtMaGD.value"
											@change="e => txtMaGD.value = e.target.value" @keyup.enter="txtMaGD_KeyPress" :disabled="!txtMaGD.Enabled">
									</div>
								</div>
							</div>
						</div>
						<div class="col-sm-6 col-12">
							<div class="info-row">
								<div class="key w100">Ngày yêu cầu</div>
								<div class="value">
									<DatePicker disabled :format="dateFormat" placeholder="__/__/____" :value-type="'format'" v-model="dtpNgayYeuCau.value"
										ref="dtpNgayYeuCau" @change="onChangeNgayYC"
										:input-attr="{required: 'true',title: 'Bạn chưa nhập ngày yêu cầu!'}">
									</DatePicker>
								</div>
							</div>
						</div>
					</div>					
					<div class="row">
						<div class="col-sm-6 col-12">
							<div class="info-row">
								<div class="key w100">Số máy/Acc</div>
								<div class="value">
									<div class="input-more-button">
										<button class="btn" @click="btnTKMaTB_Click" disabled>
											<span class="-ap icon-more_horiz"></span>
										</button>
										<input type="text" class="form-control highlight bold" ref="txtMaTB" v-bind:value="txtMaTB.value" disabled
											@change="e => txtMaTB.value = e.target.value" @keyup.enter="txtMaTB_KeyPress">
									</div>
								</div>
							</div>
						</div>
						<div class="col-sm-6 col-12">
							<div class="info-row">
								<div class="key w100">Tốc độ</div>
								<div class="value">
									<!-- <div class="select-custom" ref="dstocdo">
										<select2 disabled :settings="{ dropdownParent: $refs['dstocdo'] }" v-model="cboGoiCuocAdsl.value" disabled
											class="select2" :options="cboGoiCuocAdsl.Items"></select2>
									</div> -->
									<input type="text" class="form-control" v-bind:value="cboGoiCuocAdsl.text"
										@change="e => cboGoiCuocAdsl.text = e.target.value" disabled>
								</div>
							</div>
						</div>
					</div>
					<div class="row">
						<div class="col-sm-6 col-12">
							<div class="info-row">
								<div class="key w100">Dịch vụ</div>
								<div class="value">
									<!-- <div class="select-custom" ref="dsdichvuvt">
										<select2 :settings="{ dropdownParent: $refs['dsdichvuvt'] }" v-model="cp_dichvuvt_id" class="select2" disabled
											:options="cboDichVuVT.Items"></select2>										
									</div> -->
									<input type="text" class="form-control" v-bind:value="cboDichVuVT.text" @change="e => cboDichVuVT.text = e.target.value"
										disabled>
								</div>
							</div>
						</div>
						<div class="col-sm-6 col-12">
							<div class="info-row">
								<div class="key w100">Loại hình</div>
								<div class="value">
									<!-- <div class="select-custom" ref="dsloaihinhtb">
										<select2 :settings="{ dropdownParent: $refs['dsloaihinhtb'] }" v-model="cboLoaiHinhTB.value" class="select2" disabled
											:options="cboLoaiHinhTB.Items" @change="onChangeLoaiHinhTB"></select2>
									</div> -->
									<input type="text" class="form-control" v-bind:value="cboLoaiHinhTB.text" @change="e => cboLoaiHinhTB.text = e.target.value"
										disabled>
								</div>
							</div>
						</div>
					</div>
					<div class="row">
						<div class="col-sm-6 col-12">
							<div class="info-row">
								<div class="key w100">Tên thuê bao</div>
								<div class="value">
									<input type="text" class="form-control bold" v-bind:value="txtTenTB.value"
										@change="e => txtTenTB.value = e.target.value" disabled>
								</div>
							</div>
						</div>
						<div class="col-sm-6 col-12">
							<div class="info-row">
								<div class="key w100">Tên KH</div>
								<div class="value">
									<input type="text" class="form-control bold" v-bind:value="txtTenKH.value"
										@change="e => txtTenKH.value = e.target.value" disabled>
								</div>
							</div>
						</div>
					</div>
					<div class="row">
						<div class="col-sm-12 col-12">
							<div class="info-row">
								<div class="key w100">Gói đa dịch vụ</div>
								<div class="value">
									<input type="text" class="form-control bold" v-bind:value="txtGoiDaDV.value"
										@change="e => txtGoiDaDV.value = e.target.value" disabled>
								</div>
							</div>
						</div>
					</div>
					<div class="row">
						<div class="col-sm-12 col-12">
							<div class="info-row">
								<div class="key w100">Địa chỉ KH</div>
								<div class="value">
									<input type="text" class="form-control bold" v-bind:value="txtDiaChiKH.value"
										@change="e => txtDiaChiKH.value = e.target.value" disabled>
								</div>
							</div>
						</div>
					</div>
					<div class="row">
						<div class="col-sm-12 col-12">
							<div class="info-row">
								<div class="key w100">Địa chỉ LĐ</div>
								<div class="value">
									<input type="text" class="form-control bold" v-bind:value="txtDiaChiLD.value"
										@change="e => txtDiaChiLD.value = e.target.value" disabled>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
			<div :class="formWidth > 1450 ? 'col-sm-6 col-12' : 'col-sm-12 col-12'" style="vertical-align: baseline">
				<div class="box-form" style="height: calc(100% - 8px)">
					<div class="legend-title" style="height: 32px;">
						<div class="pull-left">Thông tin trả trước</div>
						<div class="pull-right">
							<div class="list-actions-top" style="margin-top: -15px; width: fit-content;">
								<ul class="list">
									<li>
										<a href="javascript:;" :class="{ disabled: button.tsbtnChapNhanTT }" @click="tsbtnChapNhanTT_Click">
											<span class="icon one-change"></span>Chấp nhận
										</a>
									</li>
									<li>
										<a href="javascript:;" :class="{ disabled: button.tsbtnHuyBoTT }" @click="tsbtnHuyBoTT_Click">
											<span class="icon nc-icon-glyph ui-1_circle-remove"></span>Hủy
										</a>
									</li>
								</ul>
							</div>
						</div>
						<div class="clearfix"></div>
					</div>					
					<div class="row">
						<div class="col-sm-12 col-12">
							<div class="info-row">
								<div class="key w100">Nhóm đặt cọc <span class="red">*</span></div>
								<div class="value">
									<div class="select-custom" ref="cboNhomDC" style="width: calc(100%) !important;">
										<select2 :settings="{ dropdownParent: $refs['cboNhomDC'] }" ref="cboNhomDC" v-model="cboNhomDC.value"
											placeholder="Chọn nhóm đặt cọc" class="select2" @change="onChangeNhomDC" 
											:options="cboNhomDC.Items && cboNhomDC.Items.length > 0 ? cboNhomDC.Items.map(e => ({id: e.NHOM_DATCOC_ID, text:`${e.NHOM_DATCOC_ID} . ${e.TEN_NHOM}`})) : []">
										</select2>
									</div>
								</div>
							</div>
						</div>
					</div>
					<div class="row">
						<div class="col-sm-12 col-12">
							<div class="custom-row marb5">
								<div style="width: 100px !important">Trả trước <span class="red">*</span></div>
								<div class="custom-row" style="width: calc(100% - 100px) !important; padding-left: .4rem !important;">
									<div class="select-custom" ref="dstratruoc" style="width: calc(100%) !important;">
										<select2 :settings="{ dropdownParent: $refs['dstratruoc'] }" ref="cboTraTruoc" v-model="cboTraTruoc.value" placeholder="Chọn trả trước"
											class="select2" @change="onChangeTraTruoc"
											:options="cboTraTruoc.Items && cboTraTruoc.Items.length > 0 ? cboTraTruoc.Items.map(e=> ({id: e.KHUYENMAI_ID,text: e.TEN_KM})) : []">
										</select2>
									</div>
								</div>
							</div>
						</div>
					</div>
					<div class="row">
						<div class="col-sm-12 col-12">
							<div class="info-row">
								<div class="key w100">Số tháng ĐC <span class="red">*</span></div>
								<div class="value">
									<div class="select-custom" ref="cboSoThangDC" style="width: calc(100%) !important;">
										<select2 :settings="{ dropdownParent: $refs['cboSoThangDC'] }" ref="cboSoThangDC" v-model="cboSoThangDC.value"
											placeholder="Chọn số tháng" class="select2" @change="onChangeSoThang"
											:options="cboSoThangDC.Items">
										</select2>
									</div>
								</div>
							</div>
						</div>
					</div>
					<div class="row" v-if="cboCTTraTruoc.Enabled">
						<div class="col-sm-12 col-12">
							<div class="custom-row marb5">
								<div style="width: 100px !important">CT Trả trước <span class="red">*</span></div>
								<div class="custom-row" style="width: calc(100% - 100px) !important; padding-left: .5rem !important;">
									<div class="select-custom" ref="dscttratruoc" style="width: calc(100%) !important">
										<select2 :settings="{ dropdownParent: $refs['dscttratruoc'] }" ref="cboCTTraTruoc" v-model="cboCTTraTruoc.value" placeholder="Chọn chi tiết trả trước"
											class="select2" @change="onChangeCTTraTruoc"
											:options="cboCTTraTruoc.Items && cboCTTraTruoc.Items.length > 0 ? cboCTTraTruoc.Items.map(e=> ({id: e.CHITIETKM_ID,text: e.TEN_CTKM})) : []">
										</select2>
									</div>
								</div>
							</div>
						</div>
					</div>
					<div class="row">
						<div class="col-sm-6 col-12">
							<div class="info-row">
								<div class="key w100">Ngày BĐĐC</div>
								<div class="value">
									<DatePicker :format="dateFormat" :value-type="'format'" v-model="dtpNgayBDDC.value" ref="dtpNgayBDDC"
										@change="onChangeNgayBDDC">
									</DatePicker>
								</div>
							</div>
						</div>
						<div class="col-sm-6 col-12">
							<div class="info-row">
								<div class="key w100">Ngày KTĐC</div>
								<div class="value">
									<DatePicker :format="dateFormat" :value-type="'format'" v-model="dtpNgayKTDC.value" ref="dtpNgayKTDC"
										@change="onChangeNgayKTDC">
									</DatePicker>
								</div>
							</div>
						</div>
					</div>
					<div class="row">
						<div class="col-sm-6 col-12">
							<div class="info-row">
								<div class="key w100">Cước ĐC</div>
								<div class="value">
									<input type="text" class="form-control bold tright red" value="0" v-bind:value="cp_CuocDC"
										@change="e => cp_CuocDC = e.target.value" :disabled="!txtCuocDC.Enabled">
								</div>
							</div>
						</div>
						<div class="col-sm-6 col-12">
							<div class="info-row">
								<div class="key w100">Tiền/tháng</div>
								<div class="value">
									<input type="text" class="form-control bold tright red" value="0" v-bind:value="cp_TienTD"
										@change="e => cp_TienTD = e.target.value" :disabled="!txtTienTD.Enabled">
								</div>
							</div>
						</div>
					</div>
					<div class="row">
						<div class="col-sm-12 col-12">
							<div class="info-row">
								<div class="key w100">Ghi chú</div>
								<div class="value">
									<textarea name="" class="form-control" style="height: 70px;resize: none;" v-bind:value="txtGhiChu.value"
										@change="e => txtGhiChu.value = e.target.value"></textarea>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class="box-form">
			<div class="legend-title">
				<div class="pull-left">Danh sách thuê bao tham gia đặt cọc</div>				
				<div class="pull-right">
					<input type="checkbox" class="check" style="width: 18px; height: 18px" v-model="chkTB_CungNhom"> Chọn thuê bao
					cùng nhóm
				</div>
				<div class="clearfix"></div>
			</div>
			<div class="row">
				<div class="col-sm-6 col-12">
					<KDataGrid class="table-result table-gachle" :columns="gridDSThueBao.header" :dataSource="gridDSThueBao.list" :allowResizing="true"
						:enable-paging-server="false" :allowPaging="true" :showFilter="true" :showColumnCheckbox="false" :allowGrouping="true" :groupSettings="gridDSThueBao.groupSettings"
						:enabledSelectFirstRow="false" ref="gridDSThueBao" @selectedItemsChanged="gridDSThueBao_FocusedRowChanged"
						panelDataHeight="300px" :key="key_gridTB"/>
				</div>
				<div class="col-sm-6 col-12">
					<KDataGrid class="table-result table-gachle" :columns="gridDSCTTraTruoc.header" :dataSource="gridDSCTTraTruoc.list" :allowResizing="true"
						:enable-paging-server="false" :allowPaging="true" :showFilter="true" :showColumnCheckbox="false" :allowGrouping="true" :groupSettings="gridDSCTTraTruoc.groupSettings"
						:enabledSelectFirstRow="false" ref="gridDSCTTraTruoc" @selectedItemsChanged="gridDSThueBao_FocusedRowChanged"
						panelDataHeight="300px" :key="key_gridTB"/>
				</div>
			</div>
		</div>
		<div class="box-form">
			<div class="legend-title">Danh sách hợp đồng đặt cọc của thuê bao</div>
			<div class="row">
				<div class="col-sm-6 col-12">
					<KDataGrid class="table-result table-gachle" :columns="gridDSHopDong.header" :dataSource="gridDSHopDong.list"
						:allowResizing="true" :enable-paging-server="false" :allowPaging="true" :showFilter="true"
						:showColumnCheckbox="false" :defaultColumnCheckboxChecked="false" 
						:allowGrouping="true" :groupSettings="gridDSHopDong.groupSettings" :enabledSelectFirstRow="false" 
						ref="gridDSHopDong" @selectedItemsChanged="gridDSHopDong_FocusedRowChanged"
						:key="key_gridHD" />
				</div>
				<div class="col-sm-6 col-12">
					<KDataGrid class="table-result table-gachle" :columns="gridDSCTTraTruoc_HD.header" :dataSource="gridDSCTTraTruoc_HD.list"
						:allowResizing="true" :enable-paging-server="false" :allowPaging="true" :showFilter="true"
						:showColumnCheckbox="false" :allowGrouping="true" :groupSettings="gridDSCTTraTruoc_HD.groupSettings"
						:enabledSelectFirstRow="false" ref="gridDSCTTraTruoc_HD" @selectedItemsChanged="gridDSHopDong_FocusedRowChanged"
						:key="key_gridHD" />
				</div>
			</div>
		</div>
	</div>

	<SearchContractModal ref="popupSearchContract" @accept="acceptTimKiemHDTB" :loai_hd_id="31"
		:dichvu_id="cp_dichvuvt_id" :tieuchi_id="tieuchi_id" :thongtin_tracuu="thongtin_tracuu" />

	<b-modal id="popupComponents1" size="xl" :title="popupComponentHeader" :hide-header="popupComponentHeader?false:true"
		hide-footer body-class="modal-body p-0" modal-class="hoso-dientu">
		<component :is="popupComponent" ref="generalPopup" :dulieu="popupComponentData" v-bind="popupComponentAttr"
			isPopup="true" v-on="popupComponentEvts"></component>
	</b-modal>

	<script type="application/javascript" src="../vendor/jquery/split.js"></script>
</div>