<div class="tts-giaophieu-xuly-suco">
    <div class="list-actions-top">
        <ul class="list" style="width: 100% !important">
            <li @click="btnTimKiem_Click">
                <a href="javascript:void(0)">
                    <span class="icon one-search"></span>Tìm kiếm
                </a>
            </li>
            <li :class="{'disable-btn': !btnGiaoPhieu.Enabled}" @click="btnGiaoPhieu_Click">
                <a href="javascript:void(0)">
                    <span class="icon one-file-arrow-right1"></span>Giao phiếu
                </a>
            </li>
            <li :class="{'disable-btn': !btnCapNhat.Enabled}" @click="btnCapNhat_Click">
                <a href="javascript:void(0)">
                    <span class="icon one-file-check2"></span>Cập nhật
                </a>
            </li>
            <li v-show="btnHuyGiao.Visible" :class="{'disable-btn': !btnHuyGiao.Enabled}" @click="btnHuyGiao_Click">
                <a href="javascript:void(0)">
                    <span class="icon ui-1_circle-remove nc-icon-glyph"></span>Hủy giao
                </a>
            </li>
            <li v-show="btnKhoaPhieu.Visible" :class="{'disable-btn': !btnKhoaPhieu.Enabled}" @click="btnKhoaPhieu_Click">
                <a href="javascript:void(0)">
                    <span class="icon one-file-lock"></span>Khóa phiếu
                </a>
            </li>
            <li v-show="lblThietHaiDT.Visible" class="disable-btn" style="float: right;">
                <a href="javascript:void(0)" style="border-left: 0; color: darkred !important; font-weight: bold;">
                    THIỆT HẠI DOANH THU TẠM TÍNH: 0 (đ/h)
                </a>
            </li>
        </ul>
    </div>
    <div class="page-content">
        <div class="box-form">
            <div class="legend-title">Thông tin tìm kiếm</div>
            <div class="row">
                <div class="col-sm-3 col-12">
                    <div class="info-row">
                        <div class="key">
                            <div class="check-action">
                                <input type="checkbox" class="check" v-model="cbxNguonSC.Checked">
                                <span class="name">Nguồn sự cố</span>
                            </div>
                        </div>
                        <div class="value">
                            <SelectExt 	
                                v-model="cboNguonSC.Value" 
                                :dataSource="cboNguonSC.DataSource" 
                                :disabled="!cboNguonSC.Enabled"
                                dataTextField="MOTA"
                                dataValueField="NGUONSC_ID" />
                        </div>
                    </div>
                </div>
                <div class="col-sm-3 col-12">
                    <div class="info-row">
                        <div class="key w70">
                            Mã sự cố
                        </div>
                        <div class="value">
                            <input type="text" class="form-control highlight" v-on:keyup.enter="txtMaSC_KeyUp" v-model="txtMaSC.Text" />
                        </div>
                    </div>
                </div>
                <div class="col-sm-3 col-12">
                    <div class="info-row">
                        <div class="key">
                            <div class="check-action">
                                <input type="checkbox" class="check" v-model="cbxNgayGiao.Checked">
                                <span class="name">Ngày giao</span>
                            </div>
                        </div>
                        <div class="value">
                            <ejs-datepicker
                                v-model="dtpNgayGiao.DateTime"
                                :enabled="dtpNgayGiao.Enabled"
                                class="form-control bg-none bor0 fw6 text h24" 
                                placeholder=""
                                format="dd/MM/yyyy"></ejs-datepicker>
                        </div>
                    </div>
                </div>
                <div class="col-sm-3 col-12">
                    <div class="info-row">
                        <div class="key w140">
                            Mức độ sự cố
                        </div>
                        <div class="value">
                            <SelectExt 	
                                v-model="cboMucDoSC.Value" 
                                :dataSource="cboMucDoSC.DataSource" 
                                dataTextField="MUCDO_SC"
                                dataValueField="MUCDO_ID"/>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-sm-6 col-12">
                    <div class="info-row">
                        <div class="key">
                            <div class="check-action">
                                <input type="checkbox" class="check" v-model="cbxQuyTrinh.Checked">
                                <span class="name">Quy trình</span>
                            </div>
                        </div>
                        <div class="value">
                            <SelectExt 	
                                v-model="cboQuyTrinh.Value" 
                                :dataSource="cboQuyTrinh.DataSource"
                                :disabled="!cboQuyTrinh.Enabled"
                                dataValueField="QUYTRINH_ID"
                                dataTextField="QUYTRINH"/>
                        </div>
                    </div>
                </div>
                <div class="col-sm-3 col-12">
                    <div class="info-row">
                        <div class="key">
                            Thao tác
                        </div>
                        <div class="value">
                            <SelectExt 	
                                v-model="cboTrangThai.Value" 
                                :dataSource="cboTrangThai.DataSource" 
                                dataValueField="TRANGTHAI_ID"
                                dataTextField="TRANGTHAI"/>
                        </div>
                    </div>
                </div>
                <div class="col-sm-3 col-12">
                    <div class="info-row">
                        <div class="key w140">
                            Quy trình xử lý
                        </div>
                        <div class="value">
                            <input type="text" class="form-control highlight" v-model="txtQuyTrinhNET.Text" />
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-sm-6 col-12">
                <div class="box-form">
                    <div class="legend-title">
                        <div class="pull-left">Danh sách sự cố</div>
                        <div class="pull-right">
                            <a href="javascript:void(0)" class="btn btn-main pad4" @click="btnIn_DSPH_Click" title="In danh sách">
                                <span class="lh14 one-print"></span>
                            </a>
                            <a href="javascript:void(0)" class="btn btn-main pad4" @click="btnLamMoi_DSPH_Click" title="Làm mới">
                                <span class="lh14 arrows-1_refresh-69 nc-icon-glyph"></span>
                            </a>
                            <a href="javascript:void(0)" class="btn btn-main pad4" title="Ẩn / Hiện lọc" @click="grvPhieu.allowFilter = !grvPhieu.allowFilter">
                                <span class="lh14 ui-2_filter nc-icon-outline"></span>
                            </a>
                            <a href="javascript:void(0)" class="btn btn-main pad4" title="Xuất Excel" @click="btnXuatExcel_DSPH_Click">
                                <span class="lh14 one-excel-outline"></span>
                            </a>
                        </div>
                        <div class="clearfix"></div>
                    </div>
                    <div class="table-content">
                        <DataGrid
                            ref="grid-suco"
                            class="table-result grid-suco"
                            v-bind:columns="[
                                {fieldName: '', headerText: 'Chọn', textAlign: 'Center', allowFiltering: false, width: '50', freeze: 'Left', template: getColumnTemplateChonSuCo(this)},
                                {fieldName: 'MA_SC', headerText: 'Mã sự cố', allowFiltering: true, width: '130', freeze: 'Left' },
                                {fieldName: 'MUCDO_SC', headerText: 'Mức độ', allowFiltering: true, width: '130', freeze: 'Left' },
                                {fieldName: 'NOIDUNG_SC_HIENTHI', headerText: 'Nội dung sự cố', allowFiltering: true, width: '200' },
                                {fieldName: 'NGAY_SC', headerText: 'Ngày sự cố', allowFiltering: true, textAlign: 'Right', width: '150' },
                                {fieldName: 'THOIGIAN', headerText: 'Kéo dài', allowFiltering: true, textAlign: 'Right', width: '130' },
                                {fieldName: 'TRANGTHAI_SC', headerText: 'Trạng thái', allowFiltering: true, width: '150' },
                                {fieldName: 'KEY', visible: false, isPrimaryKey: true },
                            ]"        
                            v-bind:dataSource="grvPhieu.DataSource"
                            :showFilter="grvPhieu.allowFilter"
                            :allowPaging="true"
                            :enablePagingServer="false"
                            @queryCellInfo="onQueryCellInfoSuCo"></DataGrid>
                    </div>
                </div>
            </div>
            <div class="col-sm-6 col-12">
                <div class="box-form">
                    <div class="legend-title">
                        <div class="pull-left">Thông tin phiếu giao</div>
                        <div class="pull-right">
                            <a href="javascript:void(0)" class="btn btn-main pad4" title="Làm mới">
                                <span class="lh14 arrows-1_refresh-69 nc-icon-glyph"></span>
                            </a>
                        </div>
                        <div class="clearfix"></div>
                    </div>
                    <div class="row">
                        <div class="col-sm-6 col-12">
                            <div class="info-row">
                                <div class="key w140">
                                    Bước xử lý
                                </div>
                                <div class="value">
                                    <SelectExt 	
                                        v-model="cboBuocXuLy.Value" 
                                        :dataSource="cboBuocXuLy.DataSource" 
                                        dataValueField="MA_BUOC"
                                        dataTextField="TEN_BUOC_XULY"/>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-6 col-12">
                            <div class="info-row">
                                <div class="key">
                                    Đơn vị xử lý
                                </div>
                                <div class="value combo-donvi">
                                    <combobox-grid
                                        ref="ref-ccb-don-vi-nhan"
                                        gridPanelDataHeight="300"
                                        :columns="[
                                            {fieldName: 'DONVI_ID', headerText: 'ID', isPrimaryKey: true, width: '60' },
                                            {fieldName: 'MA_DV', headerText: 'Mã đơn vị', allowFiltering: true, width: '100' },
                                            {fieldName: 'TEN_DV', headerText: 'Tên đơn vị', allowFiltering: true, width: '300' }    
                                        ]"
                                        :dataSource="ccbDonViNhan.DataSource"
                                        :enabledSelectFirstRow="false"
                                        valueField="DONVI_ID"
                                        textField="TEN_DV"
                                        @selectedChanged="onSelectDonViNhan"></combobox-grid>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-12 col-12">
                            <div class="info-row">
                                <div class="key w140">
                                    Hướng giao
                                </div>
                                <div class="value">
                                    <SelectExt 	
                                        v-model="cboHuongGiao.Value" 
                                        :dataSource="cboHuongGiao.DataSource" 
                                        dataValueField="HUONGGIAO_ID"
                                        dataTextField="HUONGGIAO"/>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-12 col-12">
                            <div class="info-row">
                                <div class="key w140">
                                    Chi tiết sự cố
                                </div>
                                <div class="value">
                                    <input type="text" class="form-control highlight" v-model="txtNoiDung.Text" />
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-8 col-12">
                            <div class="info-row">
                                <div class="key w140">
                                    Thiết bị
                                </div>
                                <div class="value">
                                    <div class="input-more-button" style="padding-right: 40px; padding-left: 0;">
                                        <input type="text" class="form-control highlight" v-model="txtThongTinThietBi.Text" />
                                        <button class="btn" style="right: 0; left: unset;" title="Xem thông số kỹ thuật" @click="btnXemTTHT_Click">
                                            <span class="-ap icon-info f20"></span>
                                        </button>
                                        <xem-thong-tin modal-id="frm-giao-phieu-net-modal-id-xem-thong-tin-tbi" ref="ref-modal-xem-thongtin"></xem-thong-tin>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-4 col-12">
                            <div class="info-row">
                                <div class="key">
                                    Mức độ sự cố
                                </div>
                                <div class="value">
                                    <SelectExt 	
                                        v-model="cboMucDoKC.Value" 
                                        :dataSource="cboMucDoKC.DataSource"
                                        dataTextField="MUCDO_KC"
                                        dataValueField="MUCDO_ID"/>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-12 col-12">
                            <div class="info-row">
                                <div class="key w140">
                                    Nội dung giao phiếu
                                </div>
                                <div class="value">
                                    <input ref="ref-txt-noi-dung-trao-doi" type="text" class="form-control highlight" v-model="txtNoiDungTraoDoi.Text" />
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="legend-title" style="margin-top: 15px;">
                        <div class="pull-left">Danh sách các phiếu đã giao</div>
                        <div class="clearfix"></div>
                    </div>
                    <div class="table-content">
                        <DataGrid
                            class="table-result grid-phieu"
                            v-bind:columns="[
                                {fieldName: '', headerText: 'Chọn', textAlign: 'Center', allowFiltering: false, width: '50', freeze: 'Left', template: getColumnTemplateChonPhieuGiao(this)},
                                {fieldName: 'TEN_BUOC_XULY', headerText: 'Bước xử lý', allowFiltering: true, width: '130' },
                                {fieldName: 'DONVI_GIAO', headerText: 'Đơn vị giao', allowFiltering: true, width: '130' },
                                {fieldName: 'DONVI_XULY', headerText: 'Đơn vị xử lý', allowFiltering: true, width: '130' },
                                {fieldName: 'THONGTIN_CHITIET', headerText: 'Nội dung trao đổi', allowFiltering: true, width: '200' },
                                {fieldName: 'TRANGTHAI_XULY', headerText: 'Trạng thái', allowFiltering: true, width: '130' },
                                {fieldName: 'NGAY_GIAO_HIENTHI', headerText: 'Ngày giao', textAlign: 'Right', allowFiltering: true, width: '130' },
                                {fieldName: 'NHANVIEN_GIAO', headerText: 'Người giao', allowFiltering: true, width: '130' },
                                {fieldName: 'GHICHU_TH', headerText: 'Ghi chú thực hiện', allowFiltering: true, width: '200' },
                                {fieldName: '', headerText: 'Chức năng', textAlign: 'Center', allowFiltering: false, width: '130', freeze: 'Right', template: getColumnTemplateChucNangGiaoViec(this) },
                                {fieldName: 'KEY', visible: false, isPrimaryKey: true },
                            ]"        
                            v-bind:dataSource="gridPhieuDaGiao.DataSource"
                            :allowPaging="true"
                            :enablePagingServer="false"></DataGrid>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <ModalGiaoPhieuNv ref="ref-modal-giaophieu-nv"></ModalGiaoPhieuNv>
    <ModalInSuCo modal-id="frm-giao-phieu-net-modal-in-suco" ref="ref-modal-in-suco"></ModalInSuCo>
    <ModalKhoaPhieu ref="ref-modal-khoaphieu" modal-id="modal-khoaphieu" @success="onSuccessKhoaPhieu"></ModalKhoaPhieu>
</div>