<div>
  <div class="list-actions-top">
    <ul class="list">
      <li>
        <button class="btn" @click="btnLayTT_Click" title="Lấy thông tin mới">
          <span class="icon one-file-attach"></span>Lấy TT
        </button>
      </li>
      <li v-if="enableBtnGhiLai">
        <button class="btn" @click="btnGhiLai_Click" title="Ghi lại">
          <span class="icon  one-save"></span> Ghi lại
        </button>
      </li>
      <li>
        <button class="btn" :disabled="!enableBtnGiaoViec" @click="btnGiaoNV_Click" title="Giao việc cho nhân viên">
          <span class="icon  one-flag"></span> Giao NV
        </button>
      </li>
      <li>
        <button class="btn" :disabled="!enableBtnHuyGiao" @click="btnHuyGiaoNV_Click" title="Hủy giao NV">
          <span class="icon  nc-icon-glyph ui-1_circle-remove"></span>Huỷ giao NV
        </button>
      </li>
      <li v-if="enableBtnHoanThanh">
        <button class="btn" @click="btnHoanThanh_Click_1"
          title="Nút này chỉ thực hiện hoàn thiện, trả lời phiếu được giao">
          <span class="icon one-file-check"></span> Hoàn thành
        </button>
      </li>
      <li v-if="enableBtnHoanThanh_GQKN">
        <button class="btn" @click="btnHoanThanh_Click"
          title="Hoàn thành, phiếu sẽ được chuyển cho bộ phận nghiệm thu khiếu nại">
          <span class="icon one-file-check"></span> Hoàn thành
        </button>
      </li>
      <li>
        <button class="btn" @click="btnGiaoPhieu_Click" :disabled="!enableBtnGiaoPhieu" title="Giao phiếu">
          <span class="icon one-file-arrow-right1"></span>Giao phiếu
        </button>
      </li>
      <li v-if="enableBtnGiaoPhoiHop">
        <button class="btn" @click="btnGiaoPH_Click" title="Giao phiếu cho các đơn vị cần phối hợp">
          <span class="icon one-file-edit"></span> Giao P/h
        </button>
      </li>
      <li v-if="enableBtnKhoaPhieu">
        <button class="btn" @click="btnKhoaPhieu_Click" title="Khóa phiếu">
          <span class="icon one-file-lock"></span> Khoá phiếu
        </button>
      </li>
      <li v-if="enableBtnTraPhieu">
        <button class="btn" @click="btnTraPhieu_Click" title="Trả phiếu">
          <span class="icon  one-file-back"></span> Trả phiếu
        </button>
      </li>
      <li>
        <button class="btn" @click="btnHoSo_Click" title="Hồ sơ khiếu nại">
          <span class="icon nc-icon-glyph files_single-content-02"></span> Hồ sơ
        </button>
      </li>
    </ul>
  </div>
  <div class="page-content">
    <div class="box-form" style="display: none;"><span class="fw6 text-uppercase" v-html="titleText"></span></div>
    <div class="row">
      <div class="col-sm-6 col-12">
        <div class="box-form">
          <div class="legend-title">
            <span :class="showTabs.TB ? 'icon fa fa-angle-up' : 'icon fa fa-angle-down'"
              @click="showTabs.TB = !showTabs.TB"></span>Thông tin thuê bao
          </div>
          <div v-show="showTabs.TB">
            <div class="title-bg-main">
              <span class="title">Thông tin thuê bao</span>
            </div>
            <div class="row">
              <div class="col-sm-7 col-12">
                <div class="info-row">
                  <div class="key w90">Quy trình</div>
                  <div class="value">
                    <SelectExt v-model="currentItem.selectedKhieuNai.QUYTRINH_ID" :dataSource="dsQuyTrinh"
                      dataTextField="QUYTRINH" dataValueField="QUYTRINH_ID" disabled="disabled" />
                  </div>
                </div>
              </div>
              <div class="col-sm-5 col-12">
                <div class="info-row">
                  <div class="key w100">Mã khiếu nại</div>
                  <div class="value">
                    <input type="text" class="form-control" readonly="readonly"
                      :value="currentItem.selectedKhieuNai.MA_KN">
                  </div>
                </div>
              </div>
            </div>
            <div class="row">
              <div class="col-sm-7 col-12">
                <div class="info-row">
                  <div class="key w90">Dịch vụ</div>
                  <div class="value">
                    <SelectExt ref="comboboxDichVu" disabled="disabled"
                      v-model="currentItem.selectedKhieuNai.DICHVUVT_ID" :dataSource="dsDichVu" dataTextField="ten_dvvt"
                      dataValueField="dichvuvt_id" @change="comboboxDichVu_Change" />
                  </div>
                </div>
              </div>
              <div class="col-sm-5 col-12">
                <div class="info-row">
                  <div class="key w100">Loại hình</div>
                  <div class="value">
                    <SelectExt v-model="currentItem.selectedKhieuNai.LOAITB_ID" disabled="disabled"
                      :dataSource="dsLoaiHinhTB" dataTextField="LOAIHINH_TB" dataValueField="LOAITB_ID" />
                  </div>
                </div>
              </div>
            </div>
            <div class="row">
              <div class="col-sm-7 col-12">
                <div class="info-row">
                  <div class="key w90">Số máy/ Acc</div>
                  <div class="value">
                    <input type="text" class="form-control" readonly="readonly"
                      :value="currentItem.selectedKhieuNai.MA_TB">
                  </div>
                </div>
              </div>
              <div class="col-sm-5 col-12">
                <div class="info-row">
                  <div class="key w100">Ngày tiếp nhận</div>
                  <div class="value">
                    <ejs-datepicker :enabled="false" format="dd/MM/yyyy HH:mm:ss"
                      :value="currentItem.selectedKhieuNai.NGAY_TN_DATE"></ejs-datepicker>
                  </div>
                </div>
              </div>
            </div>
            <div class="row">
              <div class="col-sm-7 col-12">
                <div class="info-row">
                  <div class="key w90">Tên TB</div>
                  <div class="value">
                    <input type="text" class="form-control" readonly="readonly"
                      :value="currentItem.selectedKhieuNai.TEN_TB">
                  </div>
                </div>
              </div>
              <div class="col-sm-5 col-12">
                <div class="info-row">
                  <div class="key w100">Mã khách hàng</div>
                  <div class="value">
                    <input type="text" class="form-control" readonly="readonly"
                      :value="currentItem.selectedKhieuNai.MA_KH">
                  </div>
                </div>
              </div>
            </div>
            <div class="row">
              <div class="col-sm-7 col-12">
                <div class="info-row">
                  <div class="key w90">Tuyến thu</div>
                  <div class="value">
                    <input type="text" class="form-control" readonly="readonly"
                      :value="currentItem.selectedKhieuNai.TUYEN_THU">
                  </div>
                </div>
              </div>
              <div class="col-sm-5 col-12">
                <div class="info-row">
                  <div class="key w100">Mã thanh toán</div>
                  <div class="value">
                    <input type="text" class="form-control" readonly="readonly"
                      :value="currentItem.selectedKhieuNai.MA_TT">
                  </div>
                </div>
              </div>
            </div>
            <div class="info-row">
              <div class="key w90">Địa chỉ TB</div>
              <div class="value">
                <input type="text" class="form-control" readonly="readonly"
                  :value="currentItem.selectedKhieuNai.DIACHI_TB">
              </div>
            </div>
            <div class="row">
              <div class="col-sm-7 col-12">
                <div class="info-row">
                  <div class="key w90">Người KN</div>
                  <div class="value">
                    <input type="text" class="form-control" readonly="readonly"
                      :value="currentItem.selectedKhieuNai.NGUOI_KN">
                  </div>
                </div>
              </div>
              <div class="col-sm-5 col-12">
                <div class="info-row">
                  <div class="key w100">Điện thoại LH</div>
                  <div class="value">
                    <input type="text" class="form-control" readonly="readonly"
                      :value="currentItem.selectedKhieuNai.DIENTHOAI_LH">
                  </div>
                </div>
              </div>
            </div>
            <div class="row">
              <div class="col-sm-7 col-12">
                <div class="info-row">
                  <div class="key w90">Hẹn TL từ</div>
                  <div class="value">
                    <ejs-datepicker :enabled="false" format="dd/MM/yyyy HH:mm:ss"
                      :value="currentItem.selectedKhieuNai.HENGQ_TU_DATE"></ejs-datepicker>
                  </div>
                </div>
              </div>
              <div class="col-sm-5 col-12">
                <div class="info-row">
                  <div class="key w100">Hẹn TL đến</div>
                  <div class="value">
                    <ejs-datepicker :enabled="false" format="dd/MM/yyyy HH:mm:ss"
                      :value="currentItem.selectedKhieuNai.HENGQ_DEN_DATE"></ejs-datepicker>
                  </div>
                </div>
              </div>
            </div>
            <div class="title-bg-main mart20">
              <span class="title">Danh sách khiếu nại</span>
            </div>
            <div class="tab-content box-form">
              <DataGrid :dataSource="dsThueBaoKhieuNai" :columns="[
              {fieldName: 'MA_KN', headerText: 'Mã khiếu nại'},
              {fieldName: 'TEN_LOAI', headerText: 'Loại chủ đề'},
              {fieldName: 'MA_TB', headerText: 'Số máy/Acc'},
              {fieldName: 'NGUOI_KN', headerText: 'Người khiếu nại'},
              {fieldName: 'DIENTHOAI_LH', headerText: 'Điện thoại LH', width: '140px', textAlign: 'right'},
              {fieldName: 'TEN_NV', headerText: 'Người tiếp nhận'},
              {fieldName: 'NGAYGIAO', headerText: 'Ngày giao', type:'date', format: {type:'date', format:'dd/MM/yyyy'}, width: '120px', textAlign: 'right'}
            ]" ref="gridDsThueBaoKhieuNai" @rowSelected="gridDsThueBaoKhieuNai_rowSelected"
                panelDataHeight="346px" :enabledSelectFirstRow="true" />
            </div>
          </div>
        </div>
      </div>
      <div class="col-sm-6 col-12">
        <div class="box-form">
          <div class="legend-title">
            <span :class="showTabs.KN ? 'icon fa fa-angle-up' : 'icon fa fa-angle-down'"
              @click="showTabs.KN = !showTabs.KN"></span>Thông tin khiếu nại
          </div>
          <div v-show="showTabs.KN">
            <div class="title-bg-main">
              <span class="title">Thông tin khiếu nại</span>
            </div>
            <div class="row">
              <div class="col-sm-7 col-12">
                <div class="info-row">
                  <div class="key w90">Chủ đề KN</div>
                  <div class="value">
                    <SelectExt v-model="currentItem.selectedKhieuNai.CHUDEKN_ID" :dataSource="dsChuDe"
                      dataTextField="TENCHUDE" dataValueField="CHUDEKN_ID" disabled="disabled" />
                  </div>
                </div>
              </div>
              <div class="col-sm-5 col-12">
                <div class="info-row">
                  <div class="key w90">Mã công văn</div>
                  <div class="value">
                    <input type="text" class="form-control" :value="currentItem.selectedKhieuNai.CONGVAN_XL">
                  </div>
                </div>
              </div>
            </div>
            <div class="info-row">
              <div class="key w90">Nội dung KN</div>
              <div class="value">
                <textarea name="" class="form-control" readonly="readonly" style="height: 66px;resize: none;" id=""
                  cols="30" rows="10" :value="currentItem.selectedKhieuNai.ND_KHIEUNAI"></textarea>
              </div>
            </div>
            <div class="info-row">
              <div class="key w90">Ghi chú</div>
              <div class="value">
                <textarea name="" class="form-control" readonly="readonly" style="height: 66px;resize: none;" id=""
                  cols="30" rows="10" :value="currentItem.selectedKhieuNai.GHICHU_KN"></textarea>
              </div>
            </div>
            <div class="info-row">
              <div class="key w90">Đơn vị trả</div>
              <div class="value select-custom">
                <select class="form-control" disabled="disabled">
                  <option :value="currentItem.selectedKhieuNai.DONVITRA_CON_ID">
                    {{currentItem.selectedKhieuNai.DONVITRA_CON_TEXT}}</option>
                </select>
                <!-- <input type="text" class="form-control" readonly="readonly" :value="currentItem.selectedKhieuNai.DONVITRA_CON_ID"> -->
              </div>
            </div>
            <div class="info-row">
              <div class="key w90">Nội dung trả</div>
              <div class="value">
                <input type="text" class="form-control" readonly="readonly"
                  :value="currentItem.selectedKhieuNai.ND_TRA_CON">
              </div>
            </div>
            <div class="info-row">
              <div class="key w90">Đơn vị giao</div>
              <div class="value select-custom">
                <select class="form-control" disabled="disabled">
                  <option :value="currentItem.selectedKhieuNai.DONVI_GIAO_ID">
                    {{currentItem.selectedKhieuNai.DONVI_GIAO_TEXT}}</option>
                </select>
                <!-- <input type="text" class="form-control" readonly="readonly" :value="currentItem.selectedKhieuNai.DONVI_GIAO_ID"> -->
              </div>
            </div>
            <div class="info-row">
              <div class="key w90">ND giao</div>
              <div class="value">
                <textarea name="" class="form-control" readonly="readonly" style="height: 66px;resize: none;" id=""
                  cols="30" rows="10" :value="currentItem.selectedKhieuNai.ND_GIAO"></textarea>
              </div>
            </div>
            <div class="info-row">
              <div class="key w90">ND Xác minh</div>
              <div class="value">
                <textarea name="" class="form-control" style="height: 66px;resize: none;" id="" cols="30" rows="10"
                  v-model="currentItem.selectedKhieuNai.ND_XACMINH"></textarea>
              </div>
            </div>
            <div class="title-bg-main mart20">
              <span class="title">Kết quả xử lý</span>
            </div>
            <div class="row">
              <div class="col-sm-6 col-12">
                <div class="info-row">
                  <div class="key">Kết quả XL</div>
                  <div class="value">
                    <div class="select-custom">
                      <select class="form-control" v-model="currentItem.ketQuaXuLy">
                        <option value="1">Xử lý được</option>
                        <option value="2">Không xử lý được</option>
                      </select>
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-sm-6 col-12">
                <div class="info-row">
                  <div class="key">Ngày XL</div>
                  <div class="value">
                    <ejs-datetimepicker format="dd/MM/yyyy HH:mm:ss"
                      v-model="currentItem.selectedKhieuNai.NGAY_GQ_DATE">
                    </ejs-datetimepicker>
                  </div>
                </div>
              </div>
            </div>
            <div class="info-row">
              <div class="key">Người XL</div>
              <div class="value">
                <ComboboxGrid :dataSource="dsNhanVienThucHien" :allowPaging="true"
                  v-model="currentItem.selectedKhieuNai.NHANVIEN_GQ_ID" textField="TEN_NV" valueField="NHANVIEN_ID"
                  :enabledSelectFirstRow="false" :columns="[
              {fieldName: 'MA_NV', headerText: 'Mã nhân viên'},
              {fieldName: 'TEN_NV', headerText: 'Tên nhân viên'},
              {fieldName: 'TEN_DV', headerText: 'Đơn vị'},
            ]" @selectedChanged="comboboxNhanVienThucHien_selectedChanged" />
              </div>
            </div>
            <div class="info-row">
              <div class="key">Phương án XL</div>
              <div class="value">
                <SelectExt :dataSource="dsPhuongAnXuLy" v-model="currentItem.selectedKhieuNai.PAXL_ID"
                  dataTextField="PHUONGAN_XLKN" dataValueField="PAXL_ID" />
              </div>
            </div>
            <div class="info-row">
              <div class="key">Kết quả lỗi</div>
              <div class="value">
                <div class="input-more-button">
                  <button class="btn" :disabled="!enableBtnKetQuaKNMore" @click="btnKetQuaLoi_Click"><span
                      class="-ap icon-more_horiz"></span></button>
                  <!-- <SelectExt :dataSource="dsKetQuaKN" v-model="currentItem.selectedKhieuNai.KETQUAKN_ID"
                      dataTextField="NOIDUNG" dataValueField="KETQUAKN_ID" /> -->
                  <SelectExt :dataSource="dsKetQuaKN" v-model="currentItem.selectedKhieuNai.KETQUAKN_ID"
                    dataTextField="NGUYENNHAN" dataValueField="NGUYENNHAN_ID" />
                </div>
              </div>
            </div>
            <div class="row">
              <div class="col-sm-5 col-12">
                <div class="info-row">
                  <div class="key">Hình thức trả lời</div>
                  <div class="value">
                    <SelectExt :dataSource="dsHinhThucTL" dataTextField="HINHTHUC_TL" dataValueField="HTTL_ID"
                      v-model="currentItem.selectedKhieuNai.HTTL_ID" />
                  </div>
                </div>
              </div>
              <div class="col-sm-7 col-12">
                <div class="info-row">
                  <div class="key">Mức độ hài lòng</div>
                  <div class="value">
                    <div class="list-checks mart7">
                      <div class="item">
                        <div class="check-action">
                          <input type="radio" class="check" name="mucdohailong" value="1"
                            v-model="currentItem.selectedKhieuNai.HAILONG">
                          <span class="name">Hài lòng</span>
                        </div>
                      </div>
                      <div class="item">
                        <div class="check-action">
                          <input type="radio" class="check" name="mucdohailong" value="0"
                            v-model="currentItem.selectedKhieuNai.HAILONG">
                          <span class="name">Không hài lòng</span>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="info-row">
              <div class="key">Nguyên nhân</div>
              <div class="value">
                <textarea name="" :disabled="!enableTxtNguyenNhan" class="form-control highlight"
                  style="height: 67px;resize: none;" id="" cols="30" rows="10"
                  v-model="currentItem.selectedKhieuNai.NGUYENNHAN_KN"></textarea>
              </div>
            </div>
            <div class="info-row">
              <div class="key"><span v-html="labelNoiDungTraLoiText"></span></div>
              <div class="value">
                <textarea name="" :disabled="!enableTxtNoiDungXL" class="form-control highlight"
                  style="height: 67px;resize: none;" id="" cols="30" rows="10"
                  v-model="currentItem.selectedKhieuNai.NOIDUNG_GQ"></textarea>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <tra-phieu ref="ref-modal-tra-phieu" @change="btnLayTT_Click"></tra-phieu>
  <b-modal id="modalGiaoPhieuXacMinhPhoiHop" ref="modalGiaoPhieuXacMinhPhoiHop"
    title="Giao phiếu xác minh, phối hợp công việc giữa các đơn vị" centered hide-footer size="xl"
    modal-class="bss-modal" @ok="" @shown="modalGiaoPhieuXacMinhPhoiHop_Shown"
    @hidden="modalGiaoPhieuXacMinhPhoiHop_Hidden">
    <template #default="{ ok }">
      <GiaoPhieuXacMinhPhoiHop ref="formGiaoPhieuXacMinhPhoiHop"></GiaoPhieuXacMinhPhoiHop>
    </template>
  </b-modal>
  <ModalNhanVienLoi modalID="modalNhanVienLoi" ref="modalNhanVienLoi" />
  <ModalDonViLoi modalID="modalDonViLoi" ref="modalDonViLoi" />
  <b-modal id="modalGiaoPhieuKhieuNai" ref="modalGiaoPhieuKhieuNai" title="Giao phiếu xử lý khiếu nại" centered
    hide-footer size="xl" modal-class="bss-modal" @ok="" @shown="modalGiaoPhieuKhieuNai_Shown"
    @hidden="modalGiaoPhieuKhieuNai_Hidden">
    <template #default="{ ok }">
      <GiaoPhieuKhieuNai ref="formGiaoPhieuKhieuNai"></GiaoPhieuKhieuNai>
    </template>
  </b-modal>
  <frmHoSoKhieuNai ref="frmHoSoKhieuNai" />
</div>