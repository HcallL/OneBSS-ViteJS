<div class="frm-thaydoi-datcoc-huy">
    <div class="list-actions-top">
        <ul class="list">
            <li :class="{'disable-btn': !tsbtnNhapMoi.Enabled}" @click="tsbtnNhapMoi_Click">
                <a href="javascript:void(0)">
                    <span class="icon one-file-plus"></span>Nhập mới
                </a>
            </li>
            <li :class="{'disable-btn': !tsbtnGhiLai.Enabled}" @click="tsbtnGhiLai_Click">
                <a href="javascript:void(0)">
                    <span class="icon one-save"></span>Ghi lại
                </a>
            </li>
            <li :class="{'disable-btn': !tsbtnHuyBo.Enabled}" @click="tsbtnHuyBo_Click">
                <a href="javascript:void(0)">
                    <span class="icon nc-icon-glyph ui-1_circle-remove"></span>Hủy
                </a>
            </li>
            <li :class="{'disable-btn': !tsbtnXoa.Enabled}" @click="tsbtnXoa_Click">
                <a href="javascript:void(0)">
                    <span class="icon one-trash"></span>Xóa
                </a>
            </li>
            <li :class="{'disable-btn': !tsbtnThanhToan.Enabled}" @click="tsbtnThanhToan_Click">
                <a href="javascript:void(0)">
                    <span class="icon nc-icon-glyph shopping_credit-card"></span>Thanh toán
                </a>
            </li>
            <li :class="{'disable-btn': !tsbtnCapNhatDB.Enabled}" @click="tsbtnCapNhatDB_Click">
                <a href="javascript:void(0)">
                    <span class="icon one-file-check"></span>Hoàn thiện
                </a>
            </li>
            <li>
                <a href="javascript:void(0)" @click="tsbtnEmail_Click">
                    <span class="icon one-email"></span>Email
                </a>
            </li>
            <li>
                <a href="javascript:void(0)" @click="tsbtnThongTinLH_Click">
                    <span class="icon nc-icon-glyph business_contacts"></span>Liên hệ
                </a>
            </li>
        </ul>
    </div>
    <div class="page-content">
        <div class="box-form">
            <div class="row">
                <div class="col-sm-8 col-12">

                </div>
                <div class="col-sm-2 col-12">
                    <div class="info-row marb0">
                        <div class="key w20 nowrap fw6">
                            <div class="check-action">
                                <input type="checkbox" class="check" v-model="chkCTV" @change="onChangeCheckCtv($event)">
                                <span class="name">Cộng tác viên</span>
                            </div>
                        </div>
                        <div class="value">
                            <input type="text" class="form-control" v-model="txtCTV" readonly>
                        </div>
                    </div>
                </div>
                <div class="col-sm-2 col-12">
                    
                    <div class="info-row marb0">
                        <div class="info-row">
                            <div class="key w20 nowrap fw6">
                                <div class="check-action">
                                    <input type="checkbox" class="check" v-model="chkNguoiGT.Checked">
                                    <span class="name">Người giới thiệu</span>
                                </div>
                            </div>
                            <div class="value">
                                <bss-error-marker :has-error="txtNguoiGT.hasError">
                                    <input type="text" ref="txtNguoiGT" class="form-control" v-model="txtNguoiGT.Text">
                                </bss-error-marker>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="grid-stack-box">
            <Split :gutterSize="2">
                <SplitArea :size="50" style="padding-left: 0 !important;">
                    <div class="box-col box-form" id="boxLeft" style="height: 98%;">
                        <div class="legend-title">Thông tin thuê bao</div>
                        <div class="row">
                            <div class="col-sm-7 col-12">
                                <div class="info-row">
                                    <div class="key">Mã giao dịch</div>
                                    <div class="value">
                                        <div class="input-more-button">
                                            <button class="btn" @click="btnLayMaGD_Click">
                                                <span class="-ap icon-more_horiz"></span>
                                            </button>
                                            <input type="text" ref="txtMaGD" class="form-control highlight" v-model.trim="txtMaGD.Text" v-on:keyup.enter="txtMaGD_KeyPress">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-sm-5 col-12">
                                <div class="info-row">
                                    <div class="key">Ngày yêu cầu</div>
                                    <div class="value">
                                        <ejs-datepicker 	
                                            class="form-control bg-none bor0 fw6 text h24 tright"
                                            :style="{'padding-top': '7px'}"
                                            placeholder=""
                                            format="dd/MM/yyyy"
                                            :enabled="false"
                                            v-model="dtpNgayYeuCau.Value"
                                            :showClearButton="false"></ejs-datepicker>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-sm-7 col-12">
                                <div class="info-row">
                                    <div class="key">Dịch vụ</div>
                                    <div class="value">
                                        <SelectExt
                                            v-model="cboDichVuVT.Value" 
                                            :dataSource="cboDichVuVT.DataSource" 
                                            dataValueField="DICHVUVT_ID"
                                            dataTextField="TEN_DVVT" />
                                    </div>
                                </div>
                            </div>
                            <div class="col-sm-5 col-12">
                                <div class="info-row">
                                    <div class="key">Loại hình</div>
                                    <div class="value">
                                        <SelectExt
                                            v-model="cboLoaiHinhTB.Value" 
                                            :dataSource="cboLoaiHinhTB.DataSource" 
                                            dataValueField="LOAITB_ID"
                                            dataTextField="LOAIHINH_TB" />
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-sm-7 col-12">
                                <div class="info-row">
                                    <div class="key">Số máy/Acc <bss-required-marker /></div>
                                    <div class="value">
                                        <div class="input-more-button">
                                            <button class="btn" @click="bntLayMaKh_Click">
                                                <span class="-ap icon-more_horiz"></span>
                                            </button>
                                            <bss-error-marker :has-error="txtMaTB.hasError">
                                                <input ref="txtMaTB" type="text" class="form-control highlight" v-model="txtMaTB.Text" v-on:keyup.enter="txtMaTB_KeyPress">
                                            </bss-error-marker>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-sm-5 col-12">
                                <div class="info-row">
                                    <div class="key">Mã khách hàng</div>
                                    <div class="value">
                                        <input type="text" class="form-control" v-model="ma_kh" >
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-sm-7 col-12">
                                <div class="info-row">
                                    <div class="key">Gói đa dịch vụ</div>
                                    <div class="value">
                                        <input type="text" class="form-control"  v-model="ten_goi_ddv" >
                                    </div>
                                </div>
                            </div>
                            <div class="col-sm-5 col-12">
                                <div class="info-row">
                                    <div class="key">Tốc độ</div>
                                    <div class="value">
                                        <input type="text" class="form-control" v-model="ten_tocdo">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="info-row">
                            <div class="key">Tên khách hàng</div>
                            <div class="value">
                                <input type="text" class="form-control" readonly :value="txtTenKH.Text">
                            </div>
                        </div>
                        <div class="info-row">
                            <div class="key">Địa chỉ KH</div>
                            <div class="value">
                                <input type="text" class="form-control" readonly :value="txtDiaChiKH.Text">
                            </div>
                        </div>
                    </div>
                </SplitArea>
                <SplitArea :size="50" style="padding-right: 0 !important;">
                    <div class="box-col" id="boxRight" style="height: 98%;">
                        <div class="box-form" style="min-height: 220px;">
                            <div class="legend-title red">Thông tin yêu cầu</div>
                            <div class="info-row">
                                <div class="key w110">Kiểu yêu cầu</div>
                                <div class="value">
                                    <SelectExt
                                            v-model="cboKieuLD.Value" 
                                            :dataSource="cboKieuLD.DataSource" 
                                            dataValueField="kieuld_id"
                                            dataTextField="ten_kieuld" />
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-sm-4 col-12">
                                    <div class="info-row">
                                        <div class="key">Tháng thoái trả</div>
                                        <div class="value">
                                            <ejs-datepicker 	
                                                class="form-control bg-none bor0 fw6 text h24 tright"
                                                :style="{'padding-top': '7px'}"
                                                placeholder=""
                                                format="MM/yyyy"
                                                start='Year' depth='Year'
                                                :showClearButton="false"
                                                v-model="dtpThangThoaiTra.Value" :enabled="(IS_DICHVU_CNTT || TINHCUOC_NGAY == 0)"></ejs-datepicker>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-sm-4 col-12">
                                    <div class="info-row">
                                        <div class="key">Ngày thoái <bss-required-marker /></div>
                                        <div class="value">
                                            <bss-error-marker :has-error="dtpNgayThoai.hasError">
                                                <ejs-datepicker 	
                                                    class="form-control bg-none bor0 fw6 text h24 tright"
                                                    :style="{'padding-top': '7px'}"
                                                    placeholder=""
                                                    format="dd/MM/yyyy"
                                                    :showClearButton="false"
                                                    v-model="dtpNgayThoai.Value" :enabled="!(IS_DICHVU_CNTT || TINHCUOC_NGAY == 0)"></ejs-datepicker>
                                            </bss-error-marker>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-sm-4 col-12">
                                    <div class="info-row">
                                        <div class="key">Tiền thoái trả <bss-required-marker /></div>
                                        <div class="value"> 
                                            <vue-numeric 
                                                ref="txtTienThoaiTra" 
                                                separator=',' 
                                                :precision="3" 
                                                decimal-separator="." 
                                                v-model="txtTienThoaiTra.Text" 
                                                class="form-control tright"
                                                style="color: red; font-weight: bold;" :read-only="true" read-only-class="dis-thoaitra"></vue-numeric>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="info-row">
                                <div class="key">Ghi chú</div>
                                <div class="value">
                                    <textarea class="form-control" style="height: 140px;resize: none;" v-model="txtGhiChu.Text"></textarea>
                                </div>
                            </div>
                        </div>
                    </div>
                </SplitArea>
            </Split>
        </div>
        <div class="box-form">
            <div class="legend-title">Danh sách đặt cọc/ trả trước thuê bao tham gia</div>
            <div class="table-content">
                <DataGrid
                    ref="dgvDatCoc"
                    class="table-result"
                    :panelDataHeight="dgvDatCoc.DataSource.length == 0 ? '290' : '236'"
                    v-bind:columns="[
                    {fieldName: 'HDTB_ID', headerText: '', visible: false },
                    {fieldName: 'TTHD_ID', headerText: '', visible: false },
                    {fieldName: 'THUEBAO_ID', headerText: '', visible: false },
                    {fieldName: 'THUEBAO_THOAITRA_ID', headerText: '', visible: false },
                    {fieldName: 'THUEBAO_DC_ID', headerText: '', visible: false },
                    {fieldName: 'CT_TIENHD_ID', headerText: '', visible: false },
                    {fieldName: 'TIENTHOAI', headerText: '', visible: false },
                    {fieldName: 'THANG_THOAITRA', headerText: '', visible: false },
                    {fieldName: 'NGAY_THOAI', headerText: '', visible: false },                                                            
                    {fieldName: 'MA_TB', headerText: 'Số máy/Acc', allowFiltering: true, width: '130' },
                    {fieldName: 'TEN_TB', headerText: 'Tên thuê bao', allowFiltering: true, width: '130' },
                    {fieldName: 'LOAIHINH_TB', headerText: 'Loại hình', allowFiltering: true, width: '130' },
                    {fieldName: 'LOAITB_ID', headerText: '', visible: false },
                    {fieldName: 'DIACHI_LD', headerText: '', visible: false },
                    {fieldName: 'TEN_KH', headerText: '', visible: false },
                    {fieldName: 'DICHVUVT_ID', headerText: '', visible: false },
                    {fieldName: 'DOITUONG_ID', headerText: '', visible: false },
                    {fieldName: 'RKM_ID', headerText: '', visible: false },
                    {fieldName: 'TEN_TOCDO', headerText: 'Tốc độ', allowFiltering: true, width: '200'},
                    {fieldName: 'TOCDO_ID', headerText: '', visible: false },
                    {fieldName: 'MUCCUOC_ID', headerText: '', visible: false },                    
                    {fieldName: 'TEN_GOI_DDV', headerText: 'Gói đa DV', allowFiltering: true, width: '200'},
                    {fieldName: 'SOTHANG', headerText: 'Số tháng', allowFiltering: true, width: '130'},
                    {fieldName: 'NGAY_BD_DC', headerText: 'Ngày BĐĐC', allowFiltering: true, width: '130'},
                    {fieldName: 'NGAY_KT_DC', headerText: 'Ngày KTĐC', allowFiltering: true, width: '130'},
                    {fieldName: 'THANG_BD', headerText: 'Tháng BĐĐC', allowFiltering: true, width: '130'},
                    {fieldName: 'THANG_KT', headerText: 'Tháng KTĐC', allowFiltering: true, width: '130'},
                    {fieldName: 'CUOC_DC', headerText: 'Cước ĐC', textAlign: 'Right', allowFiltering: true, width: '130', format: 'N0', type: 'number'},
                    {fieldName: 'TIEN_TD', headerText: 'Tiền/tháng', textAlign: 'Right', allowFiltering: true, width: '130', format: 'N0', type: 'number'},
                    {fieldName: 'NGUOI_CN', headerText: 'Người CN', allowFiltering: true, width: '130' },
                    {fieldName: 'TEN', headerText: 'Tên KM/Công văn', allowFiltering: true, width: '130' },
                    {fieldName: 'TEN_NHOM', headerText: 'Nhóm đặt cọc', allowFiltering: true, width: '130' },
                    {fieldName: 'TIEN_THOAI_HT', headerText: 'Tiền thoái', textAlign: 'Right', allowFiltering: true, width: '130', format: 'N0', type: 'number'},
                    {fieldName: 'GHICHU', headerText: '', visible: false },
                    {fieldName: 'TYLE_TB', headerText: '', visible: false },
                    {fieldName: 'TYLE_SD', headerText: '', visible: false },
                    {fieldName: 'TIEN_TB', headerText: '', visible: false },
                    {fieldName: 'TIEN_SD', headerText: '', visible: false },
                    {fieldName: 'NHOM_DATCOC_ID', headerText: '', visible: false },
                    {fieldName: 'KHUYENMAI_ID', headerText: '', visible: false },
                    {fieldName: 'CHITIETKM_ID', headerText: '', visible: false },
                    {fieldName: 'NHOMTB_ID', headerText: '', visible: false }
                    ]"        
                    v-bind:dataSource="dgvDatCoc.DataSource"
                    :showFilter="true"
                    :allowPaging="true"
                    :enablePagingServer="false"
                    :enabledSelectFirstRow="true"
                    @dataBound="dgvDatCoc_DataBound"
                    @selectedRowChanged="dgvDatCoc_SelectionChanged"
                    >
                </DataGrid>
            </div>
        </div>
        <div class="box-form">
            <div class="legend-title">Danh sách các thuê bao đăng ký huỷ đặt cọc</div>
            <div class="table-content">
                <DataGrid
                    class="table-result"
                    v-bind:columns="[
                        {fieldName: 'MA_TB', headerText: 'Số máy/Acc', allowFiltering: true, width: '130' },
                        {fieldName: 'TEN_TB', headerText: 'Tên thuê bao', allowFiltering: true, width: '130' },
                        {fieldName: 'DIACHI_TB', headerText: 'Địa chỉ thuê bao', allowFiltering: true, width: '200' },
                        {fieldName: 'LOAIHINH_TB', headerText: 'Loại hình', allowFiltering: true, width: '130' },
                        {fieldName: 'THANG_THOAITRA_SHOW', headerText: 'Tháng thoái trả', textAlign: 'Right', allowFiltering: true, width: '130' },
                    ]"        
                    v-bind:dataSource="dgvDanhSach.DataSource"
                    :showFilter="true"
                    :allowPaging="true"
                    :enablePagingServer="false"
                    @selectedRowChanged="dgvDanhSach_SelectionChanged"></DataGrid>
            </div>
        </div>
    </div>
    <b-modal ref="popupSearchAccount" size="xl" hide-footer hide-header hide-header-close body-class="modal-body p-0 frm-thaydoi-datcoc-huy">
        <SearchAccount @form-close="acceptSearchAccount" :isPopup="true"/>
    </b-modal>
    <SearchContractModal ref="popupSearchContract" @accept="acceptSearchContract" :loai_hd_id="32" :trangthai_hd="1" />
    <b-modal ref="popupNguoiGioiThieu" size="xl" hide-footer hide-header hide-header-close body-class="modal-body p-0 frm-thaydoi-datcoc-huy">
        <div class="modal-content popup-box">
            <div class="popup-header">
                <div class="title"><span class="icon one-notepad"></span> Chọn người giới thiệu</div>
                <div
                    class="close -ap icon-close"
                    data-dismiss="modal"
                    @click="$refs.popupNguoiGioiThieu.hide()">
                </div>
            </div>
            <div class="popup-body control-ngt" style="padding: 0;">
                <NguoiGioiThieu @PopUpNguoiGioiThieu_Thoat="xacNhanNguoiGioiThieu" @acceptChangeNGT="xacNhanNguoiGioiThieu" :isPopup="true"/>
            </div>
        </div>
    </b-modal>
    <b-modal id="id-frm-thaydoi-datcoc-huy-email" ref="ref-thongtin-email" size="xl" hide-footer hide-header hide-header-close body-class="modal-body p-0">
        <div class="modal-content popup-box">
            <div class="popup-header">
                <div class="title"><span class="icon one-notepad"></span> Thông tin Email</div>
                <div
                    class="close -ap icon-close"
                    data-dismiss="modal"
                    @click="$refs['ref-thongtin-email'].hide()">
                </div>
            </div>
            <div class="popup-body" style="padding: 0;">
                <ThongTinEmail :hdkh_id="hdkh_id" :khachhang_id="khachhang_id"></ThongTinEmail>
            </div>
        </div>
    </b-modal>
    <b-modal id="id-frm-thaydoi-datcoc-huy-lienhe" ref="ref-thongtin-lienhe" size="xl" hide-footer hide-header hide-header-close body-class="modal-body p-0">
        <div class="modal-content popup-box">
            <div class="popup-header">
                <div class="title"><span class="icon one-notepad"></span> Thông tin liên hệ</div>
                <div
                    class="close -ap icon-close"
                    data-dismiss="modal"
                    @click="$refs['ref-thongtin-lienhe'].hide()">
                </div>
            </div>
            <div class="popup-body" style="padding: 0;">
                <ThongTinLienHe :hdkh_id="hdkh_id" :khachhang_id="khachhang_id"></ThongTinLienHe>
            </div>
        </div>
    </b-modal>
    <!-- <FrmThanhToan ref="frmThanhToan"></FrmThanhToan> -->
    <ejs-dialog 
        ref='thanhtoanDialog' 
        header='THANH TOÁN HỢP ĐỒNG' 
        target='#app .main-wrapper' 
        width='100%' 
        :enableResize='true' 
        :visible='false' 
        :position="{ X: 'center', Y: 'top' }"
        :showCloseIcon='true' 
        :open="open_thanhToanPopUp"
        :close="close_thanhToanPopUp">
        <keep-alive>
            <div class="popupComponentPayment">
                <component :is="userComponentModule"  ref='thanhToanPopUp' :ispopup="true" :magiaodich='txtMaGDTT'  v-on="popupComponentEvts" />
            </div>
        </keep-alive>
    </ejs-dialog>
    <b-modal ref="popupCongTacVien" size="xl" hide-footer hide-header hide-header-close body-class="modal-body p-0 frm-capnhat-datcoc">
        <CongTacVien @form-close="xacNhanCongTacVien" @acceptChangeCTV="xacNhanCongTacVien" :isPopup="true"/>
    </b-modal>
</div>