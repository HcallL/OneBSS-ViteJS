<div class="frm-doi-sim">
  <div class="list-actions-top">
    <ul class="list">
      <li @click="btnNhapMoi_Click" :class="{'disable-btn': !btnNhapMoi.enabled}">
        <a href="javascript:void(0)">
          <span class="icon one-file-plus"></span>Nhập mới
        </a>
      </li>
      <li @click="btnGhiLai_Click" :class="{'disable-btn': !btnGhiLai.enabled}">
        <a href="javascript:void(0)">
          <span class="icon one-save"></span>Ghi lại
        </a>
      </li>
      <li :class="{'disable-btn': !btnHuyBo.enabled}" @click="btnHuyBo_Click">
        <a href="javascript:void(0)">
          <span class="icon nc-icon-glyph ui-1_circle-remove"></span>Huỷ
        </a>
      </li>
      <li @click="btnXoa_Click" :class="{'disable-btn': !btnXoa.enabled}">
        <a href="javascript:void(0)">
          <span class="icon one-trash"></span>Xoá HĐ
        </a>
      </li>
      <li @click="btnThanhToan_Click" :class="{'disable-btn': !btnThanhToan.enabled}">
        <a href="javascript:void(0)">
          <span class="icon nc-icon-glyph shopping_credit-card"></span>Thanh toán
        </a>
      </li>
    </ul>
  </div>
  <div class="page-content">
    <div class="box-form padt8 padb5">
      <div class="pull-right">
        <div class="inline">
          <div class="info-row marb0">
            <div class="key fw6 w80">Tổng tiền</div>
            <div class="value">
              <vue-numeric
                style="font-weight: bold;"
                class="form-control tright"
                v-model="txtTongTienHD.Text"
                :min="0"
                :empty-value="0"
                maxlength="100"
                :minus="false"
                separator=","></vue-numeric>
            </div>
          </div>
        </div>
      </div>
      <div class="clearfix"></div>
    </div>
    <div class="box-form">
      <div class="legend-title">Thông tin phiếu yêu cầu</div>
      <div class="row">
        <div class="col-sm-6 col-12">
          <div class="row">
            <div class="col-sm-7 col-12">
              <div class="info-row">
                <div class="key w80">Mã GD</div>
                <div class="value">
                  <div class="input-more-button">
                    <button class="btn" @click="btnLayMaGD_Click">
                      <span class="-ap icon-more_horiz"></span>
                    </button>
                    <input ref="ma-gd" type="text" v-model.trim="txtMaGD.Text" v-on:keyup.enter="onEnterInputMaGd" class="form-control highlight">
                  </div>
                </div>
              </div>
            </div>
            <div class="col-sm-5 col-12">
              <div class="info-row">
                <div class="key w90">Ngày yêu cầu</div>
                <div class="value">
                  <ejs-datepicker v-model="dtpNgayYeuCau.EditValue" :enabled="false" format="dd/MM/yyyy"></ejs-datepicker>
                </div>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-sm-7 col-12">
              <div class="info-row">
                <div class="key w80">Mã HĐ <bss-required-marker /></div>
                <div class="value">
                  <bss-error-marker :has-error="$v.txtMaHD.Text.$error">
                    <input ref="ref-txt-ma-hd" type="text" class="form-control" v-model.trim="txtMaHD.Text">
                  </bss-error-marker>
                </div>
              </div>
            </div>
            <div class="col-sm-5 col-12">
              <div class="info-row">
                <div class="key w90">Ngày lập HĐ</div>
                <div class="value">
                  <ejs-datepicker v-model="dtpNgayLapHD.EditValue" :enabled="false" format="dd/MM/yyyy"></ejs-datepicker>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="col-sm-6 col-12">
          <div class="row">
            <div class="col-sm-7 col-12">
              <div class="info-row">
                <div class="key w90">Dịch vụ VT</div>
                <div class="value">
                  <SelectExt
                    v-model="cboDichVuVt.Value"
                    :dataSource="cboDichVuVt.DataSource"
                    dataValueField="DICHVUVT_ID"
                    dataTextField="TEN_DVVT"
                    @change="cboDichVuVT_SelectedValueChanged" />
                </div>
              </div>
            </div>
            <div class="col-sm-5 col-12">
              <div class="info-row">
                <div class="key w90">Loại hình TB</div>
                <div class="value">
                  <SelectExt
                    v-model="cboLoaiHinhTB.Value"
                    :dataSource="cboLoaiHinhTB.DataSource"
                    dataValueField="LOAITB_ID"
                    dataTextField="LOAIHINH_TB" />
                </div>
              </div>
            </div>
          </div>
          <div class="info-row">
            <div class="key w90">Kiểu yêu cầu</div>
            <div class="value">
              <SelectExt
                v-model="cboKieuLD.Value"
                :dataSource="cboKieuLD.DataSource"
                dataValueField="kieuld_id"
                dataTextField="ten_kieuld"
                @change="cboKieuLD_SelectedValueChanged" />
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-6 col-12">
        <div class="box-form">
          <div class="legend-title">Thông tin thuê bao</div>
          <div class="row">
            <div class="col-sm-7 col-12">
              <div class="info-row">
                <div class="key w80">Số máy</div>
                <div class="value">
                  <div class="input-more-button">
                    <button class="btn" @click="btnLayMaKh_Click">
                      <span class="-ap icon-more_horiz"></span>
                    </button>
                    <input ref="ma-tb" v-model="txtMaTB.Text" type="text" class="form-control highlight" v-on:keyup.enter="onEnterInputMaTb">
                  </div>
                </div>
              </div>
            </div>
            <div class="col-sm-5 col-12">
              <div class="info-row">
                <div class="key w90">Số sim cũ</div>
                <div class="value">
                  <input type="text" class="form-control" readonly v-model="txtSoSimCu.Text" />
                </div>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-sm-7 col-12">
              <div class="info-row">
                <div class="key w80">Số sim mới <bss-required-marker /></div>
                <div class="value">
                  <bss-error-marker :has-error="$v.txtSoSimMoi.Text.$error">
                    <input
                      ref="ref-txt-so-sim-moi"
                      type="number"
                      class="form-control"
                      v-model.trim="txtSoSimMoi.Text"
                      maxlength="10"
                      oninput="javascript: if (this.value.length > this.maxLength) this.value = this.value.slice(0, this.maxLength);"
                      v-on:keyup.enter="onEnterInputSoSimMoi">
                  </bss-error-marker>
                </div>
              </div>
            </div>
            <div class="col-sm-5 col-12">
              <div class="info-row">
                <div class="key w90">Thông tin sim</div>
                <div class="value">
                  <input type="text" class="form-control" readonly v-model="txtTBBiLaySim.Text" :style="{color: txtTBBiLaySim.ForeColor}" :title="txtTBBiLaySim.Text">
                </div>
                <div class="value w30 nowrap padt7">
                  <div class="check-action">
                    <input type="checkbox" class="check" disabled v-model="ckeEsim.Checked" />
                    <span class="name">Esim</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="info-row">
            <div class="key w80">Tên TB <bss-required-marker /></div>
            <div class="value">
              <bss-error-marker :has-error="$v.txtTenTB.Text.$error">
                <input type="text" readonly class="form-control" v-model="txtTenTB.Text">
              </bss-error-marker>
            </div>
          </div>
          <div class="info-row">
            <div class="key w80">Địa chỉ TB</div>
            <div class="value">
              <input type="text" class="form-control" readonly v-model.trim="txtDiaChiTB.Text" >
            </div>
          </div>
          <div class="legend-title mart10">Chi tiết tiền khoản mục</div>
          <div class="row">
            <div class="col-sm-7 col-12">
              <div class="info-row">
                <div class="key w80">Tiền</div>
                <div class="value">
                  <vue-numeric
                    style="font-weight: bold;"
                    class="form-control tright"
                    v-model="txtTienLapMoi.Text"
                    :min="0"
                    :empty-value="0"
                    maxlength="100"
                    :minus="false"
                    separator=","></vue-numeric>
                </div>
              </div>
            </div>
            <div class="col-sm-5 col-12">
              <div class="info-row">
                <div class="key w90">Vat</div>
                <div class="value">
                  <vue-numeric
                    style="font-weight: bold;"
                    class="form-control tright"
                    v-model="txtVatLapmoi.Text"
                    :min="0"
                    :empty-value="0"
                    maxlength="100"
                    :minus="false"
                    separator=","></vue-numeric>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="col-sm-6 col-12">
        <div class="box-form">
          <div class="legend-title">Thông tin khách hàng</div>

          <div class="info-row">
            <div class="key w90">Mã KH <bss-required-marker /></div>
            <div class="value">
              <bss-error-marker :has-error="$v.txtMaKH.Text.$error">
                <input type="text" class="form-control" readonly v-model="txtMaKH.Text">
              </bss-error-marker>
            </div>
          </div>
          <div class="info-row">
            <div class="key w90">Tên KH <bss-required-marker /></div>
            <div class="value">
              <bss-error-marker :has-error="$v.txtTenKH.Text.$error">
                <input type="text" class="form-control" readonly v-model="txtTenKH.Text">
              </bss-error-marker>
            </div>
          </div>
          <div class="info-row">
            <div class="key w90">Địa chỉ KH</div>
            <div class="value">
              <input type="text" class="form-control" readonly v-model="txtDiaChiKH.Text">
            </div>
          </div>
          <div class="info-row">
            <div class="key w90">Ghi chú</div>
            <div class="value">
              <textarea class="form-control" style="height: 78px;resize: none;" v-model="txtGhiChu.Text"></textarea>
            </div>
          </div>
          <div v-show="allowShowAreaTrangThai" class="row">
            <div class="col-sm-4 col-12">
              <div class="info-row">
                <div class="key w90">Trạng thái</div>
                <div class="value">
                  <div class="list-checks mart7">
                    <div class="item">
                      <div class="check-action">
                        <input name="chkTracuu" type="checkbox" disabled value="0" v-model="ckeGoiDi.Checked" >
                        <span class="name">Gọi đi</span>
                      </div>
                    </div>
                    <div class="item">
                      <div class="check-action">
                        <input name="chkTracuu" type="checkbox" disabled value="1" v-model="ckeGoiDen.Checked" >
                        <span class="name">Gọi đến</span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-sm-4 col-12">
              <div class="info-row">
                <div class="key w60">Tỉnh, TP</div>
                <div class="value">
                  <input type="text" class="form-control" readonly v-model="txtTinhTP.Text">
                </div>
              </div>
            </div>
            <div class="col-sm-4 col-12">
              <div class="info-row">
                <div class="key w60">Loại</div>
                <div class="value">
                  <input type="text" class="form-control" readonly v-model="txtLoai.Text">
                </div>
              </div>
            </div>
          </div>

        </div>
      </div>
    </div>
    <div class="box-form">
      <div class="legend-title">Danh sách phiếu yêu cầu</div>
      <div class="table-content" style="height:calc(100% - 80px);">
        <DataGrid
          v-bind:columns="[
              {fieldName: 'ma_gd', headerText: 'Mã giao dịch', allowFiltering: true, allowSorting: true},
              {fieldName: 'ma_tb', headerText: 'Số máy', allowFiltering: true, allowSorting: true},
              {fieldName: 'sosim_moi', headerText: 'Số sim mới', allowFiltering: true, allowSorting: true, cssClass:'text-danger'},
              {fieldName: 'sosim_cu', headerText: 'Số sim cũ', allowFiltering: true, allowSorting: true},
              {fieldName: 'ten_tb', headerText: 'Tên thuê bao', allowFiltering: true, allowSorting: true},
              {fieldName: 'ngaylap_hd_ht', headerText: 'Thời gian tạo', allowFiltering: true, allowSorting: true},
              {fieldName: 'diachi_tb', headerText: 'Địa chỉ thuê bao', allowFiltering: true, allowSorting: true},
              {fieldName: 'trangthai_hd', headerText: 'Trạng thái', allowFiltering: true, allowSorting: true},
              {fieldName: 'ghichu', headerText: 'Ghi chú', allowFiltering: true, allowSorting: true}
          ]"
          v-bind:dataSource="dgrThueBao.DataSource"
          :showFilter="true"
          :allowPaging="true"
          :enablePagingServer="false"
          @selectedRowChanged="onSelectRowPhieuYeuCau"></DataGrid>
      </div>
    </div>
  </div>
  <b-modal ref="ref-modal-xacnhan-xoa" centered title="Thông báo" size="sm">
    <span>Bạn thật sự muốn xóa hợp đồng không ?</span>
    <template #modal-footer="{ cancel }">
         <b-button variant="secondary" style="color: white" @click="cancel()">Hủy</b-button>
         <b-button variant="primary" style="color: white" @click="okXoaHopDong">Đồng ý</b-button>
    </template>
  </b-modal>
  <b-modal ref="popupSearchAccount" size="xl" hide-footer hide-header hide-header-close body-class="modal-body p-0 frm-doi-sim">
    <SearchAccount @form-close="acceptSearchAccount" :isPopup="true"/>
  </b-modal>
  <SearchContractModal ref="popupSearchContract" @accept="acceptSearchContract" :loai_hd_id="LoaiHopDong.THAY_DOI_SO_SIM" :trangthai_hd="TrangThaiHD.MOI" />
</div>
